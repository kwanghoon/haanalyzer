#################################################################
## 3D Printer Automations
#################################################################

#################################################################
## Systems
#################################################################

        ##########################################################
        ## Startup PrusaConnect LXC When Printers Turn On
        ##########################################################

- alias: Startup PrusaConnect LXC When Printers Turn On
  id: '3d_printer_startup_prusaconnect_lxc_when_printers_turn_on'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: binary_sensor.lxc_prusaconnect_cam_108_status
      state: 'off'

  actions:
    - action: button.press
      target:
        entity_id: button.lxc_prusaconnect_cam_108_start

        ##########################################################
        ## Shutdown PrusaConnect LXC When MK4S Turns Off
        ##########################################################

- alias: Shutdown PrusaConnect LXC When MK4S Turns Off
  id: '3d_printer_shutdown_prusaconnect_lxc_when_mk4s_turns_off'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: binary_sensor.lxc_prusaconnect_cam_108_status
      state: 'on'
    - condition: state
      entity_id: switch.prusa_mk4s
      state: 'off'
    - condition: state
      entity_id: switch.prusa_mk4s_mmu3
      state: 'off'

  actions:
    - action: button.press
      target:
        entity_id: button.lxc_prusaconnect_cam_108_shutdown

        ##########################################################
        ## Shutdown PrusaConnect LXC When MK4S MMU3 Turns Off
        ##########################################################

- alias: Shutdown PrusaConnect LXC When MK4S MMU3 Turns Off
  id: '3d_printer_shutdown_prusaconnect_lxc_when_mk4s_mmu3_turns_off'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: binary_sensor.lxc_prusaconnect_cam_108_status
      state: 'on'
    - condition: state
      entity_id: switch.prusa_mk4s
      state: 'off'
    - condition: state
      entity_id: switch.prusa_mk4s_mmu3
      state: 'off'

  actions:
    - action: button.press
      target:
        entity_id: button.lxc_prusaconnect_cam_108_shutdown

#################################################################
## Prusa MK4S
#################################################################

        ##########################################################
        ## Prusa MK4S 3D Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Finished
  id: '3d_printer_prusa_mk4s_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: notify.USER1_devices
      data:
        message: 3D Print Complete (MK4S)
        data:
          tag: prusa_mk4s
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Stopped
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Stopped
  id: '3d_printer_prusa_mk4s_print_stopped'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'stopped'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "purple"
    - action: notify.USER1_devices
      data:
        message: Print Stopped (MK4S)
        data:
          tag: prusa_mk4s
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Paused
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Paused
  id: '3d_printer_prusa_mk4s_print_paused'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'paused'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "orangered"
    - action: notify.USER1_devices
      data:
        message: Print Paused (MK4S)
        data:
          tag: prusa_mk4s
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Error
  id: '3d_printer_prusa_mk4s_print_error'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'error'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Error (MK4S)
        data:
          tag: prusa_mk4s
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Attention
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Attention
  id: '3d_printer_prusa_mk4s_print_attention'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'attention'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Needs Attention (MK4S)
        data:
          tag: prusa_mk4s
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## MK4S On Turn On Light
        ##########################################################

- alias: 3D-Printer - MK4S On Turn On Light
  id: '3d_printer_mk4s_on_turn_on_light'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## 3D Printer MK4S Off Turn Off Light
        ##########################################################

- alias: 3D-Printer - MK4S Off Turn Off Light
  id: '3d_printer_mk4s_off_turn_off_light'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s
      to: 'off'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.prusa_mk4s

        ##########################################################
        ## MK4S Light Reset if Idle
        ##########################################################

- alias: 3D-Printer - MK4S Light Reset if Idle
  id: '3d_printer_mk4s_light_reset_if_idle'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'idle'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'idle'
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S Light Print Start
        ##########################################################

- alias: 3D-Printer - MK4S Light Print Start
  id: '3d_printer_mk4s_light_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  actions:
    - action: light.turn_on
      entity_id:
        - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "blue"
    - delay: '00:05:00'
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S Light Print Finish
        ##########################################################

- alias: 3D-Printer - MK4S Light Print Finish
  id: '3d_printer_mk4s_light_print_finish'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "green"

        ##########################################################
        ## 3D Printer Light MK4S Print Finish Reset
        ##########################################################

- alias: 3D-Printer - Light MK4S Print Finish Reset
  id: '3d_printer_light_mk4s_print_finish_reset'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'finished'
      to: 'idle'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## Prusa MK4S Enclosure Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan On Temp
  id: '3d_printer_prusa_mk4s_enclosure_fan_on_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 25
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ASA'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan On Temp
  id: '3d_printer_prusa_mk4s_psu_fan_on_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ASA'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan Off Temp
  id: '3d_printer_prusa_mk4s_enclosure_fan_off_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 24
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan Off Temp
  id: '3d_printer_prusa_mk4s_psu_fan_off_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan On Print Start
  id: '3d_printer_prusa_mk4s_enclosure_fan_on_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 25
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan On Print Start
  id: '3d_printer_prusa_mk4s_psu_fan_on_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan Off Print Start
  id: '3d_printer_prusa_mk4s_enclosure_fan_off_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 24
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan Off Print Start
  id: '3d_printer_prusa_mk4s_psu_fan_off_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fans On Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fans On Print Finished
  id: '3d_printer_prusa_mk4s_enclosure_fans_on_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fans Off Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fans Off Print Finished
  id: '3d_printer_prusa_mk4s_enclosure_fans_off_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'finished'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'idle'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## 3D Printer MK4S Off Turn Off Fans
        ##########################################################

- alias: 3D-Printer - MK4S Off Turn Off Fans
  id: '3d_printer_mk4s_off_turn_off_fans'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s
      to: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## 3D Printer Turn On Camera Recording Prusa MK4S
        ##########################################################

- alias: 3D-Printer - Turn On Camera Recording Prusa MK4S
  id: '3d_printer_turn_on_camera_recording_prusa_mk4s'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_camera_recording_mode
        state: 'Always'

  actions:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_camera_recording_mode
        option: "Always"

        ##########################################################
        ## 3D Printer Turn Off Camera Recording Prusa MK4S
        ##########################################################

- alias: 3D-Printer - Turn Off Camera Recording Prusa MK4S
  id: '3d_printer_turn_off_camera_recording_prusa_mk4s'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_camera_recording_mode
        state: 'Never'

  actions:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_camera_recording_mode
        option: "Never"

#################################################################
## Prusa MK4S MMU3
#################################################################

        ##########################################################
        ## Prusa MK4S MMU3 3D Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: notify.USER1_devices
      data:
        message: 3D Print Complete (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Stopped
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Stopped
  id: '3d_printer_prusa_mk4s_mmu3_print_stopped'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'stopped'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "purple"
    - action: notify.USER1_devices
      data:
        message: Print Stopped (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Paused
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Paused
  id: '3d_printer_prusa_mk4s_mmu3_print_paused'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'paused'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "orangered"
    - action: notify.USER1_devices
      data:
        message: Print Paused (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 MMU Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 MMU Print Error
  id: '3d_printer_prusa_mk4s_mmu3_print_error'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_nozzle_temperature
      below: 165
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'

  actions:
    - action: notify.USER1_devices
      data:
        message: Print Error (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Error
  id: '3d_printer_prusa_mk4s_mmu3_print_error'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'error'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Error (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Attention
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Attention
  id: '3d_printer_prusa_mk4s_mmu3_print_attention'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'attention'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Needs Attention (MMU)
        data:
          tag: prusa_mk4s_mmu3
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 On Turn On Light
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 On Turn On Light
  id: '3d_printer_mk4s_mmu3_on_turn_on_light'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## 3D Printer MK4S MMU3 Off Turn Off Light
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Off Turn Off Light
  id: '3d_printer_mk4s_mmu3_off_turn_off_light'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'off'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.prusa_mk4s_mmu3

        ##########################################################
        ## MK4S MMU3 Light Print Start
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Print Start
  id: '3d_printer_mk4s_mmu3_light_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "blue"
    - delay: '00:05:00'
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S MMU3 Light Print Finish
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Print Finish
  id: '3d_printer_mk4s_mmu3_light_print_finish'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "green"

        ##########################################################
        ## 3D Printer Light MK4S MMU3 Print Finish Reset
        ##########################################################

- alias: 3D-Printer - Light MK4S MMU3 Print Finish Reset
  id: '3d_printer_light_mk4s_mmu3_print_finish_reset'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'finished'
      to: 'idle'

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S MMU3 Light Reset if Idle
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Reset if Idle
  id: '3d_printer_mk4s_mmu3_light_reset_if_idle'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'idle'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'idle'
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan On Temp
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_on_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 25
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan On Temp
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_on_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan Off Temp
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_off_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 24
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure PSU Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan Off Temp
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_off_temp'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan On Print Start
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_on_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 25
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan On Print Start
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_on_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan Off Print Start
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_off_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 24
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan Off Print Start
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_off_print_start'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fans On Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fans On Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fans_on_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fans Off Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fans Off Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fans_off_print_finished'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'finished'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'idle'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## 3D Printer MK4S MMU3 Off Turn Off Fans
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Off Turn Off Fans
  id: '3d_printer_mk4s_mmu3_off_turn_off_fans'

  triggers:
    - trigger: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## 3D Printer Turn On Camera Recording Prusa MK4S MMU3
        ##########################################################

- alias: 3D-Printer - Turn On Camera Recording Prusa MK4S MMU3
  id: '3d_printer_turn_on_camera_recording_prusa_mk4s_mmu3'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        state: 'Always'

  actions:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        option: "Always"

        ##########################################################
        ## 3D Printer Turn Off Camera Recording Prusa MK4S MMU3
        ##########################################################

- alias: 3D-Printer - Turn Off Camera Recording Prusa MK4S MMU3
  id: '3d_printer_turn_off_camera_recording_prusa_mk4s_mmu3'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        state: 'Never'

  actions:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        option: "Never"#################################################################
## Alarm Automations
#################################################################

        ##########################################################
        ## Alarm Triggered Armed Away
        ##########################################################

- alias: Alarm - Triggered Armed Away
  id: 'alarm_triggered_armed_away'

  triggers:
    - trigger: state
      entity_id: alarm_control_panel.alarm
      to: 'triggered'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       brightness_pct: 100
       color_name: "red"
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       flash: long
    - action: switch.turn_on
      target:
        entity_id:
          - switch.siren
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="You are not Authorized to be Here. Law Enforcement Has Been Notified!"
        media_content_type: "music"
        extra:
          volume: 90
    - action: notify.USER1_devices
      data:
        message: Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: notify.USER2_devices
      data:
        message: Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background

        ##########################################################
        ## Alarm Triggered Armed Home
        ##########################################################

- alias: Alarm - Triggered Armed Home
  id: 'alarm_triggered_armed_home'

  triggers:
    - trigger: state
      entity_id: alarm_control_panel.alarm
      to: 'triggered'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       brightness_pct: 100
       color_name: "red"
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       flash: long
    - action: switch.turn_on
      target:
        entity_id:
          - switch.siren
    - action: notify.USER1_devices
      data:
        message: Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: notify.USER2_devices
      data:
        message: Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background

        ##########################################################
        ## Panic Button On
        ##########################################################

- alias: Alarm - Panic Button On
  id: 'alarm_panic_button_on'

  triggers:
    - trigger: state
      entity_id: switch.panic_mode
      to: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       brightness_pct: 100
       color_name: "red"
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.lutron_lights_exterior
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       flash: long
    - action: switch.turn_on
      target:
        entity_id:
          - switch.siren
    - action: notify.USER1_devices
      data:
        message: Panic Button Has Been Pressed!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: notify.USER2_devices
      data:
        message: Panic Button Has Been Pressed!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background

        ##########################################################
        ## Panic Button Off
        ##########################################################

- alias: Alarm - Panic Button Off
  id: 'alarm_panic_button_off'

  triggers:
    - trigger: state
      entity_id: switch.panic_mode
      to: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.siren

        ##########################################################
        ## Panic Button Auto Off
        ##########################################################

- alias: Alarm - Panic Button Auto Off
  id: 'alarm_panic_button_auto_off'

  triggers:
    - trigger: state
      entity_id: switch.panic_mode
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.siren

        ##########################################################
        ## Door Alarm Away
        ##########################################################

- alias: Alarm - Away Door Alarm
  id: 'alarm_away_door_alarm'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_away'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Door Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: notify.USER2_devices
      data:
        message: Door Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: alarm_control_panel.alarm_trigger
      target:
        entity_id:
          - alarm_control_panel.alarm

        ##########################################################
        ## Door Alarm Home
        ##########################################################

- alias: Alarm - Home Door Alarm
  id: 'alarm_home_door_alarm'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_home'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Door Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: notify.USER2_devices
      data:
        message: Door Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
            - action: "siren_off"
              title: "Siren Off"
              activationMode: background
    - action: alarm_control_panel.alarm_trigger
      target:
        entity_id:
          - alarm_control_panel.alarm

        #################################################################
        ## Motion Alarm Away
        #################################################################

- alias: Alarm - Motion Alarm Away
  id: 'alarm_motion_alarm_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.motion
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 30

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: state
      entity_id: vacuum.basement_roomba
      state: 'docked'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_away'
    - condition: state
      entity_id: switch.3d_printer_prusa
      state: 'off'
    - condition: state
      entity_id: switch.3d_printer_prusa_mini
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Motion Alarm Triggered!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 1.0
          tag: alarm
          entity_id:
           - camera.front_porch
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background
#    - action: alarm_control_panel.alarm_trigger
#      entity_id:
#        - alarm_control_panel.alarm

        ##########################################################
        ## Garage Alarm Home
        ##########################################################

- alias: Alarm - Garage Alarm Home
  id: 'alarm_garage_alarm_home'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'open'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_home'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Garage Door Alarm Triggered!
        data:
          tag: alarm
          entity_id: camera.garage

        ##########################################################
        ## Garage Alarm Away
        ##########################################################

- alias: Alarm - Garage Alarm Away
  id: 'alarm_garage_alarm_away'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'open'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_away'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Garage Door Alarm Triggered!
        data:
          tag: alarm
          entity_id: camera.garage

        ##########################################################
        ## Disable Alarm when Home
        ##########################################################

- alias: Alarm - Disable Alarm when Home
  id: 'alarm_disable_alarm_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarm
        state: 'disarmed'

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

        ##########################################################
        ## Disable Alarm when USER1 or USER2 Home
        ##########################################################

- alias: Alarm - Disable Alarm when USER1 or USER2 Home
  id: 'alarm_disable_alarm_when_USER1_or_USER2_home'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarm
        state: 'disarmed'

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

        ##########################################################
        ## Enable Alarm when Away
        ##########################################################

- alias: Alarm - Enable Alarm when Away
  id: 'alarm_enable_alarm_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'disarmed'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_boolean.home_showing_mode
        state: 'on'

  actions:
    - action: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.alarm

        ##########################################################
        ## Arm Home at Bedtime
        ##########################################################

- alias: Alarm - Arm Home at Bedtime
  id: 'alarm_arm_home_at_bedtime'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'disarmed'

  actions:
    - action: alarm_control_panel.alarm_arm_home
      entity_id: alarm_control_panel.alarm

        ##########################################################
        ## Disarm Armed Home in the Morning on Motion
        ##########################################################

- alias: Alarm - Disarm Armed Home in the Morning on Motion
  id: 'alarm_disarm_armed_home_in_the_morning_on_motion'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'armed_home'
    - condition: time
      after: '05:00:00'
      before: '21:00:00'

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

        ##########################################################
        ## Disable Alarm if Lock Code Used
        ##########################################################

- alias: Alarm - Disable Alarm if Lock Code Used
  id: 'alarm_disable_alarm_if_lock_code_used'

  triggers:
    - trigger: state
      entity_id: sensor.front_door_lock_code
      to: 'USER2'
    - trigger: state
      entity_id: sensor.front_door_lock_code
      to: 'USER1'
    - trigger: state
      entity_id: sensor.front_door_lock_code
      to: 'guest'
    - trigger: state
      entity_id: sensor.back_door_lock_code
      to: 'USER2'
    - trigger: state
      entity_id: sensor.back_door_lock_code
      to: 'USER1'
    - trigger: state
      entity_id: sensor.back_door_lock_code
      to: 'guest'
    - trigger: state
      entity_id: sensor.basement_door_lock_code
      to: 'USER2'
    - trigger: state
      entity_id: sensor.basement_door_lock_code
      to: 'USER1'
    - trigger: state
      entity_id: sensor.basement_door_lock_code
      to: 'guest'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: alarm_control_panel.alarm
        state: 'disarmed'

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

#################################################################
## Notifications
#################################################################

    #################################################################
    ## Alarm Armed Home iOS Notification
    #################################################################

- alias: Alarm - Armed Home iOS Notification
  id: 'alarm_armed_home_ios_notification'

  triggers:
    - trigger: state
      entity_id: alarm_control_panel.alarm
      to: 'armed_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Alarm is Armed
        data:
          tag: alarm
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background

    #################################################################
    ## Alarm Armed Away iOS Notification
    #################################################################

- alias: Alarm - Armed Away iOS Notification
  id: 'alarm_armed_away_ios_notification'

  triggers:
    - trigger: state
      entity_id: alarm_control_panel.alarm
      to: 'armed_away'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Alarm is Armed
        data:
          tag: alarm
          actions:
            - action: "disarm_alarm"
              title: "Disable Alarm System"
              destructive: true
              activationMode: background

    #################################################################
    ## Alarm Disabled iOS Notification
    #################################################################

- alias: Alarm - Disabled iOS Notification
  id: 'alarm_disabled_ios_notification'

  triggers:
    - trigger: state
      entity_id: alarm_control_panel.alarm
      to: 'disarmed'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Alarm is Disarmed
        data:
          tag: alarm
          actions:
            - action: "arm_alarm"
              title: "Arm Alarm System"
              destructive: true
              activationMode: background

        ##########################################################
        ## Siren Low Battery Notification
        ##########################################################

- alias: Alarm - Low Battery Notification
  id: 'alarm_low_battery_notification'

  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.siren_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Alarm {{ trigger.to_state.attributes.friendly_name }} Low Battery#################################################################
## Bedtime Automations
#################################################################

        ##########################################################
        ## Bedtime Locks
        ##########################################################

- alias: Bedtime - Locks
  id: 'bedtime_locks'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.front_door
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## Bedtime Media
        ##########################################################

- alias: Bedtime - Media
  id: 'bedtime_media'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 30

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "power_off"
    - action: select.select_option
      data:
        entity_id: select.USER1_s_office_tv_activities
        option: "power_off"
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "None"
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_surround_sound
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_backyard_patio
          - media_player.sonos_roam

        ##########################################################
        ## Bedtime Blinds
        ##########################################################

- alias: Bedtime - Blinds
  id: 'bedtime_blinds'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.kitchen_blinds
        state: 'open'
      - condition: state
        entity_id: cover.bedroom_closet_blinds
        state: 'open'
      - condition: state
        entity_id: cover.stairs_blinds
        state: 'open'

  actions:
    - action: cover.close_cover
      target:
        entity_id:
          - cover.stairs_blinds
    - action: cover.close_cover
      target:
        entity_id:
          - cover.bedroom_closet_blinds
    - action: cover.close_cover
      target:
        entity_id:
          - cover.kitchen_blinds

        ##########################################################
        ## Bedtime Helpers
        ##########################################################

- alias: Bedtime - Helpers
  id: 'bedtime_helpers'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.office_rainbow
          - input_boolean.livingroom_rainbow
          - input_boolean.bedroom_rainbow
          - input_boolean.front_porch_rainbow
          - input_boolean.pop_music
          - input_boolean.jazz_music
          - input_boolean.chill_music
          - input_boolean.electronic_music
          - input_boolean.classical_music
          - input_boolean.group_all_sonos
          - input_boolean.view_package_camera
          - input_boolean.package_camera_notification

        ##########################################################
        ## Bedtime Fans
        ##########################################################

- alias: Bedtime - Fans
  id: 'bedtime_fans'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 3
        seconds: 30

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: fan.turn_off
      target:
        entity_id:
          - fan.USER1s_office_fan
          - fan.living_room_east
          - fan.living_room_west

        ##########################################################
        ## Bedtime Switches
        ##########################################################

- alias: Bedtime - Switches
  id: 'bedtime_switches'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.USER1s_office_air_purifier
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
          - switch.fireplace
          - switch.fountain
          - switch.fountain_lights

        ##########################################################
        ## Bedtime Lights
        ##########################################################

- alias: Bedtime - Lights
  id: 'bedtime_lights'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.interior_lights
      state: 'on'
    - condition: state
      entity_id: input_boolean.overnight_guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - delay: '00:00:60'
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio

        ##########################################################
        ## Bedtime Guest Mode
        ##########################################################

- alias: Bedtime - Guest Mode
  id: 'bedtime_guest_mode'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.overnight_guest_mode
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2s_bedroom_closet
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.work_bench_light
    - action: light.turn_off
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.craft_room_ceiling
    - action: light.turn_off
      target:
        entity_id:
          - light.fitness_room_ceiling
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lamp
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_office_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Guest'
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1s_office_desktop_clock
          - light.living_room_clock

        ##########################################################
        ## Bedtime Thermostat
        ##########################################################

- alias: Bedtime - Thermostat
  id: 'bedtime_thermostat'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.overnight_guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: time
      after: '17:00:00'
      before: '23:00:00'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'sleep'

        ##########################################################
        ## Bedtime Exterior Lights
        ##########################################################

- alias: Bedtime - Exterior Lights
  id: 'bedtime_exterior_lights'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 30

  conditions:
    - condition: time
      after: '00:00:00'
      before: '06:00:00'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - delay: '00:00:60'
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
          - switch.fountain
          - switch.fountain_lights

        ##########################################################
        ## Bedtime Exterior Lights Holiday
        ##########################################################

- alias: Bedtime - Bedtime Exterior Lights Holiday
  id: 'bedtime_exterior_lights_holiday'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 30

  conditions:
    - condition: time
      after: '00:00:00'
      before: '07:30:00'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'None'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
    - action: light.turn_off
      target:
        entity_id:
           light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
           light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
    - delay: '00:00:30'
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio

        ##########################################################
        ## Bedtime Garage Door
        ##########################################################

- alias: Bedtime - Garage Door
  id: 'bedtime_garage_door'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 30

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_interior
      data:
       flash: long
    - delay: '00:00:15'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Bedtime - USER1's Office Blinds
        ##########################################################

- alias: Bedtime USER1's Office Blinds
  id: 'bedtime_USER1_office_blinds'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 30

  conditions:
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'

  actions:
    - action: cover.close_cover
      target:
        entity_id:
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Bedtime - USER1's Office Blinds Portable AC
        ##########################################################

- alias: Bedtime USER1's Office Blinds Portable AC
  id: 'bedtime_USER1_office_blinds_portable_ac'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 30

  conditions:
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      target:
        entity_id:  
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1s_office_blinds_right
        position: 13

        ##########################################################
        ## Bedtime - USER2's Office Blinds
        ##########################################################

- alias: Bedtime USER2's Office Blinds
  id: 'bedtime_USER2_office_blinds'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'

  actions:
    - action: cover.close_cover
      target:
        entity_id:
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Bedtime - USER2's Office Blinds Portable AC
        ##########################################################

- alias: Bedtime USER2's Office Blinds Portable AC
  id: 'bedtime_USER2_office_blinds_portable_ac'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'

  actions:
    - action: cover.close_cover
      target:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

        ##########################################################
        ## Reset Bedtime Switch
        ##########################################################

- alias: Bedtime - Reset Switch
  id: 'bedtime_reset_switch'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.bedtime
#################################################################
## Blinds Automations
#################################################################

        ##########################################################
        ## Close USER2's Office Blinds when Sun Below Horizon
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds when Sun Below Horizon
  id: 'blinds_close_USER2_office_blinds_when_sun_below_horizon'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Close USER2's Office Blinds when Sun Below Horizon Portable AC
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds when Sun Below Horizon Portable AC
  id: 'blinds_close_USER2_office_blinds_when_sun_below_horizon_portable_ac'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

        ##########################################################
        ## Close Bedroom Closet Blinds when Sun Below Horizon
        ##########################################################

- alias: Blinds - Close Bedroom Closet Blinds when Sun Below Horizon
  id: 'blinds_close_bedroom_closet_blinds_when_sun_below_horizon'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds

        ##########################################################
        ## Close Upstairs Blinds when Sun Below Horizon
        ##########################################################

- alias: Blinds - Close Upstairs Blinds when Sun Below Horizon
  id: 'blinds_close_upstairs_blinds_when_sun_below_horizon'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.stairs_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.stairs_blinds

        ##########################################################
        ## Close Kitchen Blinds when Sun Below Horizon
        ##########################################################

- alias: Blinds - Close Kitchen Blinds when Sun Below Horizon
  id: 'blinds_close_kitchen_blinds_when_sun_below_horizon'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.kitchen_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.kitchen_blinds

#################################################################
## USER1's Office
#################################################################

        ##########################################################
        ## Open USER1's Office Blinds When Motion Detected
        ##########################################################

- alias: Blinds - USER1's Office Blinds When Motion Detected
  id: 'blinds_USER1_office_blinds_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: time
      after: '08:00:00'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'closed'
      - condition: state
        entity_id: input_boolean.USER1_office_portable_ac
        state: 'on'
    - condition: sun
      after: sunrise
      after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Close USER1's Office Blinds When No Motion Detected
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds When No Motion Detected
  id: 'blinds_close_USER1_office_blinds_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Close USER1's Office Blinds When No Motion Detected Portable AC
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds When No Motion Detected Portable AC
  id: 'blinds_close_USER1_office_blinds_when_no_motion_detected_portable_ac'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1s_office_blinds_right
        position: 13

        ##########################################################
        ## Close USER1's Office Blinds Outside Temperature
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Outside Temperature
  id: 'blinds_close_USER1_office_blinds_outside_temperature'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 85
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 20
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Close USER1's Office Blinds Outside Temperature Portable AC
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Outside Temperature Portable AC
  id: 'blinds_close_USER1_office_blinds_outside_temperature_portable_ac'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 85
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 20
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1s_office_blinds_right
        position: 13

        ##########################################################
        ## Close USER1's Office Blinds Halfway Before Sunset
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Halfway Before Sunset
  id: 'blinds_close_USER1_office_blinds_halfway_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:50:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'

  actions:
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1_s_office_blinds
        position: 50

        ##########################################################
        ## Close USER1's Office Blinds Before Sunset Window Closed
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Before Sunset Window Closed
  id: 'blinds_close_USER1_office_blinds_before_sunset_window_closed'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:32:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Close USER1's Office Blinds Before Sunset Window Open
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Before Sunset Window Open
  id: 'blinds_close_USER1_office_blinds_before_sunset_window_open'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:32:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id:
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center

        ##########################################################
        ## Close USER1's Office Blinds when Sun Below Horizon and Window Closed
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds when Sun Below Horizon and Window Closed
  id: 'blinds_close_USER1s_office_blinds_when_sun_below_horizon_window_closed'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## Close USER1's Office Blinds Partially when Sun Below Horizon and Window Open
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Partially when Sun Below Horizon and Window Open
  id: 'blinds_close_USER1s_office_blinds_partially_when_sun_below_horizon_and_window_open'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1s_office_blinds_right
        position: 45

        ##########################################################
        ## Close USER1's Office Blinds Partially when Sun Below Horizon Portable AC
        ##########################################################

- alias: Blinds - Close USER1's Office Blinds Partially when Sun Below Horizon Portable AC
  id: 'blinds_close_USER1s_office_blinds_partially_when_sun_below_horizon_and_window_open_portable_ac'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER1s_office_blinds_right
        position: 13

        ##########################################################
        ## Turn Off USER1's Office Lights when Blinds are Open
        ##########################################################

- alias: Blinds - Turn Off USER1's Office Lights when Blinds are Open
  id: 'blinds_turn_off_USER1_office_lights_when_blinds_are_open'

  triggers:
    - trigger: state
      entity_id: cover.USER1_s_office_blinds
      from: 'closed'
      to: 'opening'
    - trigger: state
      entity_id: cover.USER1_s_office_blinds
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: light.USER1_office_lights
      state: 'on'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1_s_office_ceiling
    - action: light.turn_off
      entity_id:
        - light.office_lamp
    - action: light.turn_off
      entity_id:
        - light.USER1_office_desk_accent

        ##########################################################
        ## Turn Off USER1's Office Desk Lamp when Blinds are Open
        ##########################################################

- alias: Blinds - Turn Off USER1's Office Desk Lamp when Blinds are Open
  id: 'blinds_turn_off_USER1_office_desk_lamp_when_blinds_are_open'

  triggers:
    - trigger: state
      entity_id: cover.USER1_s_office_blinds
      from: 'closed'
      to: 'opening'
    - trigger: state
      entity_id: cover.USER1_s_office_blinds
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1_office_desk_lamp
    - delay: '00:00:30'
    - action: light.turn_off
      entity_id:
        - light.USER1_office_desk_lamp

#################################################################
## Stairs
#################################################################

        ##########################################################
        ## Open Stairs Blinds When Motion Detected
        ##########################################################

- alias: Blinds - Open Stairs Blinds When Motion Detected
  id: 'blinds_stairs_blinds_open_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: state
      entity_id: cover.stairs_blinds
      state: 'closed'
    - condition: sun
      after: sunrise
      after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.stairs_blinds

        ##########################################################
        ## Close Stairs Blinds When No Motion Detected
        ##########################################################

- alias: Blinds - Close Stairs Blinds When No Motion Detected
  id: 'blinds_close_stairs_blinds_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'on'
      to: 'off'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER2s_office_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.stairs_motion
      state: 'off'
    - condition: state
      entity_id: cover.stairs_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.stairs_blinds

        ##########################################################
        ## Close Stairs Blinds Outside Temperature
        ##########################################################

- alias: Blinds - Close Stairs Blinds Outside Temperature
  id: 'blinds_close_stairs_blinds_outside_temperature'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 85
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 20
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.stairs_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.stairs_blinds

        ##########################################################
        ## Turn Off Stair Lights when Blinds are Open
        ##########################################################

- alias: Blinds - Turn Off Stair Lights when Blinds are Open
  id: 'blinds_turn_off_stair_lights_when_blinds_are_open'

  triggers:
    - trigger: state
      entity_id: cover.stairs_blinds
      from: 'closed'
      to: 'opening'
    - trigger: state
      entity_id: cover.stairs_blinds
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'

  actions:
    - action: light.turn_off
      entity_id:
        - light.stairs_light

        ##########################################################
        ## Close Upstairs Blinds Before Sunset
        ##########################################################

- alias: Blinds - Close Upstairs Blinds Before Sunset
  id: 'blinds_close_upstairs_blinds_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:45:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.stairs_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.stairs_blinds

#################################################################
## USER2's Office
#################################################################

        ##########################################################
        ## Open USER2's Office Blinds When Motion Detected
        ##########################################################

- alias: Blinds - USER2's Office Blinds When Motion Detected
  id: 'blinds_USER2_office_blinds_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: sun
      #after: sunrise
      #after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'autumn'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER2_s_office_blinds
        state: 'closed'
      - condition: state
        entity_id: input_boolean.USER2_office_portable_ac
        state: 'on'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Open USER2's Office Blinds When Motion Detected Winter Sunny
        ##########################################################

- alias: Blinds - Open USER2's Office Blinds When Motion Detected Winter Sunny
  id: 'blinds_USER2_office_blinds_when_motion_detected_winter__sunny'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'closed'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'autumn'
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: state
      entity_id: weather.REDACTED
      state: 'sunny'
    - condition: time
      before: '11:30:00'
    - condition: sun
      #after: sunrise
      #after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2_s_office_blinds
        position: 40

        ##########################################################
        ## Open USER2's Office Blinds When Motion Detected Winter Early
        ##########################################################

- alias: Blinds - Open USER2's Office Blinds When Motion Detected Winter Early
  id: 'blinds_USER2_office_blinds_when_motion_detected_winter__early'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'closed'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'autumn'
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: time
      before: '11:30:00'
    - condition: sun
      #after: sunrise
      #after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'sunny'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Open USER2's Office Blinds When Motion Detected Winter
        ##########################################################

- alias: Blinds - Open USER2's Office Blinds When Motion Detected Winter
  id: 'blinds_USER2_office_blinds_when_motion_detected_winter'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER2_s_office_blinds
        state: 'closed'
      - condition: state
        entity_id: cover.USER2_s_office_blinds
        attribute: current_position
        state: 40
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'autumn'
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: time
      after: '11:31:00'
    - condition: sun
      #after: sunrise
      #after_offset: "00:60:00"
      before: sunset
      before_offset: "-00:45:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Close USER2's Office Blinds When No Motion Detected
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds When No Motion Detected
  id: 'blinds_close_USER2_office_blinds_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Close USER2's Office Blinds When No Motion Detected Portable AC
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds When No Motion Detected Portable AC
  id: 'blinds_close_USER2_office_blinds_when_no_motion_detected_portable_ac'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

        ##########################################################
        ## Close USER2's Office Blinds Outside Temperature
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds Outside Temperature
  id: 'blinds_close_USER2_office_blinds_outside_temperature'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 85
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 20
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Close USER2's Office Blinds Outside Temperature Portable AC
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds Outside Temperature Portable AC
  id: 'blinds_close_USER2_office_blinds_outside_temperature_portable_ac'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 85
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 20
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

        ##########################################################
        ## Close USER2's Office Blinds Before Sunset
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds Before Sunset
  id: 'blinds_close_USER2_office_blinds_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:45:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## Close USER2's Office Blinds Before Sunset Portable AC
        ##########################################################

- alias: Blinds - Close USER2's Office Blinds Before Sunset Portable AC
  id: 'blinds_close_USER2_office_blinds_before_sunset_portable_ac'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:45:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.USER2_s_office_blinds
      state: 'open'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

#################################################################
## Bedroom
#################################################################

        ##########################################################
        ## Open Bedroom Blinds at 10a Weekdays
        ##########################################################

- alias: Blinds - Open Bedroom Blinds at 10a Weekdays
  id: 'blinds_open_bedroom_blinds_at_10a_weekdays'

  triggers:
   - trigger: time
     at: '10:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'closed'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 95
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds

        ##########################################################
        ## Close Bedroom Blinds Before Sunset
        ##########################################################

- alias: Blinds - Close Bedroom Blinds Before Sunset
  id: 'blinds_close_bedroom_blinds_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:45:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds

        ##########################################################
        ## Turn Off Bedroom Lights when Blinds are Open
        ##########################################################

- alias: Blinds - Turn Off Bedroom Lights when Blinds are Open
  id: 'blinds_turn_off_bedroom_lights_when_blinds_are_open'

  triggers:
    - trigger: state
      entity_id: cover.bedroom_closet_blinds
      from: 'closed'
      to: 'opening'
    - trigger: state
      entity_id: cover.bedroom_closet_blinds
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: light.bedroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: not
      conditions:
      - condition: state
        entity_id: light.closet_lamp
        attribute: effect
        state: "Plantgrowth"

  actions:
    - action: light.turn_off
      entity_id:
        - light.bedroom_lights

        ##########################################################
        ## Open Bedroom Blinds at 9a When Away
        ##########################################################

- alias: Blinds - Open Bedroom Blinds at 9a When Away
  id: 'blinds_open_bedroom_blinds_at_9a_when_away'

  triggers:
   - trigger: time
     at: '09:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 85
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.bedroom_closet_blinds_center
          - cover.bedroom_closet_blinds_left
        position: 40

        ##########################################################
        ## Close Bedroom Blinds at 2p When Away
        ##########################################################

- alias: Blinds - Close Bedroom Blinds at 2p When Away
  id: 'blinds_close_bedroom_blinds_at_2p_when_away'

  triggers:
   - trigger: time
     at: '14:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds_center
          - cover.bedroom_closet_blinds_left

#################################################################
## Kitchen
#################################################################

        ##########################################################
        ## Open Kitchen South Blind at Sunrise
        ##########################################################

- alias: Blinds - Open Kitchen South Blind at Sunrise
  id: 'blinds_open_kitcen_south_blind_at_sunrise'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '00:60:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: cover.kitchen_blinds_south
      state: 'closed'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 95
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.kitchen_blinds_south

        ##########################################################
        ## Open Kitchen Blinds when Home
        ##########################################################

- alias: Blinds - Open Kitchen Blinds when Home
  id: 'blinds_open_kitcen_blinds_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: sun
      before: sunset
      before_offset: "-01:31:00"
    - condition: state
      entity_id: cover.kitchen_blinds
      state: 'closed'
    - condition: state
      entity_id: cover.kitchen_blinds_south
      state: 'closed'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 95
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.kitchen_blinds_south
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.kitchen_blinds_west
        position: 20

        ##########################################################
        ## Open Kitchen West Blind at 9a
        ##########################################################

- alias: Blinds - Open Kitchen West Blind at 9a
  id: 'blinds_open_kitchen_west_blind_at_9a'

  triggers:
   - trigger: time
     at: '09:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: cover.kitchen_blinds_west
      state: 'closed'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 90
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 20
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 95
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 20

  actions:
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.kitchen_blinds_west
        position: 20

        ##########################################################
        ## Close Kitchen West Blind Before Sunset
        ##########################################################

- alias: Blinds - Close Kitchen West Blind Before Sunset
  id: 'blinds_close_kitchen_west_blind_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-01:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.kitchen_blinds_west
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.kitchen_blinds_west

        ##########################################################
        ## Close Kitchen South Blind Before Sunset
        ##########################################################

- alias: Blinds - Close Kitchen South Blind Before Sunset
  id: 'blinds_close_kitchen_south_blind_before_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_blinds
      state: 'off'
    - condition: state
      entity_id: cover.kitchen_blinds_south
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.kitchen_blinds_south

#################################################################
## Pico Remotes
#################################################################

  #################################################################
  ## Kitchen Blinds Open Pico Remote
  #################################################################

- alias: Blinds - Kitchen Blinds Open Pico Remote
  id: 'blinds_kitchen_blinds_open_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 2
        action: press

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.kitchen_blinds

  #################################################################
  ## Kitchen Blinds Close Pico Remote
  #################################################################

- alias: Blinds - Kitchen Blinds Close Pico Remote
  id: 'blinds_kitchen_blinds_close_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 4
        action: press

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.kitchen_blinds

  #################################################################
  ## Kitchen Raise Blinds Pico Remote Press
  #################################################################

- alias: Blinds - Kitchen Raise Blinds Pico Remote Press
  id: 'blinds_kitchen_blinds_raise_pico_remote_press'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 5
        action: press

  actions:
    - action: cover.open_cover
      entity_id:
        - cover.kitchen_blinds

  #################################################################
  ## Kitchen Raise Blinds Pico Remote Release
  #################################################################

- alias: Blinds - Kitchen Raise Blinds Pico Remote Release
  id: 'blinds_kitchen_blinds_raise_pico_remote_release'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 5
        actions: release

  actions:
    - action: cover.stop_cover
      entity_id:
        - cover.kitchen_blinds

  #################################################################
  ## Kitchen Lower Blinds Pico Remote Press
  #################################################################

- alias: Blinds - Kitchen Lower Blinds Pico Remote Press
  id: 'blinds_kitchen_blinds_lower_pico_remote_press'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 6
        action: press

  actions:
    - action: cover.close_cover
      entity_id:
        - cover.kitchen_blinds

  #################################################################
  ## Kitchen Lower Blinds Pico Remote Release
  #################################################################

- alias: Blinds - Kitchen Lower Blinds Pico Remote Release
  id: 'blinds_kitchen_blinds_lower_pico_remote_release'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 6
        actions: release

  actions:
    - action: cover.stop_cover
      entity_id:
        - cover.kitchen_blinds

  #################################################################
  ## Kitchen Blinds Reset Pico Remote
  #################################################################

- alias: Blinds - Kitchen Blinds Reset Pico Remote
  id: 'blinds_kitchen_blinds_reset_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91735138
        button_number: 3
        action: press

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.kitchen_blinds_south
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.kitchen_blinds_west
        position: 20

  #################################################################
  ## Bedroom Closet Open Blinds Pico Remote
  #################################################################

- alias: Blinds - Bedroom Closet Open Pico Remote
  id: 'blinds_bedroom_closet_open_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'closed'

  actions:
    - action: cover.open_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds

  #################################################################
  ## Bedroom Closet Closet Blinds Pico Remote
  #################################################################

- alias: Blinds - Bedroom Closet Close Pico Remote
  id: 'blinds_bedroom_closet_close_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 3
        action: press
  
  conditions:
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds

#################################################################
## Bugs
#################################################################

        ##########################################################
        ## Fix Blinds Stuck in Opening State
        ##########################################################

- alias: Blinds - Fix Stuck in Opening State
  id: 'blinds_fix_stuck_in_opening_state'
  
  mode: parallel
  triggers:
    - trigger: state
      entity_id:
        - cover.kitchen_blinds
        - cover.bedroom_closet_blinds
        - cover.USER1_s_office_blinds
        - cover.USER2_s_office_blinds
        - cover.stairs_blinds
      to: 'opening'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: cover.stop_cover
      target:
        entity_id: "{{ trigger.entity_id }}"

        ##########################################################
        ## Fix Blinds Stuck in Closing State
        ##########################################################

- alias: Blinds - Fix Stuck in Closing State
  id: 'blinds_fix_stuck_in_closing_state'
  
  mode: parallel
  triggers:
    - trigger: state
      entity_id:
        - cover.kitchen_blinds
        - cover.bedroom_closet_blinds
        - cover.USER1_s_office_blinds
        - cover.USER2_s_office_blinds
        - cover.stairs_blinds
      to: 'closing'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: cover.stop_cover
      target:
        entity_id: "{{ trigger.entity_id }}"

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Blinds Low Battery Notification
        ##########################################################

- alias: Blinds - Low Battery Notification
  id: 'blinds_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.USER1s_office_blinds_center
          - sensor.USER1s_office_blinds_left
          - sensor.USER1s_office_blinds_right
          - sensor.bedroom_closet_blinds_center
          - sensor.bedroom_closet_blinds_left
          - sensor.bedroom_closet_blinds_right
          - sensor.USER2s_office_blinds_left
          - sensor.USER2s_office_blinds_right
          - sensor.stairs_blinds_left
          - sensor.stairs_blinds_right
          - sensor.kitchen_blinds_south
          - sensor.kitchen_blinds_west
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low Battery"#################################################################
## Bug Zapper Automations
#################################################################

        ##########################################################
        ## Turn On Bug Zapper at Sunset
        ##########################################################

- alias: Bug Zapper - Turn On Bug Zapper at Sunset
  id: 'bug_zapper_turn_on_bug_zapper_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:30:00'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: switch.bug_zapper
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.bug_zapper

        ##########################################################
        ## Turn Off Bug Zapper at Sunrise
        ##########################################################

- alias: Bug Zapper - Turn Off Bug Zapper at Sunrise
  id: 'bug_zapper_turn_off_bug_zapper_at_sunrise'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+00:15:00'

  conditions:
    - condition: state
      entity_id: switch.bug_zapper
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.bug_zapper

        ##########################################################
        ## Turn Off Bug Zapper in the Rain
        ##########################################################

- alias: Bug Zapper - Turn Off Bug Zapper in the Rain
  id: 'bug_zapper_turn_off_bug_zapper_in_the_rain'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      to: 'rainy'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      to: 'lightning-rainy'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: switch.bug_zapper
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.bug_zapper

        ##########################################################
        ## Turn On Bug Zapper After Rain Stops
        ##########################################################

- alias: Bug Zapper - Turn On Bug Zapper After Rain Stops
  id: 'bug_zapper_turn_on_bug_zapper_after_rain_stops'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      from: 'rainy'

  conditions:
    - condition: state
      entity_id: switch.bug_zapper
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.bug_zapper

        ##########################################################
        ## Turn On Bug Zapper when Returning Home
        ##########################################################

- alias: Bug Zapper - Turn On Bug Zapper when Returning Home
  id: 'bug_zapper_turn_bug_zapper_when_returning_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: switch.bug_zapper
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.bug_zapper

        ##########################################################
        ## Turn On Bug Zapper when Returning Home before Sunset
        ##########################################################

- alias: Bug Zapper - Turn On Bug Zapper when Returning Home before Sunset
  id: 'bug_zapper_turn_on_bug_zapper_when_returning_home_before_sunset'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: switch.bug_zapper
      state: 'off'
    - condition: sun
      after: sunset
      after_offset: "-00:30:00"
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.bug_zapper
#################################################################
## Camera Automations
#################################################################

        ##########################################################
        ## Package Camera On
        ##########################################################

- alias: Camera - Package Camera On
  id: 'camera_package_camera_on'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_package_detected
      to: 'on'
    #- trigger: state
    #  entity_id: binary_sensor.front_door_camera_person_detected
    #  to: 'on'
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.view_package_camera
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.view_package_camera

        ##########################################################
        ## Package Camera Off
        ##########################################################

- alias: Camera - Package Camera Off
  id: 'camera_package_camera_off'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.view_package_camera
        state: 'on'
      - condition: state
        entity_id: input_boolean.package_camera_notification
        state: 'on'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.view_package_camera
          - input_boolean.package_camera_notification

        ##########################################################
        ## Package Camera Off at Midnight
        ##########################################################

- alias: Camera - Package Camera Off at Midnight
  id: 'camera_package_camera_off_at_midnight'

  triggers:
   - trigger: time
     at: '23:59:00'

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.view_package_camera
        state: 'on'
      - condition: state
        entity_id: input_boolean.package_camera_notification
        state: 'on'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.view_package_camera
          - input_boolean.package_camera_notification

        ##########################################################
        ## Turn On Front Porch Lights when Doorbell Rings
        ##########################################################

- alias: Camera - Turn On Front Porch Lights when Rung
  id: 'camera_turn_on_front_porch_lights_when_rung'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 100

        ##########################################################
        ## Reset Front Porch Lights Brightness After Doorbell Rings
        ##########################################################

- alias: Camera - Reset Front Porch Lights Brightness After Ring
  id: 'camera_reset_front_porch_lights_brightness_after_ring'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 50
        transition: 900

        ##########################################################
        ## Turn On Front Porch Lights when Motion Detected
        ##########################################################

- alias: Camera - Turn On Front Porch Lights when Motion Detected
  id: 'camera_turn_on_front_porch_lights_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.front_porch_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.front_yard_camera_person_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 100

        ##########################################################
        ## Reset Front Porch Lights Brightness After Motion Detected
        ##########################################################

- alias: Camera - Reset Front Porch Lights Brightness After Motion Detected
  id: 'camera_reset_front_porch_lights_brightness_after_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.front_porch_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.front_yard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: state
      entity_id: light.front_porch
      state: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 50
        transition: 900

        ##########################################################
        ## Turn On Lights when Doorbell Rings and Away
        ##########################################################

- alias: Camera - Turn On Lights when Ring and Away
  id: 'camera_turn_on_lights_when_ring_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off Lights After Doorbell Rings and Away
        ##########################################################

- alias: Camera - Turn Off Lights After Ring and Away
  id: 'camera_turn_off_lights_after_ring_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 16
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights
      data:
        transition: 900
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_sink
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 1
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
        brightness_pct: 1

        ##########################################################
        ## Turn On Lights when Motion Detected and Away
        ##########################################################

- alias: Camera - Turn On Lights when Motion Detected and Away
  id: 'camera_turn_on_lights_when_motion_detected_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.front_porch_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.front_yard_camera_person_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off Lights After Motion Detected and Away
        ##########################################################

- alias: Camera - Turn Off Lights After Motion Detected and Away
  id: 'camera_turn_off_lights_after_motion_detected_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 16
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.front_porch_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 16
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.front_yard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 16
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights
      data:
        transition: 900
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_sink
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 1
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
        brightness_pct: 1

        ##########################################################
        ## Turn On Backyard Lights when Motion Detected and Away
        ##########################################################

- alias: Camera - Turn On Backyard Lights when Motion Detected and Away
  id: 'camera_turn_on_backyard_lights_when_motion_detected_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.backyard_gate_camera_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.backyard_camera_person_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.side_yard_camera_person_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.back_door
        state: 'off'
      - condition: state
        entity_id: light.backyard_deck
        state: 'off'
      - condition: state
        entity_id: light.backyard_patio
        state: 'off'
      - condition: state
        entity_id: switch.backyard_lighting
        state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_patio
      data:
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_deck
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 100

        ##########################################################
        ## Reset Backyard Lights After Motion Detected and Away
        ##########################################################

- alias: Camera - Reset Backyard Lights After Motion Detected and Away
  id: 'camera_reset_backyard_lights_after_motion_detected_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.backyard_gate_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.backyard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.side_yard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: time
      before: '23:59:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.back_door
        state: 'on'
      - condition: state
        entity_id: light.backyard_deck
        state: 'on'
      - condition: state
        entity_id: light.backyard_patio
        state: 'on'
      - condition: state
        entity_id: switch.backyard_lighting
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn Off Backyard Lights After Motion Detected and Away
        ##########################################################

- alias: Camera - Turn Off Backyard Lights After Motion Detected and Away
  id: 'camera_turn_off_backyard_lights_after_motion_detected_and_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.backyard_gate_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.backyard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.side_yard_camera_person_detected
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: time
      after: '00:00:00'
      before: '05:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.back_door
        state: 'on'
      - condition: state
        entity_id: light.backyard_deck
        state: 'on'
      - condition: state
        entity_id: light.backyard_patio
        state: 'on'
      - condition: state
        entity_id: switch.backyard_lighting
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door

        ##########################################################
        ## Household Away Turn Off Camera Privacy Mode
        ##########################################################

- alias: Camera - Household Away Turn Off Privacy Mode
  id: 'camera_household_away_turn_off_privacy_mode'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.secondary_switch_basement_camera_poe
    - delay: '00:02:00'
    - action: switch.turn_off
      target:
        entity_id:
          - switch.basement_camera_privacy_mode
          - switch.living_room_camera_privacy_mode
          - switch.kitchen_camera_privacy_mode
          - switch.USER1_office_camera_privacy_mode

        ##########################################################
        ## Household Away Turn On Camera Privacy Mode
        ##########################################################

- alias: Camera - Household Away Turn On Privacy Mode
  id: 'camera_household_home_turn_on_privacy_mode'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.basement_camera_privacy_mode
          - switch.living_room_camera_privacy_mode
          - switch.kitchen_camera_privacy_mode
          - switch.USER1_office_camera_privacy_mode
    - delay: '00:05:00'
    - action: switch.turn_off
      target:
        entity_id:
          - switch.secondary_switch_basement_camera_poe

        ##########################################################
        ## Turn on Front Yard Camera Infrared after Sunset
        ##########################################################

- alias: Camera - Turn on Front Yard Infrared after Sunset
  id: 'camera_turn_on_front_yard_infrared_after_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '00:17:00'

  conditions:
    - condition: state
      entity_id: binary_sensor.front_yard_camera_is_dark
      state: 'off'
    - condition: state
      entity_id: select.front_yard_camera_infrared_mode
      state: "Auto"

  actions:
    - action: select.select_option
      data:
        entity_id: select.front_yard_camera_infrared_mode
        option: "Always Enable"

        ##########################################################
        ## Reset Front Yard Infrared at 4a
        ##########################################################

- alias: Camera - Reset Front Yard Infrared at 4a
  id: 'camera_reset_front_yard_infrared_at_4a'

  triggers:
   - trigger: time
     at: '04:00:00'

  conditions:
    - condition: state
      entity_id: select.front_yard_camera_infrared_mode
      state: "Always Enable"

  actions:
    - action: select.select_option
      data:
        entity_id: select.front_yard_camera_infrared_mode
        option: "Auto"

        ##########################################################
        ## Turn on Front Porch Camera Infrared after Sunset
        ##########################################################

- alias: Camera - Turn on Front Porch Infrared after Sunset
  id: 'camera_turn_on_front_porch_infrared_after_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '00:17:00'

  conditions:
    - condition: state
      entity_id: binary_sensor.front_porch_camera_is_dark
      state: 'off'
    - condition: state
      entity_id: select.front_porch_camera_infrared_mode
      state: "Auto"

  actions:
    - action: select.select_option
      data:
        entity_id: select.front_porch_camera_infrared_mode
        option: "Always Enable"

        ##########################################################
        ## Reset Front Porch Infrared at 4a
        ##########################################################

- alias: Camera - Reset Front Porch Infrared at 4a
  id: 'camera_reset_front_porch_infrared_at_4a'

  triggers:
   - trigger: time
     at: '04:00:00'

  conditions:
    - condition: state
      entity_id: select.front_porch_camera_infrared_mode
      state: "Always Enable"

  actions:
    - action: select.select_option
      data:
        entity_id: select.front_porch_camera_infrared_mode
        option: "Auto"

#################################################################
## Notifications
#################################################################

    #################################################################
    ## Person Detected at Front Door
    #################################################################

- alias: Camera - Person Detected in Front Door
  id: 'camera_person_detected_in_front_door'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected at Front Door!
        data:
          tag: front_door_person_camera
          entity_id: camera.front_door
    - delay: '00:05:00'

    #################################################################
    ## Person Detected on Front Porch
    #################################################################

- alias: Camera - Person Detected in Front Porch
  id: 'camera_person_detected_in_front_porch'
  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.front_porch_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected on Front Porch!
        data:
          tag: front_porch_person_camera
          entity_id: camera.front_porch
    - delay: '00:05:00'

    #################################################################
    ## Person Detected in Front Yard
    #################################################################

- alias: Camera - Person Detected in Front Yard
  id: 'camera_person_detected_in_front_yard'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.front_yard_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected in Front Yard!
        data:
          tag: front_yard_person_camera
          entity_id: camera.front_yard
    - delay: '00:05:00'

    #################################################################
    ## Person Detected in Backyard
    #################################################################

- alias: Camera - Person Detected in Backyard
  id: 'camera_person_detected_in_backyard'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.backyard_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected in Backyard!
        data:
          tag: backyard_person_camera
          entity_id: camera.backyard
    - delay: '00:05:00'

    #################################################################
    ## Person Detected at Backyard Gate
    #################################################################

- alias: Camera - Person Detected at Backyard Gate
  id: 'camera_person_detected_at_backyard_gate'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.backyard_gate_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected at Backyard Gate!
        data:
          tag: backyard_gate_person_camera
          entity_id: camera.backyard_gate
    - delay: '00:05:00'

    #################################################################
    ## Person Detected in Side Yard
    #################################################################

- alias: Camera - Person Detected in Side Yard
  id: 'camera_person_detected_in_side_yard'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.side_yard_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected in Side Yard!
        data:
          tag: side_yard_person_camera
          entity_id: camera.side_yard
    - delay: '00:05:00'

    #################################################################
    ## Person Detected in Garage
    #################################################################

- alias: Camera - Person Detected in Garage
  id: 'camera_person_detected_in_garage'

  mode: single
  triggers:
    - trigger: state
      entity_id: binary_sensor.garage_camera_person_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Person Detected in Garage!
        data:
          tag: garage_person_camera
          entity_id: camera.garage
    - delay: '00:05:00'

        ##########################################################
        ## Doorbell iOS USER1 Notification
        ##########################################################

- alias: Camera - Doorbell iOS USER1 Notification
  id: 'camera_doorbell_ios_USER1_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
      
  actions:
    - action: notify.USER1_devices
      data:
        message: Someone is at the Front Door
        data:
          tag: doorbell
          entity_id: camera.front_door
          actions:
            - action: "unlock_front_door"
              title: "Unlock Front Door"
              destructive: true
              activationMode: background

        ##########################################################
        ## Doorbell iOS USER2 Notification
        ##########################################################

- alias: Camera - Doorbell iOS USER2 Notification
  id: 'camera_doorbell_ios_USER2_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
      
  actions:
    - action: notify.USER2_devices
      data:
        message: Someone is at the Front Door
        data:
          tag: doorbell
          entity_id: 
           - camera.front_door
          actions:
            - action: "unlock_front_door"
              title: "Unlock Front Door"
              destructive: true
              activationMode: background

        ##########################################################
        ## Package iOS Notification
        ##########################################################

- alias: Camera - Package iOS Notification
  id: 'camera_package_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_package_detected
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id:  input_boolean.package_camera_notification
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Package Detected on Front Porch
        data:
          tag: package
          entity_id: camera.front_door
    - action: notify.USER2_devices
      data:
        message: Package Detected on Front Porch
        data:
          tag: package
          entity_id: camera.front_door
    - delay: '00:00:30'
    - action: homeassistant.turn_on
      entity_id:
        - input_boolean.package_camera_notification#################################################################
## Christmas Automations
#################################################################

        ##########################################################
        ## Turn on Exterior Christmas Lights at Sunset
        ##########################################################

- alias: Christmas - Turn on Exterior Christmas Lights at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:15:00'

  condition:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'Christmas'
        - condition: state
          entity_id: sensor.holidays_calendar
          state: "New Year's Eve"

  action:
    - service: switch.turn_on
      entity_id:
        - switch.exterior_christmas_lights

        ##########################################################
        ## Turn Off Exterior Christmas Lights at 2a
        ##########################################################

- alias: Christmas - Turn Off Exterior Christmas Lights at 2a

  trigger:
   - platform: time
     at: '02:00:00'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.exterior_christmas_lights

        ##########################################################
        ## Turn Off Exterior Christmas Lights at Sunrise
        ##########################################################

- alias: Christmas - Turn Off Exterior Christmas Lights at Sunrise

  trigger:
    - platform: sun
      event: 'sunrise'
      offset: '+00:15:00'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.exterior_christmas_lights

        ##########################################################
        ## Turn off Christmas Lights after 2a
        ##########################################################

- alias: Christmas - Turn off Christmas Lights after 2a

  trigger:
    - platform: state
      entity_id: switch.exterior_christmas_lights
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  condition:
    - condition: time
      after: '02:00'
      before: '07:30'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.exterior_christmas_lights

        ##########################################################
        ## Turn on Christmas Lights when Home
        ##########################################################

- alias: Christmas - Turn on Christmas Lights when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: switch.exterior_christmas_lights
      state: 'off'
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'Christmas'
        - condition: state
          entity_id: sensor.holidays_calendar
          state: "New Year's Eve"
    - condition: or
      conditions:
        - condition: state
          entity_id: input_boolean.USER1_away
          state: 'on'
        - condition: state
          entity_id: input_boolean.USER2_away
          state: 'on'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.exterior_christmas_lights

        ##########################################################
        ## Christmas Tree Away Mode
        ##########################################################

- alias: Christmas - Tree Away Mode

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Christmas Tree Home Mode
        ##########################################################

- alias: Christmas - Tree Home Mode

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 45

  condition:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.USER1_away
        state: 'on'
      - condition: state
        entity_id: input_boolean.USER2_away
        state: 'on'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn on Christmas Tree at Sunset
        ##########################################################

- alias: Christmas - Turn on Christmas Tree at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:30:00'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_interior_lights_sunset
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn on Christmas Tree when Sun Below Horizon
        ##########################################################

- alias: Christmas - Turn on Christmas Tree when Sun Below Horizon

  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_interior_lights_sunset
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn on Christmas Tree when USER2 Home
        ##########################################################

- alias: Christmas - Turn on Tree when USER2 Home

  trigger:
    - platform: time
      at: '08:00:00'

  condition:
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn off Christmas Tree when USER2 Leaves
        ##########################################################

- alias: Christmas - Turn off Tree when USER2 Leaves

  trigger:
    - platform: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: time
      after: '05:00'
      before: '15:00'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn on Christmas Tree when USER2 Arrives Home
        ##########################################################

- alias: Christmas - Turn on Christmas Tree when USER2 Arrives Home

  trigger:
    - platform: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  condition:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: time
      after: '08:30'
      before: '18:00'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Plex Stopped Playing Christmas Tree On
        ##########################################################

- alias: Christmas - Plex Stopped Playing Tree On

  trigger:
    - platform: state
      entity_id: media_player.plex_living_room_appletv
      to: 'paused'
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - platform: state
      entity_id: media_player.plex_living_room_appletv
      to: 'idle'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Plex Playing Christmas Tree Off
        ##########################################################

- alias: Christmas - Plex Playing Tree Off

  trigger:
    - platform: state
      entity_id: media_player.plex_living_room_appletv
      to: 'playing'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Late Night TV Watching before Midnight Christmas Tree on
        ##########################################################

- alias: Christmas - Late Night TV Watching before Midnight Tree on

  trigger:
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 3
        seconds: 0
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '21:30'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Late Night TV Watching after Midnight Christmas Tree on
        ##########################################################

- alias: Christmas - Late Night TV Watching after Midnight Tree on

  trigger:
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 3
        seconds: 0
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '00:00'
      before: '03:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Late Night TV Watching after Midnight Christmas Tree On
        ##########################################################

- alias: Christmas - Late Night TV Watching after Midnight Tree On

  trigger:
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 3
        seconds: 0
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '00:00'
      before: '03:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Late Night TV Watching after Midnight Christmas Tree off
        ##########################################################

- alias: Christmas - Late Night TV Watching after Midnight Tree off

  trigger:
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '00:00'
      before: '03:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Late Night TV Watching before Midnight Christmas Tree Off
        ##########################################################

- alias: Christmas - Late Night TV Watching before Midnight Tree Off

  trigger:
    - platform: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '21:30'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Christmas Tree Bedtime
        ##########################################################

- alias: Christmas - Tree Bedtime

  trigger:
    - platform: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn off Christmas Tree When Playing Xbox
        ##########################################################

- alias: Christmas - Turn off Christmas Tree When Playing Xbox

  trigger:
    - platform: state
      entity_id: select.living_room_tv_activities
      to: 'Play Xbox'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.friends_and_family
        state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '05:00:00'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'on'

  action:
    - service: switch.turn_off
      entity_id:
        - switch.christmas_tree

        ##########################################################
        ## Turn on Christmas Tree When Done Playing Xbox
        ##########################################################

- alias: Christmas - Turn on Christmas Tree When Done Playing Xbox

  trigger:
    - platform: state
      entity_id: select.living_room_tv_activities
      from: 'Play Xbox'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '05:00:00'
    - condition: state
      entity_id: switch.christmas_tree
      state: 'off'

  action:
    - service: switch.turn_on
      entity_id:
        - switch.christmas_tree#################################################################
## Thermostat Automations
#################################################################

        ##########################################################
        ## Thermostat eco+ Enabled
        ##########################################################

- alias: Climate - Thermostat eco+ Enabled
  id: 'climate_thermostat_eco_plus_enabled'

  triggers:
    - trigger: state
      entity_id: binary_sensor.thermostat_eco_plus_enabled
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: ecobee.resume_program
      data:
        entity_id: climate.main_floor
    - action: notify.USER1_devices
      data:
        message: Ecobee eco+ Detected - Disabling
        data:
          tag: climate

        ##########################################################
        ## Set Thermostat Home
        ##########################################################

- alias: Climate - Home
  id: 'climate_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away
    - delay: '00:00:30'
    - action: ecobee.set_fan_min_on_time
      data:
        entity_id: climate.main_floor
        fan_min_on_time: '15'

        ##########################################################
        ## Set Thermostat Away
        ##########################################################

- alias: Climate - Away
  id: 'climate_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      below: 85
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_low
      above: 20

  actions:
    - action: notify.USER1_devices
      data:
        message: House has been empty for an hour, shutting Off HVAC
        data:
          tag: climate
    - action: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - delay: '00:00:30'
    - action: ecobee.set_fan_min_on_time
      data:
        entity_id: climate.main_floor
        fan_min_on_time: '0'

        ##########################################################
        ## Turn Off Humidifier When Water Main Shuts Off
        ##########################################################

- alias: Climate - Turn Off Humidifier When Water Main Shuts Off
  id: 'climate_turn_off_humidifier_when_water_main_shuts_off'

  triggers:
    - trigger: state
      entity_id: valve.water_main
      from: 'open'
      to: 'closed'
      for:
        hours: 0
        minutes: 5
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: humidifier.main_floor
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'

  actions:
    - action: humidifier.set_mode
      data:
        mode: "off"
      target:
        entity_id: humidifier.main_floor

        ##########################################################
        ## Turn On Humidifier When Water Main Turns On
        ##########################################################

- alias: Climate - Turn On Humidifier When Water Main Turns On
  id: 'climate_turn_on_humidifier_when_water_main_turns_on'

  triggers:
    - trigger: state
      entity_id: valve.water_main
      from: 'closed'
      to: 'open'
      for:
        hours: 0
        minutes: 15
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: humidifier.main_floor
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'

  actions:
    - action: humidifier.set_mode
      data:
        mode: "auto"
      target:
        entity_id: humidifier.main_floor

        ##########################################################
        ## Thermostat On Demand Home
        ##########################################################

- alias: Climate - On Demand Home
  id: 'climate_on_demand_home'

  triggers:
    - trigger: state
      entity_id: input_boolean.thermostat_away
      from: 'on'
      to: 'off'

  actions:
    - action: ecobee.resume_program
      data:
        entity_id: climate.main_floor
        resume_all: true

        ##########################################################
        ## Thermostat On Demand Away
        ##########################################################

- alias: Climate - On Demand Away
  id: 'climate_on_demand_away'

  triggers:
    - trigger: state
      entity_id: input_boolean.thermostat_away
      from: 'off'
      to: 'on'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'away_indefinitely'

        ##########################################################
        ## Turn Thermostat On Summer
        ##########################################################

- alias: Climate - Turn Thermostat On Summer
  id: 'climate_turn_thermostat_on_summer'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 68
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'on'
    - condition: state
      entity_id: sensor.season
      state: 'summer'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp above 68 turning On AC
        data:
          tag: climate

        ##########################################################
        ## Turn Thermostat Off Summer
        ##########################################################

- alias: Climate - Turn Thermostat Off Summer
  id: 'climate_turn_thermostat_off_summer'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 65
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: sensor.season
      state: 'summer'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp below 65 shutting Off AC
        data:
          tag: climate

        ##########################################################
        ## Turn Thermostat On Winter
        ##########################################################

- alias: Climate - Turn Thermostat On Winter
  id: 'climate_turn_thermostat_on_winter'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 65
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'on'
    - condition: state
      entity_id: sensor.season
      state: 'winter'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp below 65 turning On Heat
        data:
          tag: climate

        ##########################################################
        ## Turn Thermostat Off Winter
        ##########################################################

- alias: Climate - Turn Thermostat Off Winter
  id: 'climate_turn_thermostat_off_winter'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 65
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: sensor.season
      state: 'winter'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp above 65 turning Off Heat
        data:
          tag: climate

        ##########################################################
        ## Turn Thermostat On Spring/Fall
        ##########################################################

- alias: Climate - Turn Thermostat On Spring/Fall
  id: 'climate_turn_thermostat_on_spring_fall'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 65
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 82
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'spring'
      - condition: state
        entity_id: sensor.season
        state: 'autumn'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp below 65 or above 78 turning On HVAC
        data:
          tag: climate

        ##########################################################
        ## Turn Thermostat Off Spring/Fall
        ##########################################################

- alias: Climate - Turn Thermostat Off Spring/Fall
  id: 'climate_turn_thermostat_off_spring_fall'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 65
      below: 75
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'spring'
      - condition: state
        entity_id: sensor.season
        state: 'autumn'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Outside temp above 65 or below 78 turning Off HVAC
        data:
          tag: climate

        ##########################################################
        ## Winter Season Turn On Heat
        ##########################################################

- alias: Climate - Winter Season Turn On Heat
  id: 'climate_winter_season_turn_on_heat'

  triggers:
    - trigger: state
      entity_id: sensor.season
      to: 'winter'

  actions:
    - action: climate.set_hvac_mode
      data:
        entity_id: climate.main_floor
        hvac_mode: heat

        ##########################################################
        ## Spring Season HVAC Auto
        ##########################################################

- alias: Climate - Spring Season HVAC Auto
  id: 'climate_spring_season_hvac_auto'

  triggers:
    - trigger: state
      entity_id: sensor.season
      to: 'spring'

  actions:
    - action: climate.set_hvac_mode
      data:
        entity_id: climate.main_floor
        hvac_mode: 'heat_cool'

        ##########################################################
        ## Summer Season Turn On Cool
        ##########################################################

- alias: Climate - Summer Season Turn On Cool
  id: 'climate_summer_season_turn_on_cool'

  triggers:
    - trigger: state
      entity_id: sensor.season
      to: 'summer'

  actions:
    - action: climate.set_hvac_mode
      data:
        entity_id: climate.main_floor
        hvac_mode: cool

        ##########################################################
        ## Fall Season HVAC Auto
        ##########################################################

- alias: Climate - Fall Season HVAC Auto
  id: 'climate_fall_season_hvac_auto'

  triggers:
    - trigger: state
      entity_id: sensor.season
      to: 'autumn'

  actions:
    - action: climate.set_hvac_mode
      data:
        entity_id: climate.main_floor
        hvac_mode: 'heat_cool'

        ##########################################################
        ## Set Thermostat Home When USER2 Leaves Work
        ##########################################################

- alias: Climate - Set Climate Home When USER2 Leaves Work
  id: 'climate_set_climate_home_when_USER2_leaves_work'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away

        ##########################################################
        ## Turn Off Thermostat when Door Opens for Extended Period
        ##########################################################

- alias: Climate - Turn Off when Door Opens for Extended Period
  id: 'climate_turn_off_when_door_opens_for_extended_period'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - action: notify.USER1_devices
      data:
        message: Door has been left open, shutting Off AC
        data:
          tag: climate

        ##########################################################
        ## Adjust Thermostat for Overnight Guests before Midnight
        ##########################################################

- alias: Climate - Turn On Guest Settings before Midnight
  id: 'climate_turn_on_guest_settings_before_midnight'

  triggers:
    - trigger: time
      at: '23:31:00'

  conditions:
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.overnight_guest_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_bedroom_portable_ac
      state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Guest'

        ##########################################################
        ## Adjust Thermostat for Overnight Guests after Midnight
        ##########################################################

- alias: Climate - Turn On Guest Settings after Midnight
  id: 'climate_turn_on_guest_settings_after_midnight'

  triggers:
    - trigger: state
      entity_id: input_boolean.overnight_guest_mode
      to: 'on'

  conditions:
    - condition: time
      after: '00:00:00'
      before: '04:59:00'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_bedroom_portable_ac
      state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Guest'

        ##########################################################
        ## Reset Thermostat when USER2 Leaves
        ##########################################################

- alias: Climate - Reset Thermostat when USER2 Leaves
  id: 'climate_reset_thermostat_when_USER2_leaves'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: time
      after: '06:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: ecobee.resume_program
      data:
        entity_id: climate.main_floor
        resume_all: true

        ##########################################################
        ## Adjust Thermostat to Upstairs Mode in the Morning
        ##########################################################

- alias: Climate - Adjust Thermostat to Upstairs Mode in the Morning
  id: 'climate_adjust_thermostat_to_upstairs_mode_in_the_morning'

  triggers:
    - trigger: time
      at: '10:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'heat'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'off'
    - condition: numeric_state
      entity_id: sensor.REDACTED_forecasted_temperature_high
      above: 79
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.USER1_office_portable_ac
        state: 'off'
      - condition: state
        entity_id: input_boolean.USER2_office_portable_ac
        state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Upstairs'

        ##########################################################
        ## Adjust Thermostat to Upstairs Mode when Hot Between 12-7
        ##########################################################

- alias: Climate - Adjust Thermostat to Upstairs Mode when Hot Between 12-7
  id: 'climate_adjust_thermostat_to_upstairs_mode_when_hot_between_12_7'


  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 80
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'heat'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: time
      after: '12:00:00'
      before: '19:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.USER1_office_portable_ac
        state: 'off'
      - condition: state
        entity_id: input_boolean.USER2_office_portable_ac
        state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Upstairs'

        ##########################################################
        ## Reset Thermostat at 10p if On Upstairs Mode
        ##########################################################

- alias: Climate - Reset Thermostat at 10p if On Upstairs Mode
  id: 'climate_reset_thermostat_at_10p_if_on_upstairs_mode'

  triggers:
    - trigger: time
      at: '22:00:00'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: sensor.thermostat_climate_mode
      state: 'Upstairs'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: ecobee.resume_program
      data:
        entity_id: climate.main_floor
        resume_all: true

#################################################################
## Fireplace
#################################################################

        #################################################################
        ## Adjust Thermostat if Fireplace On
        #################################################################

- alias: Climate - Adjust Thermostat if Fireplace On
  id: 'climate_adjust_thermostat_if_fireplace_on'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.season
      state: 'winter'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Fireplace'

        #################################################################
        ## Reset Thermostat when Fireplace Off
        #################################################################

- alias: Climate - Reset Thermostat when Fireplace Off
  id: 'climate_reset_thermostat_when_fireplace_off'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.season
      state: 'winter'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.thermostat_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'

  actions:
    - action: ecobee.resume_program
      data:
        entity_id: climate.main_floor
        resume_all: true

        #################################################################
        ## Fireplace Warning iOS Notification
        #################################################################

- alias: Climate - Fireplace On when Nobody Home iOS Notification
  id: 'climate_fireplace_on_when_nobody_home_ios_notification'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: notify.USER1_devices
      data:
        message: Fireplace Turned On!
        data:
          tag: fireplace-climate
          push:
          actions:
            - action: "fireplace_off"
              title: "Turn Off Fireplace"
              destructive: true
              activationMode: background

        #################################################################
        ## Fireplace On for 4 Hours iOS Notification
        #################################################################

- alias: Climate - Fireplace On for 4 Hours iOS Notification
  id: 'climate_fireplace_on_for_4_hours_ios_notification'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      from: 'off'
      to: 'on'
      for:
        hours: 4
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Fireplace has been On for 4 Hours
        data:
          tag: fireplace-climate
          actions:
            - action: "fireplace_off"
              title: "Turn Off Fireplace"
              destructive: true
              activationMode: background

  #################################################################
  ## Fireplace On Pico Remote
  #################################################################

- alias: Climate - Fireplace On Pico Remote
  id: 'climate_fireplace_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: switch.fireplace
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fireplace
    - delay:
        seconds: 30

  #################################################################
  ## Fireplace Off Pico Remote
  #################################################################

- alias: Climate - Fireplace Off Pico Remote
  id: 'climate_fireplace_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: switch.fireplace
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fireplace
    - delay:
        seconds: 30

  #################################################################
  ## Fireplace On Living Room West Pico Remote
  #################################################################

- alias: Climate - Fireplace On Living Room West Pico Remote
  id: 'climate_fireplace_on_living_room_west_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: switch.fireplace
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fireplace
    - delay:
        seconds: 30

  #################################################################
  ## Fireplace Off Living Room West Pico Remote
  #################################################################

- alias: Climate - Fireplace Off Living Room West Pico Remote
  id: 'climate_fireplace_off_living_room_west_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: switch.fireplace
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fireplace
    - delay:
        seconds: 30

#################################################################
## Office Fan / Heater / Air Purifier
#################################################################

        ##########################################################
        ## Turn On Office Fan Heat when Cold Outside
        ##########################################################

- alias: Climate - Turn On Office Fan Heat when Cold Outside
  id: 'climate_turn_on_office_fan_heat_when_cold_outside'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: sensor.season
      state: 'winter'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: fan.USER1s_office_fan
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'

  actions:
    - action: fan.turn_on
      target:
        entity_id:
          - fan.USER1s_office_fan
    - delay: '00:00:01'
    - action: fan.set_preset_mode
      target:
        entity_id: fan.USER1s_office_fan
      data:
        preset_mode: Auto
    - delay: '00:00:01'
    - action: climate.set_temperature
      data:
        entity_id: climate.office_fan
        temperature: 74
        hvac_mode: heat
    - delay: '00:00:01'
    - action: fan.oscillate
      data:
        entity_id: fan.USER1s_office_fan
        oscillating: 'true'

        ##########################################################
        ## Turn Off Office Fan Heat when warmer Outside
        ##########################################################

- alias: Climate - Turn Off Office Fan Heat when warmer Outside
  id: 'climate_turn_off_office_fan_heat_when_warmer_outside'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: state
      entity_id: sensor.season
      state: 'winter'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: fan.USER1s_office_fan
      state: 'on'

  actions:
    - action: fan.turn_on
      target:
        entity_id:
          - fan.USER1s_office_fan
    - delay: '00:00:01'
    - action: fan.set_preset_mode
      target:
        entity_id:
          - fan.USER1s_office_fan
      data:
        preset_mode: Auto
    - delay: '00:00:01'
    - action: climate.set_hvac_mode
      data:
        entity_id: climate.office_fan
        hvac_mode: cool
    - delay: '00:00:01'
    - action: fan.oscillate
      data:
        entity_id: fan.USER1s_office_fan
        oscillating: 'true'

#################################################################
## Portable AC
#################################################################

        ##########################################################
        ## Adjust Thermostat for Portable AC at 9:30a
        ##########################################################

- alias: Climate - Adjust Thermostat for Portable AC at 9:30a
  id: 'climate_adjust_thermostat_for_portable_ac_at_9:30a'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Downstairs'

        ##########################################################
        ## Adjust Thermostat for Portable AC when Enabled
        ##########################################################

- alias: Climate - Adjust Thermostat for Portable when Enabled
  id: 'climate_adjust_thermostat_for_portable_ac_when_enabled'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_office_portable_ac
      to: 'on'
    - trigger: state
      entity_id: input_boolean.USER1_office_portable_ac
      to: 'on'
    - trigger: state
      entity_id: input_boolean.guest_bedroom_portable_ac
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_climate
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'heat'
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.main_floor
        state: 'off'

  actions:
    - action: climate.set_preset_mode
      data:
        entity_id: climate.main_floor
        preset_mode: 'Downstairs'

        ##########################################################
        ## Turn Off Portable AC when Water Bin Full
        ##########################################################

- alias: Climate - Turn Off Portable AC when Water Bin Full
  id: 'climate_turn_off_portable_ac_when_water_bin_full'

  triggers:
    - trigger: state
      entity_id: binary_sensor.portable_ac_water_sensor
      to: 'on'

#  conditions:
#    - condition: not
#      conditions:
#      - condition: state
#        entity_id: climate.portable_air_conditioner
#        state: 'unavailable'
#    - condition: not
#      conditions:
#      - condition: state
#        entity_id: climate.portable_air_conditioner
#        state: 'off'

  actions:
    - action: climate.turn_off
      entity_id: climate.portable_air_conditioner
    - delay: '00:05:00'
    - action: switch.turn_off
      entity_id: switch.portable_ac

        ##########################################################
        ## Turn Off Portable AC if Water Bin Already Full
        ##########################################################

- alias: Climate - Turn Off Portable AC if Water Bin Already Full
  id: 'climate_turn_off_portable_ac_if_water_bin_already_full'

  triggers:
    - trigger: state
      entity_id: climate.portable_air_conditioner
      from: 'off'
      to: 'cool'

  conditions:
    - condition: state
      entity_id: binary_sensor.portable_ac_water_sensor
      state: 'on'

  actions:
    - action: climate.turn_off
      entity_id: climate.portable_air_conditioner
    - action: notify.USER1_devices
      data:
        message: Empty Portable AC Water Bin
        data:
          tag: portable-ac-climate
    - delay: '00:05:00'
    - action: switch.turn_off
      entity_id: switch.portable_ac

        ##########################################################
        ## Turn Off Portable AC when Water Bin Full - iOS Notification
        ##########################################################

- alias: Climate - Turn Off Portable AC when Water Bin Full iOS Notification
  id: 'climate_turn_off_portable_ac_when_water_bin_full_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.portable_ac_water_sensor
      to: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: Empty Portable AC Water Bin
        data:
          tag: portable-ac-climate#################################################################
## Door Automations
#################################################################

        ##########################################################
        ## Turn On Front Porch Lights when Front Door Opens
        ##########################################################

- alias: Doors - Turn On Front Porch Lights when Front Door Opens
  id: 'doors_turn_on_front_porch_lights_when_front_door_opens'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 100

        ##########################################################
        ## Reset Front Porch Lights Brightness when Front Door Closes
        ##########################################################

- alias: Doors - Reset Front Porch Lights Brightness when Front Door Closes
  id: 'doors_reset_front_porch_lights_brightness_when_front_door_closes'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 50
        transition: 120

        ##########################################################
        ## Turn Off Front Porch Lights when Front Door Closes between 12-5a
        ##########################################################

- alias: Doors - Turn Off Front Porch Lights when Front Door Closes between 12-5a
  id: 'doors_turn_off_front_porch_lights_when_front_door_closes_between_12_5a'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '05:00:00'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
      data:
        transition: 900

        ##########################################################
        ## Turn On Living Room Lights when Front Door Opens
        ##########################################################

- alias: Doors - Turn On Living Room Lights when Front Door Opens
  id: 'doors_turn_on_living_room_lights_when_front_door_opens'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: light.living_room_accent_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights

        ##########################################################
        ## Turn On Back Door Lights when Back Door Opens
        ##########################################################

- alias: Doors - Turn On Back Door Lights when Back Door Opens
  id: 'doors_turn_on_back_door_lights_when_back_door_opens'

  triggers:
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
       brightness_pct: 100

        ##########################################################
        ## Reset Back Door Lights Brightness when Back Door Closes
        ##########################################################

- alias: Doors - Reset Back Door Lights Brightness when Back Door Closes
  id: 'doors_reset_back_door_lights_brightness_when_back_door_closes'

  triggers:
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 2
        transition: 300

        ##########################################################
        ## Turn Off Back Door Lights when Back Door Closes between 12-5a
        ##########################################################

- alias: Doors - Turn Off Back Door Lights when Back Door Closes between 12-5a
  id: 'doors_turn_off_back_door_lights_when_back_door_closes_between_12_5a'

  triggers:
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 17
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '05:00:00'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
      data:
        transition: 900

        ##########################################################
        ## Turn On Basement Lights when Basement Door Opens and Lights Off
        ##########################################################

- alias: Doors - Turn On Basement Lights when Basement Door Opens and Lights Off
  id: 'doors_turn_on_basement_lights_when_basement_door_opens_and_lights_off'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.basement_lighting
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
       brightness_pct: 2

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Door Low Battery Notification
        ##########################################################

- alias: Doors - Low Battery Notification
  id: 'doors_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.front_door_sensor_batt
          - sensor.back_door_sensor_batt
          - sensor.basement_door_sensor_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low"#################################################################
## Energy
#################################################################

        ##########################################################
        ## Set Winter Rate First 750
        ##########################################################

- alias: Energy - Set Winter Rate First 750
  id: 'energy_set_winter_rate_first_750'

  trigger:
    - trigger: state
      entity_id: 
          - sensor.monthly_electric

  conditions:
    - condition: template
      value_template: "{{ now().month in [1,2,3,4,5,10,11,12] }}"
    - condition: template
      value_template: '{{ trigger.to_state.state | float(0) < 750000 }}'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.monthly_electric
        state: "Winter Rate First 750"

  actions:
    - action: select.select_option
      data:
        entity_id: select.monthly_electric
        option: "Winter Rate First 750"

        ##########################################################
        ## Set Winter Rate Over 750
        ##########################################################

- alias: Energy - Set Winter Rate Over 750
  id: 'energy_set_winter_rate_over_750'

  trigger:
    - trigger: state
      entity_id: 
          - sensor.monthly_electric

  conditions:
    - condition: template
      value_template: "{{ now().month in [1,2,3,4,5,10,11,12] }}"
    - condition: template
      value_template: '{{ trigger.to_state.state | float(0) > 749999 }}'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.monthly_electric
        state: "Winter Rate Over 750"

  actions:
    - action: select.select_option
      data:
        entity_id: select.monthly_electric
        option: "Winter Rate Over 750"

        ##########################################################
        ## Set Summer Rate
        ##########################################################

- alias: Energy - Set Summer Rate
  id: 'energy_set_summer_rate'

  trigger:
    - trigger: state
      entity_id: 
          - sensor.monthly_electric

  conditions:
    - condition: template
      value_template: "{{ now().month in [6,7,8,9] }}"
    - condition: not
      conditions:
      - condition: state
        entity_id: select.monthly_electric
        state: "Summer Rate"

  actions:
    - action: select.select_option
      data:
        entity_id: select.monthly_electric
        option: "Summer Rate"

        ##########################################################
        ## Turn Off USER1 Electric Bike Chargers when Not Charging
        ##########################################################

- alias: Energy - Turn Off USER1 Electric Bike Chargers when Not Charging
  id: 'energy_turn_off_USER1_ebike_chargers_when_not_charging'

  trigger:
    - trigger: numeric_state
      entity_id: sensor.USER1s_bike_charger_current_consumption
      below: 1
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: switch.USER1s_bike_charger
      state: 'on'

  actions:
    - action: switch.turn_off
      data:
        entity_id: switch.USER1s_bike_charger

        ##########################################################
        ## Turn Off USER2 Electric Bike Chargers when Not Charging
        ##########################################################

- alias: Energy - Turn Off USER2 Electric Bike Chargers when Not Charging
  id: 'energy_turn_off_USER2_ebike_chargers_when_not_charging'

  trigger:
    - trigger: numeric_state
      entity_id: sensor.USER2s_bike_charger_current_consumption
      below: 1
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: switch.USER2s_bike_charger
      state: 'on'

  actions:
    - action: switch.turn_off
      data:
        entity_id: switch.USER2s_bike_charger#################################################################
## Fan Automations
#################################################################

#################################################################
## Pico Remotes
#################################################################

  #################################################################
  ## Living Room Fans On Pico Remote
  #################################################################

- alias: Fan - Living Room Fans On Pico Remote
  id: 'fan_living_room_fans_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'off'

  actions:
    - delay:
        seconds: 1
    - action: fan.turn_on
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans Off Pico Remote
  #################################################################

- alias: Fan - Living Room Fans Off Pico Remote
  id: 'fan_living_room_fans_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'

  actions:
    - delay:
        seconds: 1
    - action: fan.turn_off
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans Off to On Pico Remote Raise or Lower
  #################################################################

- alias: Fan - Living Room Fans Off to On Pico Remote Raise or Lower
  id: 'fan_living_room_fans_off_to_on_pico_remote_raise_or_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'off'

  actions:
    - delay:
        seconds: 1
    - action: fan.turn_on
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 1 to 2 Pico Remote Raise
  #################################################################

- alias: Fan - Living Room Fans 1 to 2 Pico Remote Raise
  id: 'fan_living_room_fans_1_to_2_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 16)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 33
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 2 to 3 Pico Remote Raise
  #################################################################

- alias: Fan - Living Room Fans 2 to 3 Pico Remote Raise
  id: 'fan_living_room_fans_2_to_3_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 33)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 50
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 3 to 4 Pico Remote Raise
  #################################################################

- alias: Fan - Living Room Fans 3 to 4 Pico Remote Raise
  id: 'fan_living_room_fans_3_to_4_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 50)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 66
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 4 to 5 Pico Remote Raise
  #################################################################

- alias: Fan - Living Room Fans 4 to 5 Pico Remote Raise
  id: 'fan_living_room_fans_4_to_5_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 66)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 83
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 5 to 6 Pico Remote Raise
  #################################################################

- alias: Fan - Living Room Fans 5 to 6 Pico Remote Raise
  id: 'fan_living_room_fans_5_to_6_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 83)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 100
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 6 to 5 Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 6 to 5 Pico Remote Lower
  id: 'fan_living_room_fans_6_to_5_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 100)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 83
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 5 to 4 Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 5 to 4 Pico Remote Lower
  id: 'fan_living_room_fans_5_to_4_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 83)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 66
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 4 to 3 Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 4 to 3 Pico Remote Lower
  id: 'fan_living_room_fans_4_to_3_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 66)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 50
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 3 to 2 Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 3 to 2 Pico Remote Lower
  id: 'fan_living_room_fans_3_to_2_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 50)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 33
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 2 to 1 Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 2 to 1 Pico Remote Lower
  id: 'fan_living_room_fans_2_to_1_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 33)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
        percentage: 16
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fans 1 to Off Pico Remote Lower
  #################################################################

- alias: Fan - Living Room Fans 1 to Off Pico Remote Lower
  id: 'fan_living_room_fans_1_to_off_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_fans', 'percentage', 16)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.turn_off
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan Off to On Pico Remote Raise or Lower
  #################################################################

- alias: Fan - West Living Room Fan Off to On Pico Remote Raise or Lower
  id: 'fan_west_living_room_fan_off_to_on_pico_remote_raise_or_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'off'

  actions:
    - delay:
        seconds: 1  
    - action: fan.turn_on
      target:
        entity_id:
          - fan.living_room_west
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 1 to 2 Pico Remote Raise
  #################################################################

- alias: Fan - West Living Room Fan 1 to 2 Pico Remote Raise
  id: 'fan_west_living_room_fan_1_to_2_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 16)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 33
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 2 to 3 Pico Remote Raise
  #################################################################

- alias: Fan - West Living Room Fan 2 to 3 Pico Remote Raise
  id: 'fan_west_living_room_fan_2_to_3_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 33)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 50
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 3 to 4 Pico Remote Raise
  #################################################################

- alias: Fan - West Living Room Fan 3 to 4 Pico Remote Raise
  id: 'fan_west_living_room_fan_3_to_4_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 50)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 66
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 4 to 5 Pico Remote Raise
  #################################################################

- alias: Fan - West Living Room Fan 4 to 5 Pico Remote Raise
  id: 'fan_west_living_room_fan_4_to_5_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 66)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 83
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 5 to 6 Pico Remote Raise
  #################################################################

- alias: Fan - West Living Room Fan 5 to 6 Pico Remote Raise
  id: 'fan_west_living_room_fan_5_to_6_pico_remote_raise'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 5
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 83)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 100
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 6 to 5 Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 6 to 5 Pico Remote Lower
  id: 'fan_west_living_room_fan_6_to_5_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 100)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 83
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 5 to 4 Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 5 to 4 Pico Remote Lower
  id: 'fan_west_living_room_fan_5_to_4_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 83)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 66
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 4 to 3 Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 4 to 3 Pico Remote Lower
  id: 'fan_west_living_room_fan_4_to_3_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 66)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 50
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 3 to 2 Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 3 to 2 Pico Remote Lower
  id: 'fan_west_living_room_fan_3_to_2_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 50)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 33
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 2 to 1 Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 2 to 1 Pico Remote Lower
  id: 'fan_west_living_room_fan_2_to_1_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 33)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.set_percentage
      data:
        entity_id:
          - fan.living_room_west
        percentage: 16
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan 1 to Off Pico Remote Lower
  #################################################################

- alias: Fan - West Living Room Fan 1 to Off Pico Remote Lower
  id: 'fan_west_living_room_fan_1_to_off_pico_remote_lower'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: fan.living_room_west
      state: 'on'
    - condition: template
      value_template: "{{is_state_attr('fan.living_room_west', 'percentage', 16)}}"

  actions:
    - delay:
        seconds: 1
    - action: fan.turn_off
      target:
        entity_id:
          - fan.living_room_west
    - delay:
        seconds: 1#################################################################
## Fountain Automations
#################################################################

        ##########################################################
        ## Fountain Off When Away
        ##########################################################

- alias: Fountain - Fountain Off When Away
  id: 'fountain_off_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fountain
          - switch.fountain_lights

        ##########################################################
        ## Fountain On When Home
        ##########################################################

- alias: Fountain - Fountain On When Home
  id: 'fountain_on_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: time
      after: '12:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: switch.fountain
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 39
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain

        ##########################################################
        ## Fountain Lights On When Home Before Sunset
        ##########################################################

- alias: Fountain - Lights On When Home Before Sunset
  id: 'fountain_lights_on_when_home_before_sunset'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'on'
    - condition: state
      entity_id: switch.fountain_lights
      state: 'off'
    - condition: sun
      after: sunset
      after_offset: "-00:15:00"

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain_lights

        ##########################################################
        ## Turn on Fountain Lights at Sunset
        ##########################################################

- alias: Fountain - Turn on Lights at Sunset
  id: 'fountain_turn_on_lights_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: switch.fountain
      state: 'on'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain_lights

        ##########################################################
        ## Turn on Fountain Lights when Fountain on at Night
        ##########################################################

- alias: Fountain - Turn on Lights when Fountain on at Night
  id: 'fountain_turn_on_lights_when_fountain_on_at_night'

  triggers:
    - trigger: state
      entity_id: switch.fountain
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: switch.fountain_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain_lights

        ##########################################################
        ## Turn off Fountain Lights when Fountain turns off
        ##########################################################

- alias: Fountain - Turn off Lights when Fountain turns off
  id: 'fountain_turn_off_lights_when_fountain_turns_off'

  triggers:
    - trigger: state
      entity_id: switch.fountain
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: switch.fountain_lights
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fountain_lights

        ##########################################################
        ## Turn On Fountain Daily
        ##########################################################

- alias: Fountain - Turn On Daily
  id: 'fountain_turn_on_daily'

  triggers:
   - trigger: time
     at: '10:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 39
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain

        ##########################################################
        ## Turn Off Fountain at Midnight
        ##########################################################

- alias: Fountain - Turn Off at Midnight
  id: 'fountain_turn_off_at_midnight'

  triggers:
   - trigger: time
     at: '23:59:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fountain
          - switch.fountain_lights

        ##########################################################
        ## Turn Off Fountain When Raining
        ##########################################################

- alias: Fountain - Turn Off When Raining
  id: 'fountain_turn_off_when_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      to: 'rainy'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      to: 'lightning-rainy'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fountain

        ##########################################################
        ## Turn On Fountain When Done Raining
        ##########################################################

- alias: Fountain - Turn On When Done Raining
  id: 'fountain_turn_on_when_done_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      from: 'rainy'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      from: 'lightning-rainy'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_fountain
      state: 'off'
    - condition: state
      entity_id: switch.fountain
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: time
      after: '12:00:00'
      before: '23:59:00'
    - condition: numeric_state
      entity_id: sensor.REDACTED_temperature
      above: 39
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.fountain

        ##########################################################
        ## Turn Off Fountain When Cold
        ##########################################################

- alias: Fountain - Turn Off When Cold
  id: 'fountain_turn_off_when_cold'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.REDACTED_temperature
      below: 38
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: switch.fountain
      state: 'on'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.fountain
    - action: notify.USER1_devices
      data:
        message: Cold Outside Shutting Off Fountain
        data:
          tag: fountain#################################################################
## Garage Automations
#################################################################

        ##########################################################
        ## Household Away Mode Close Garage
        ##########################################################

- alias: Garage - Household Away Mode Close Garage
  id: 'garage_household_away_mode_close_garage'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Close Garage Door when USER1 Leaves
        ##########################################################

- alias: Garage - Close Garage when USER1 Leaves
  id: 'garage_close_garage_when_USER1_leaves'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Close Garage Door when USER2 Leaves
        ##########################################################

- alias: Garage - Close Garage when USER2 Leaves
  id: 'garage_close_garage_when_USER2_leaves'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## USER1 Home from Driving Open Garage Door
        ##########################################################

- alias: Garage - USER1 Home from Driving Open Garage Door
  id: 'garage_USER1_home_from_driving_open_garage_door'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_away_driving
      state: 'on'
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'

  actions:
    - action: cover.open_cover
      entity_id: cover.garage_door

        ##########################################################
        ## After USER1 Home Close Garage Windy
        ########################################################

- alias: Garage - USER1 Home Close Garage Windy
  id: 'garage_USER1_home_close_garage_windy'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'windy'
      - condition: numeric_state
        entity_id: weather.REDACTED
        attribute: wind_speed
        above: '13'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door_motor
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## After USER1 Home Close Garage Door
        ########################################################

- alias: Garage - USER1 Home Close Garage
  id: 'garage_USER1_home_close_garage'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door_motor
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## USER2 Home from Driving Open Garage
        ##########################################################

- alias: Garage - USER2 Home from Driving Open Garage
  id: 'garage_USER2_home_from_driving_open_garage'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_away_driving
      state: 'on'
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'

  actions:
    - action: cover.open_cover
      entity_id: cover.garage_door

        ##########################################################
        ## After USER2 Home Close Garage Windy
        ########################################################

- alias: Garage - USER2 Home Close Garage Windy
  id: 'garage_USER2_home_close_garage_windy'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'windy'
      - condition: numeric_state
        entity_id: weather.REDACTED
        attribute: wind_speed
        above: '13'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door_motor
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## After USER2 Home Close Garage Door
        ########################################################

- alias: Garage - USER2 Home Close Garage
  id: 'garage_USER2_home_close_garage'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door_motor
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Close Garage Door after 30 Mins
        ##########################################################

- alias: Garage - Close After 30 Mins
  id: 'garage_close_after_30_mins'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'open'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Garage Door Open On Demand (Echo Integration)
        ##########################################################

- alias: Garage - Open On Demand
  id: 'garage_open_on_demand'

  triggers:
    - trigger: state
      entity_id: input_boolean.garage_door
      to: 'on'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: cover.open_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Garage Door Close On Demand (Echo Integration)
        ##########################################################

- alias: Garage - Close On Demand
  id: 'garage_close_on_demand'

  triggers:
    - trigger: state
      entity_id: input_boolean.garage_door
      to: 'off'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior
    - delay: '00:00:05'
    - action: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Turn Off Garage Door Boolean when Closed
        ##########################################################

- alias: Garage - Turn Off Garage Door Boolean when Closed
  id: 'garage_turn_off_garage_door_boolean_when_closed'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.garage_door

        ##########################################################
        ## Turn On Garage Door Boolean when Open
        ##########################################################

- alias: Garage - Turn On Garage Door Boolean when Open
  id: 'garage_turn_on_garage_door_boolean_when_open'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door

        ##########################################################
        ## Open Garage Door when USER2 Leaves for Work
        ##########################################################

- alias: Garage - USER2 Leaving for Work Open Garage
  id: 'garage_USER2_leaving_for_work_open_garage'

  triggers:
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: time
      after: '06:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'
    - condition: state
      entity_id: input_boolean.garage_door_motor
      state: 'off'

  actions:
    - action: cover.open_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Flash Light When Garage Door Motor On
        ##########################################################

- alias: Garage - Flash Light When Garage Motor On
  id: 'garage_flash_light_when_garage_motor_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.garage_door_motor
      to: 'on'

  actions:
    - action: lifx.effect_pulse
      data:
        cycles: 5
        power_on: true
        brightness_pct: 100
      target:
        entity_id: light.garage_interior

        ##########################################################
        ## Garage Door Motor On
        ##########################################################

- alias: Garage - Door Motor On
  id: 'garage_door_motor_on'

  triggers:
    - trigger: event
      event_type: call_service
      event_data:
        domain: cover
        service: close_cover
        service_data:
          entity_id: cover.garage_door
    - trigger: event
      event_type: call_service
      event_data:
        domain: cover
        service: open_cover
        service_data:
          entity_id: cover.garage_door

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.garage_door_motor

        ##########################################################
        ## Garage Door Motor Off
        ##########################################################

- alias: Garage - Door Motor Off
  id: 'garage_door_motor_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.garage_door_motor
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 18

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.garage_door_motor

#################################################################
## Notifications
#################################################################

        #################################################################
        ## Garage Open iOS Notification
        #################################################################

- alias: Garage - Open iOS Notification
  id: 'garage_open_ios_notification'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Garage Door Open
        data:
          tag: garage-open
          entity_id: camera.garage
          actions:
            - action: "close_garage"
              title: "Close Garage Door"
              destructive: true
              activationMode: background

        #################################################################
        ## Garage Closed iOS Notification
        #################################################################

- alias: Garage - Closed iOS Notification
  id: 'garage_closed_ios_notification'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Garage Door Closed
        data:
          tag: garage-closed
          entity_id: camera.garage
          actions:
            - action: "open_garage"
              title: "Open Garage Door"
              destructive: true
              activationMode: background

        #################################################################
        ## Garage Door Still Open iOS Notification
        #################################################################

- alias: Garage - Door Still Open iOS Notification
  id: 'garage_door_still_open_ios_notification'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'open'
      for:
        hours: 0
        minutes: 35
        seconds: 0
    - trigger: state
      entity_id: cover.garage_door
      to: 'closing'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: cover.garage_door
      to: 'opening'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Garage Door is Still Open!
        data:
          tag: garage-still-open
          entity_id: camera.garage
          actions:
            - action: "close_garage"
              title: "Close Garage Door"
              destructive: true
              activationMode: background##################################################################
## Holiday Automations
##################################################################

        ##########################################################
        ## Enable Christmas Lighting
        ##########################################################

- alias: Holiday - Enable Christmas Lighting
  id: 'holiday_enable_christmas_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: sensor.holidays_calendar
          state: 'Christmas Eve'
        - condition: state
          entity_id: sensor.holidays_calendar
          state: 'Christmas Day'

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Christmas'

        ##########################################################
        ## Christmas Lighting
        ##########################################################

- alias: Holiday - Christmas Lighting
  id: 'holiday_christmas_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: green
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: red

        ##########################################################
        ## Christmas Lighting Rotate Colors
        ##########################################################

- alias: Holiday - Christmas Lighting Rotate Colors
  id: 'holiday_christmas_lighting_rotate_colors'

  triggers:
    trigger: time_pattern
    minutes: /1

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'
    - condition: state
      entity_id: light.front_porch
      state: 'on'
    - condition: time
      after: '15:30:00'
      before: '02:00:00'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 5
        brightness_pct: 100
        color_name: '{{ states(''input_select.exterior_christmas_light_color_left'') }}'
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 5
        brightness_pct: 100
        color_name: '{{ states(''input_select.exterior_christmas_light_color_right'') }}'
    - action: input_select.select_option
      target:
        entity_id: input_select.exterior_christmas_light_color_left
      data:
        option: >
          {{ state_attr('input_select.exterior_christmas_light_color_left', 'options')
              | reject('eq', states('input_select.exterior_christmas_light_color_left'))
              | reject('eq', states('input_select.exterior_christmas_light_color_right'))
              | list | random }}
    - action: input_select.select_option
      target:
        entity_id: input_select.exterior_christmas_light_color_right
      data:
        option: >
          {{ state_attr('input_select.exterior_christmas_light_color_right', 'options')
              | reject('eq', states('input_select.exterior_christmas_light_color_right'))
              | reject('eq', states('input_select.exterior_christmas_light_color_left'))
              | list | random }}

        ##########################################################
        ## Enable New Years Eve Lighting
        ##########################################################

- alias: Holiday - Enable New Years Eve Lighting
  id: 'holiday_enable_new_years_eve_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: sensor.holidays_calendar
          state: "New Year's Eve"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: "New Year's Eve"

        ##########################################################
        ## New Years Eve Lighting
        ##########################################################

- alias: Holiday - New Years Eve Lighting
  id: 'holiday_new_years_eve_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "New Year's Eve"

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.front_porch_rainbow

        ##########################################################
        ## Enable Halloween Lighting
        ##########################################################

- alias: Holiday - Enable Halloween Lighting
  id: 'holiday_enable_halloween_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: 'Halloween'

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Halloween'

        ##########################################################
        ## Halloween Lighting
        ##########################################################

- alias: Holiday - Halloween Lighting
  id: 'holiday_halloween_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        rgb_color: [255,85,7]
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        rgb_color: [160,6,255]

        ##########################################################
        ## Halloween Lighting Rotate on the Hour
        ##########################################################

- alias: Holiday - Halloween Lighting Rotate on the Hour
  id: 'holiday_halloween_lighting_rotate_on_the_hour'

  triggers:
    trigger: time_pattern
    minutes: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00:00'
      before: '23:45:00'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [160,6,255]
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [255,85,7]

        ##########################################################
        ## Halloween Lighting Rotate 15 mins after the Hour
        ##########################################################

- alias: Holiday - Halloween Lighting Rotate 15 mins after the Hour
  id: 'holiday_halloween_lighting_rotate_15_mins_after_the_hour'

  triggers:
    trigger: time_pattern
    minutes: 15

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00:00'
      before: '23:45:00'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [255,85,7]
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [160,6,255]

        ##########################################################
        ## Halloween Lighting Rotate 30 Mins after the Hour
        ##########################################################

- alias: Holiday - Halloween Lighting Rotate 30 Mins after the Hour
  id: 'holiday_halloween_lighting_rotate_30_mins_after_the_hour'

  triggers:
    trigger: time_pattern
    minutes: 30

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00:00'
      before: '23:45:00'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [160,6,255]
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [255,85,7]

        ##########################################################
        ## Halloween Lighting Rotate 45 Mins After the Hour
        ##########################################################

- alias: Holiday - Halloween Lighting Rotate 45 Mins After the Hour
  id: 'holiday_halloween_lighting_rotate_45_mins_after_the_hour'

  triggers:
    trigger: time_pattern
    minutes: 45

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00:00'
      before: '23:45:00'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: [255,85,7]
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 2
        brightness_pct: 100
        rgb_color: 152,39,25

        ##########################################################
        ## Enable St. Patricks Day Lighting
        ##########################################################

- alias: Holiday - Enable St. Patricks Day Lighting
  id: 'holiday_enable_st_patricks_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "St. Patrick's Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: "St. Patricks Day"

        ##########################################################
        ## St. Patricks Day Lighting
        ##########################################################

- alias: Holiday - St. Patricks Day Lighting
  id: 'holiday_st_patricks_day_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "St. Patrick's Day"

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: green
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: green

        ##########################################################
        ## Enable Valentine's Day Lighting
        ##########################################################

- alias: Holiday - Enable Valentine's Day Lighting
  id: 'holiday_enable_valentines_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Valentine's Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: "Valentine's Day"

        ##########################################################
        ## Valentine's Day Lighting
        ##########################################################

- alias: Holiday - Valentine's Day Lighting
  id: 'holiday_valendtines_day_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "Valentine's Day"

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: "deeppink"
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: "deeppink"

        ##########################################################
        ## Cardinals Game Lighting
        ##########################################################

- alias: Holiday - Cardinals Game Lighting
  id: 'holiday_cardinals_game_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Cardinals Game'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: red
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: red

        ##########################################################
        ## Blues Game Lighting
        ##########################################################

- alias: Holiday - Blues Game Lighting
  id: 'holiday_blues_game_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Blues Game'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: blue
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: blue

        ##########################################################
        ## Enable Easter Lighting
        ##########################################################

- alias: Holiday - Enable Easter Lighting
  id: 'holiday_enable_easter_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Easter Sunday"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Easter'

        ##########################################################
        ## Easter Lighting
        ##########################################################

- alias: Holiday - Easter Lighting
  id: 'holiday_easter_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Easter'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: "indigo"
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: "tomato"

        ##########################################################
        ## Enable Thanksgiving Lighting
        ##########################################################

- alias: Holiday - Enable Thanksgiving Lighting
  id: 'holiday_enable_thanksgiving_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Thanksgiving Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Thanksgiving'


        ##########################################################
        ## Thanksgiving Lighting
        ##########################################################

- alias: Holiday - Thanksgiving Lighting
  id: 'holiday_thanksgiving_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Thanksgiving'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: "darkorange"
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: "yellow"

        ##########################################################
        ## Enable Independence Day Lighting
        ##########################################################

- alias: Holiday - Enable Independence Day Lighting
  id: 'holiday_enable_independence_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Independence Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Independence Day'

        ##########################################################
        ## Enable Memorial Day Lighting
        ##########################################################

- alias: Holiday - Enable Memorial Day Lighting
  id: 'holiday_enable_memorial_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Memorial Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Memorial Day'

        ##########################################################
        ## Enable Veterans Day Lighting
        ##########################################################

- alias: Holiday - Enable Veterans Day Lighting
  id: 'holiday_enable_veterans_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Veterans Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Veterans Day'

        ##########################################################
        ## Enable Labor Day Lighting
        ##########################################################

- alias: Holiday - Enable Labor Day Lighting
  id: 'holiday_enable_labor_day_lighting'

  triggers:
    - trigger: state
      entity_id: calendar.holiday
      to: 'on'
      for:
        hours: 9
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: sensor.holidays_calendar
      state: "Labor Day"

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: 'Labor Day'

        ##########################################################
        ## Independence / Memorial / Veterans / Labor Day Lighting
        ##########################################################

- alias: Holiday - Independence / Memorial / Veterans / Labor Day Lighting
  id: 'holiday_independence_memorial_veterans_labor_day_lighting'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'Labor Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Memorial Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Independence Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Veterans Day'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness_pct: 100
        color_name: blue
    - action: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness_pct: 100
        color_name: red

        ##########################################################
        ## Turn Off Holiday Lighting at 2:00 am
        ##########################################################

- alias: Holiday - Turn Off Lighting at 2a
  id: 'holiday_turn_off_lighting_at_2a'

  triggers:
    - trigger: time
      at: '01:59:00'

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: "New Year's Eve"
        - condition: state
          entity_id: input_select.holiday
          state: 'Christmas'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'None'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.front_porch_rainbow
    - delay: '00:00:60'
    - action: light.turn_off
      entity_id: light.front_porch
    - delay: '00:00:60'
    - action: light.turn_off
      entity_id: light.front_porch
    - delay: '00:00:90'
    - action: light.turn_off
      entity_id: light.front_porch

        ##########################################################
        ## Reset Holiday Lighting at 4a
        ##########################################################

- alias: Holiday - Reset Lighting at 4a
  id: 'holiday_reset_lighting_at_4a'

  triggers:
    - trigger: time
      at: '04:00:00'

  conditions:
    - condition: or
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: "St. Patrick's Day"
        - condition: state
          entity_id: input_select.holiday
          state: 'Easter'
        - condition: state
          entity_id: input_select.holiday
          state: "Valentine's Day"
        - condition: state
          entity_id: input_select.holiday
          state: 'Thanksgiving'
        - condition: state
          entity_id: input_select.holiday
          state: 'Labor Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Memorial Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Independence Day'
        - condition: state
          entity_id: input_select.holiday
          state: 'Veterans Day'
        - condition: state
          entity_id: input_select.holiday
          state: "New Year's Eve"
        - condition: state
          entity_id: input_select.holiday
          state: 'Cardinals Game'
        - condition: state
          entity_id: input_select.holiday
          state: 'Blues Game'

  actions:
    - action: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: "None"#################################################################
## iOS Action Automations
#################################################################

        #################################################################
        ## Bedtime
        #################################################################

- alias: iOS Action - Bedtime
  id: 'ios_action_bedtime'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Bedtime'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.bedtime

        #################################################################
        ## Arm Alarm Home
        #################################################################

- alias: iOS Action - Arm Alarm Home
  id: 'ios_action_arm_alarm_home'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Arm Alarm Home'

  actions:
    - action: alarm_control_panel.alarm_arm_home
      entity_id: alarm_control_panel.alarm

        #################################################################
        ## Arm Alarm Away
        #################################################################

- alias: iOS Action - Arm Alarm Away
  id: 'ios_action_arm_alarm_away'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Arm Alarm Away'

  actions:
    - action: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.alarm

        #################################################################
        ## Disarm Alarm
        #################################################################

- alias: iOS Action - Disarm Alarm
  id: 'ios_action_disarm_alarm'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Disarm Alarm'

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

        #################################################################
        ## Toggle Garage Door
        #################################################################

- alias: iOS Action - Toggle Garage Door
  id: 'ios_action_automation_toogle_garage_door'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Toggle Garage Door'

  actions:
    - action: cover.toggle
      target:
        entity_id: cover.garage_door
      data: {}

        #################################################################
        ## Toggle Fireplace
        #################################################################

- alias: iOS Action - Toggle Fireplace
  id: 'ios_action_automation_toogle_fireplace'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Toggle Fireplace'

  actions:
    - action: switch.toggle
      target:
        entity_id: switch.fireplace
      data: {}

        #################################################################
        ## Unlock Front Door
        #################################################################

- alias: iOS Action - Unlock Front Door
  id: 'ios_action_automation_unlock_front_door'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Unlock Front Door'

  actions:
    - action: lock.unlock
      target:
        entity_id: lock.front_door
      data: {}

        #################################################################
        ## Unlock Back Door
        #################################################################

- alias: iOS Action - Unlock Back Door
  id: 'ios_action_automation_unlock_back_door'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Unlock Back Door'

  actions:
    - action: lock.unlock
      target:
        entity_id: lock.back_door
      data: {}

        #################################################################
        ## Unlock Basement Door
        #################################################################

- alias: iOS Action - Unlock Basement Door
  id: 'ios_action_automation_unlock_basement_door'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Unlock Basement Door'

  actions:
    - action: lock.unlock
      target:
        entity_id: lock.basement_door
      data: {}

        #################################################################
        ## Lock Doors
        #################################################################

- alias: iOS Action - Lock Doors
  id: 'ios_action_automation_lock_doors'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Lock Doors'

  actions:
    - action: lock.lock
      target:
        entity_id: 
          - lock.front_door
          - lock.back_door
          - lock.basement_door
      data: {}

        #################################################################
        ## Toggle Living Room Fans
        #################################################################

- alias: iOS Action - Toggle Living Room Fans
  id: 'ios_action_automation_toggle_living_room_fans'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Toggle Living Room Fans'

  actions:
    - action: fan.toggle
      target:
        entity_id: fan.living_room_fans
      data: {}

        #################################################################
        ## Living Room Fans Increase Speed
        #################################################################

- alias: iOS Action - Living Room Fans Increase Speed
  id: 'ios_action_automation_living_room_fans_increase_speed'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Living Room Fans Increase Speed'

  actions:
    - action: fan.increase_speed
      target:
        entity_id: fan.living_room_fans
      data: {}

        #################################################################
        ## Living Room Fans Decrease Speed
        #################################################################

- alias: iOS Action - Living Room Fans Decrease Speed
  id: 'ios_action_automation_living_room_fans_decrease_speed'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Living Room Fans Decrease Speed'

  actions:
    - action: fan.decrease_speed
      target:
        entity_id: fan.living_room_fans
      data: {}

        #################################################################
        ## Party Mode
        #################################################################

- alias: iOS Action - Party Mode
  id: 'ios_action_automation_party_mode'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Party Mode'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'winter'

  actions:
    - action: homeassistant.toggle
      target:
        entity_id: 
          - input_boolean.livingroom_rainbow
          - input_boolean.bedroom_rainbow
          - input_boolean.pop_music
      data: {}
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "Watch TV"

        #################################################################
        ## Party Mode TV On
        #################################################################

- alias: iOS Action - Party Mode TV On
  id: 'ios_action_automation_party_mode_tv_on'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Party Mode'

  conditions:
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "power_off"

  actions:
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "Watch TV"

        #################################################################
        ## Party Mode Winter
        #################################################################

- alias: iOS Action - Party Mode Winter
  id: 'ios_action_automation_party_mode_winter'

  triggers:
    - trigger: event
      event_type: ios.action_fired
      event_data:
        actionName: 'Party Mode'

  conditions:
    - condition: state
      entity_id: sensor.season
      state: 'winter'

  actions:
    - action: homeassistant.toggle
      target:
        entity_id: 
          - input_boolean.livingroom_rainbow
          - input_boolean.bedroom_rainbow
          - input_boolean.pop_music
      data: {}
    - action: switch.toggle
      target:
        entity_id: 
          - switch.fireplace
      data: {}
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "Watch TV"

#################################################################
## iOS Actionable Notifications
#################################################################

        #################################################################
        ## Unlock Doors
        #################################################################

- alias: iOS Action - Unlock Doors
  id: 'ios_action_unlock_doors'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "unlock_doors"

  actions:
    - action: lock.unlock
      target:
        entity_id:
          - lock.back_door
          - lock.front_door

        #################################################################
        ## Unlock Front Door
        #################################################################

- alias: iOS Action - Unlock Front Door
  id: 'ios_action_unlock_front_door'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "unlock_front_door"

  actions:
    - action: lock.unlock
      target:
        entity_id:
          - lock.front_door

        #################################################################
        ## Close Garage
        #################################################################

- alias: iOS Action - Close Garage
  id: 'ios_action_close_garage'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "close_garage"

  actions:
    - action: cover.close_cover
      entity_id: cover.garage_door

        #################################################################
        ## Open Garage
        #################################################################

- alias: iOS Action - Open Garage
  id: 'ios_action_open_garage'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "open_garage"

  actions:
    - action: cover.open_cover
      entity_id: cover.garage_door

        #################################################################
        ## Disarm Alarm
        #################################################################

- alias: iOS Action - Silence Alarm
  id: 'ios_action_silence_alarm'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "disarm_alarm"

  actions:
    - action: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.alarm

        #################################################################
        ## Enable Alarm
        #################################################################

- alias: iOS Action - Enable Alarm
  id: 'ios_action_enable_alarm'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "arm_alarm"

  actions:
    - action: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.alarm

        #################################################################
        ## Siren Off
        #################################################################

- alias: iOS Action - Siren
  id: 'ios_action_siren'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "siren_off"

  actions:
    - action: switch.turn_off
      entity_id: switch.siren

        #################################################################
        ## Fireplace Off
        #################################################################

- alias: iOS Action - Fireplace Off
  id: 'ios_action_fireplace_off'

  triggers:
    - trigger: event
      event_type: mobile_app_notification_action
      event_data:
        action: "fireplace_off"

  actions:
    - action: switch.turn_off
      entity_id: switch.fireplace
#################################################################
## Laundry Automations
#################################################################

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Washing Machine Done - USER1 iOS Notification
        ##########################################################

- alias: Laundry - Washing Machine Done USER1 iOS Notification
  id: 'laundry_washing_machine_done_USER1_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washer_wash_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Washing Machine Finished
        data:
          tag: washer

        ##########################################################
        ## Dryer Done - USER1 iOS Notification
        ##########################################################

- alias: Laundry - Dryer Done USER1 iOS Notification
  id: 'laundry_dryer_done_USER1_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dryer_dry_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Dryer Finished
        data:
          tag: dryer

        ##########################################################
        ## Washing Machine Done - USER2 iOS Notification
        ##########################################################

- alias: Laundry - Washing Machine Done USER2 iOS Notification
  id: 'laundry_washing_machine_done_USER2_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washer_wash_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER2_devices
      data:
        message: Washing Machine Finished
        data:
          tag: washer

        ##########################################################
        ## Dryer Done - USER2 iOS Notification
        ##########################################################

- alias: Laundry - Dryer Done USER2 iOS Notification
  id: 'laundry_dryer_done_USER2_ios_notficiation'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dryer_dry_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER2_devices
      data:
        message: Dryer Finished
        data:
          tag: dryer

        ##########################################################
        ## Washing Machine Done - Audio Notification
        ##########################################################

- alias: Laundry - Washing Machine Done Audio Notification
  id: 'laundry_washing_machine_done_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washer_wash_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '20:00:00'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Washing Machine Has Finished"
        media_content_type: "music"
        extra:
          volume: 45

        ##########################################################
        ## Dryer Done - Audio Notification
        ##########################################################

- alias: Laundry - Dryer Done Audio Notification
  id: 'laundry_dryer_done_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dryer_dry_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '20:00:00'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Dryer Has Finished"
        media_content_type: "music"
        extra:
          volume: 45

        ##########################################################
        ## Washer Run Tub Clean Notification
        ##########################################################

- alias: Laundry - Washer Run Tub Clean Notification
  id: 'laundry_washer_run_tub_clean_notification'

  triggers:
    - trigger: numeric_state
      entity_id: sensor.washer_tub_clean
      above: 29

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Time to Run a Tub Clean Cycler on the Washer
        data:
          tag: washer-clean#################################################################
## LED Clock Automations
#################################################################

  ##########################################################
  ## Universal Device Control
  ##########################################################

        ##########################################################
        ## Bedtime 
        ##########################################################

- alias: LED Clock - Bedtime
  id: 'led_clock_bedtime'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock
        - light.living_room_clock
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/temp
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/temp

        ##########################################################
        ## Household Away Mode LED Clock
        ##########################################################

- alias: LED Clock - Household Away Mode
  id: 'led_clock_household_away_mode'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock
        - light.living_room_clock
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state

  ##########################################################
  ## Universal Apps
  ##########################################################

      ##########################################################
      ## Weather App
      ##########################################################

- alias: LED Clock - Weather App
  id: 'led_clock_weather_app'

  triggers:
    - trigger: time_pattern
      minutes: '/30'
    - trigger: state
      entity_id: weather.REDACTED

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/weather
        payload: >-
          { 
          "icon": "weather_{{ states("sensor.weather_condition_lcd_clock_icon") |regex_replace(find='-', replace='_', ignorecase=False) }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.weather_condition_human_readable") }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/weather
        payload: >-
          { 
          "icon": "weather_{{ states("sensor.weather_condition_lcd_clock_icon") |regex_replace(find='-', replace='_', ignorecase=False) }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.weather_condition_human_readable") }}"
          }

      ##########################################################
      ## Temperature App
      ##########################################################

- alias: LED Clock - Temperature App
  id: 'led_clock_temperature_app'

  triggers:
    - trigger: time_pattern
      minutes: '/30'
    - trigger: state
      entity_id: sensor.REDACTED_temperature

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/temperature
        payload: >-
          { 
          "icon": "{{ states("sensor.outdoor_temp_range") }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_temperature") }}F"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/temperature
        payload: >-
          { 
          "icon": "{{ states("sensor.outdoor_temp_range") }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_temperature") }}F"
          }

      ##########################################################
      ## Humidity App
      ##########################################################

- alias: LED Clock - Humidity App
  id: 'led_clock_humidity_app'

  triggers:
    - trigger: time_pattern
      minutes: '/30'
    - trigger: state
      entity_id: sensor.REDACTED_humidity

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/humidity
        payload: >-
          { 
          "icon": "humid_2",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_humidity") }}%"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/humidity
        payload: >-
          { 
          "icon": "humid_2",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_humidity") }}%"
          }

      ##########################################################
      ## MK4S MMU3 Print Progress App
      ##########################################################

- alias: LED Clock - MK4S MMU3 Print Progress App
  id: 'led_clock_mk4s_mmu3_print_progress_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MMU: {{ states("sensor.prusa_mk4s_mmu3_progress") |round }}%"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MMU: {{ states("sensor.prusa_mk4s_mmu3_progress") |round }}%"
          }

      ##########################################################
      ## MK4S MMU3 3D Print Time Remaining App
      ##########################################################

- alias: LED Clock - MK4S MMU3 Print Time Remaining App
  id: 'led_clock_mk4s_mmu3_print_time_remaining_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MMU: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk4s_mmu3_print_finish')) - as_timestamp(now()))) }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MMU: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk4s_mmu3_print_finish')) - as_timestamp(now()))) }}"
          }

      ##########################################################
      ## MK4S MMU3 3D Print Clear When Idle
      ##########################################################

- alias: LED Clock - MK4S MMU3 3D Print Clear When Idle
  id: 'led_clock_mk4s_mmu3_3d_print_clear_when_idle'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'idle'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_time_remaining

      ##########################################################
      ## MK4S MMU3 3D Print Complete App
      ##########################################################

- alias: LED Clock - MK4S MMU3 3D Print Complete App
  id: 'led_clock_mk4s_mmu3_3d_print_complete_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_mmu3_time_remaining
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MMU: Finished"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_mmu3_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MMU: Finished"
          }

      ##########################################################
      ## MK4S Print Progress App
      ##########################################################

- alias: LED Clock - mk4s_ Print Progress App
  id: 'led_clock_mk4s_print_progress_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK4: {{ states("sensor.prusa_mk4s_progress") |round }}%"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK4: {{ states("sensor.prusa_mk4s_progress") |round }}%"
          }

      ##########################################################
      ## MK4S 3D Print Time Remaining App
      ##########################################################

- alias: LED Clock - MK4S Print Time Remaining App
  id: 'led_clock_mk4s_print_time_remaining_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK4: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk4s_print_finish')) - as_timestamp(now()))) }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK4: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk4s_print_finish')) - as_timestamp(now()))) }}"
          }

      ##########################################################
      ## MK4S 3D Print Clear When Idle
      ##########################################################

- alias: LED Clock - MK4S 3D Print Clear When Idle
  id: 'led_clock_mk4s_3d_print_clear_when_idle'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      to: 'idle'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_time_remaining

      ##########################################################
      ## MK4S 3D Print Complete App
      ##########################################################

- alias: LED Clock - MK4S 3D Print Complete App
  id: 'led_clock_mk4s_3d_print_complete_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk4s_time_remaining
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MK4: Finished"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk4s_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MK4: Finished"
          }

      ##########################################################
      ## MK3.5 Print Progress App
      ##########################################################

- alias: LED Clock - MK3.5 Print Progress App
  id: 'led_clock_mk3_5_print_progress_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk3_5_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk3_5
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK3: {{ states("sensor.prusa_mk3_5_progress") |round }}%"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_progress
        payload: >-
          { 
          "icon": "3d_print",
          "pushIcon": 0,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK3: {{ states("sensor.prusa_mk3_5_progress") |round }}%"
          }

      ##########################################################
      ## MK3.5 3D Print Time Remaining App
      ##########################################################

- alias: LED Clock - MK3.5 Print Time Remaining App
  id: 'led_clock_mk3_5_print_time_remaining_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk3_5_progress
  
  conditions:
    - condition: state
      entity_id: sensor.prusa_mk3_5
      state: 'printing'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK3: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk3_5_print_finish')) - as_timestamp(now()))) }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_time_remaining
        payload: >-
          { 
          "icon": "clock",
          "pushIcon": 2,
          "color": [255,98,0],
          "repeat": 3,
          "text": "MK3: {{ relative_time(now() - timedelta( seconds = as_timestamp(states('sensor.prusa_mk3_5_print_finish')) - as_timestamp(now()))) }}"
          }

      ##########################################################
      ## MK3.5 3D Print Clear When Idle
      ##########################################################

- alias: LED Clock - MK3.5 3D Print Clear When Idle
  id: 'led_clock_mk3_5_3d_print_clear_when_idle'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk3_5
      to: 'idle'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_time_remaining

      ##########################################################
      ## MK3.5 3D Print Complete App
      ##########################################################

- alias: LED Clock - MK3.5 3D Print Complete App
  id: 'led_clock_mk3_5_3d_print_complete_app'

  triggers:
    - trigger: state
      entity_id: sensor.prusa_mk3_5
      from: 'printing'
      to: 'finished'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_progress
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/mk3_5_time_remaining
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MK3: Finished"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_progress
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/mk3_5_time_remaining
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "3d_print_complete",
          "pushIcon": 0,
          "rainbow": true,
          "duration": 60,
          "text": "MK3: Finished"
          }

      ##########################################################
      ## Washing Machine Status App
      ##########################################################

- alias: LED Clock - Washing Machine Status App
  id: 'led_clock_washing_machine_status_app'

  triggers:
    - trigger: state
      entity_id: sensor.washing_machine_time_remaining

  conditions:
    - condition: state
      entity_id: sensor.washer
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/washer
        payload: >-
          { 
          "icon": "washer",
          "pushIcon": 2,
          "repeat": 3,
          "color": [0,255,255],
          "text": "Washer: {{ states("sensor.washing_machine_time_remaining") }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/washer
        payload: >-
          { 
          "icon": "washer",
          "pushIcon": 2,
          "repeat": 3,
          "color": [0,255,255],
          "text": "Washer: {{ states("sensor.washing_machine_time_remaining") }}"
          }

      ##########################################################
      ## Washing Machine Done App
      ##########################################################

- alias: LED Clock - Washing Machine Done App
  id: 'led_clock_washing_machine_done_app'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washer_wash_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/washer
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "washer",
          "pushIcon": 0,
          "duration": 60,
          "color": [0,255,255],
          "text": "Washer Finished"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/washer
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "washer",
          "pushIcon": 0,
          "duration": 60,
          "color": [0,255,255],
          "text": "Washer Finished"
          }

      ##########################################################
      ## Dryer Status App
      ##########################################################

- alias: LED Clock - Dryer Status App
  id: 'led_clock_dryer_status_app'

  triggers:
    - trigger: state
      entity_id: sensor.dryer_time_remaining

  conditions:
    - condition: state
      entity_id: sensor.dryer
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/dryer
        payload: >-
          { 
          "icon": "dryer",
          "pushIcon": 2,
          "repeat": 3,
          "color": [255,0,0],
          "text": "Dryer: {{ states("sensor.dryer_time_remaining") }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/dryer
        payload: >-
          { 
          "icon": "dryer",
          "pushIcon": 2,
          "repeat": 3,
          "color": [255,0,0],
          "text": "Dryer: {{ states("sensor.dryer_time_remaining") }}"
          }

      ##########################################################
      ## Dryer Done App
      ##########################################################

- alias: LED Clock - Dryer Done App
  id: 'led_clock_dryer_done_app'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dryer_dry_completed
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/dryer
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "dryer",
          "pushIcon": 0,
          "duration": 60,
          "color": [255,0,0],
          "text": "Dryer Finished"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/dryer
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "dryer",
          "pushIcon": 0,
          "duration": 60,
          "color": [255,0,0],
          "text": "Dryer Finished"
          }

      ##########################################################
      ## Package App
      ##########################################################

- alias: LED Clock - Package App
  id: 'led_clock_package_app'

  triggers:
    - trigger: state
      entity_id: input_boolean.package_camera_notification
      to: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/package
        payload: >-
          { 
          "icon": "delivery",
          "pushIcon": 0,
          "repeat": 3,
          "color": [0,125,125],
          "text": "Package Detected"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/package
        payload: >-
          { 
          "icon": "delivery",
          "pushIcon": 0,
          "repeat": 3,
          "color": [0,125,125],
          "text": "Package Detected"
          }

      ##########################################################
      ## Package App Clear
      ##########################################################

- alias: LED Clock - Package App Clear
  id: 'led_clock_package_app_clear'

  triggers:
    - trigger: state
      entity_id: input_boolean.package_camera_notification
      to: 'off'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/package
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/package

  ##########################################################
  ## Universal Holiday Apps
  ##########################################################

      ##########################################################
      ## Holiday Reset App
      ##########################################################

- alias: LED Clock - Holiday Reset App
  id: 'led_clock_holiday_reset_app'

  triggers:
   - trigger: time
     at: '05:00:00'

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday

      ##########################################################
      ## Christmas App
      ##########################################################

- alias: LED Clock - Christmas App
  id: 'led_clock_christmas_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: 'Christmas'

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "christmas_tree",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Merry ",
              "c": "FF0000"
            },
            {
              "t": "Christmas",
              "c": "00FF00"
            }
          ]
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "christmas_tree",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Merry ",
              "c": "FF0000"
            },
            {
              "t": "Christmas",
              "c": "00FF00"
            }
          ]
          }

      ##########################################################
      ## Halloween App
      ##########################################################

- alias: LED Clock - Halloween App
  id: 'led_clock_halloween_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: 'Halloween'

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "pumpkin",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FFA500"
            },
            {
              "t": "Halloween",
              "c": "A020F0"
            }
          ]
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "pumpkin",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FFA500"
            },
            {
              "t": "Halloween",
              "c": "A020F0"
            }
          ]
          }

      ##########################################################
      ## Thanksgiving App
      ##########################################################

- alias: LED Clock - Thanksgiving App
  id: 'led_clock_thanksgiving_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: 'Thanksgiving'

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: 'Thanksgiving'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "thanksgiving",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FFD700"
            },
            {
              "t": "Thanksgiving",
              "c": "8B4513"
            }
          ]
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "thanksgiving",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FFD700"
            },
            {
              "t": "Thanksgiving",
              "c": "8B4513"
            }
          ]
          }

      ##########################################################
      ## 4th of July App
      ##########################################################

- alias: LED Clock - 4th of July App
  id: 'led_clock_4th_of_july_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: "Independence Day"

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: "Independence Day"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "usa",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FF0000"
            },
            {
              "t": "Independence",
              "c": "FFFFFF"
            }
            {
              "t": "Day",
              "c": "0000FF"
            }
          ]
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "usa",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Happy ",
              "c": "FF0000"
            },
            {
              "t": "Independence",
              "c": "FFFFFF"
            }
            {
              "t": "Day",
              "c": "0000FF"
            }
          ]
          }

      ##########################################################
      ## Valentines Day App
      ##########################################################

- alias: LED Clock - Valentines Day App
  id: 'led_clock_valentines_day_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: "Valentine's Day"

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: "Valentine's Day"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "heart",
          "pushIcon": 0,
          "repeat": 3,
          "color": [255,192,203],
          "text": "Happy Valentines Day"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "heart",
          "pushIcon": 0,
          "repeat": 3,
          "color": [255,192,203],
          "text": "Happy Valentines Day"
          }

      ##########################################################
      ## Easter App
      ##########################################################

- alias: LED Clock - Easter App
  id: 'led_clock_easter_day_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: "Easter"

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: "Easter"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "easter",
          "pushIcon": 0,
          "repeat": 3,
          "color": [173,216,230],
          "text": "Happy Easter"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "easter",
          "pushIcon": 0,
          "repeat": 3,
          "color": [173,216,230],
          "text": "Happy Easter"
          }

      ##########################################################
      ## New Years App
      ##########################################################

- alias: LED Clock - New Years App
  id: 'led_clock_new_years_app'

  triggers:
   - trigger: time
     at: '09:30:00'
   - trigger: state
     entity_id: input_select.holiday
     to: "New Year's Eve"

  conditions:
    - condition: state
      entity_id: input_select.holiday
      state: "New Year's Eve"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/holiday
        payload: >-
          { 
          "icon": "fireworks",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Happy New Years!"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/holiday
        payload: >-
          { 
          "icon": "fireworks",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Happy New Years!"
          }

  ##########################################################
  ## USER1's Office Device Control
  ##########################################################

      ##########################################################
      ## Turn On USER1 Office LED Clock when Motion Detected
      ##########################################################

- alias: LED Clock - Turn On USER1's Office when Motion Detected
  id: 'led_clock_turn_on_USER1_office_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id:
        - light.USER1s_office_desktop_clock

      ##########################################################
      ## Turn Off USER1 Office LED Clock when No Motion Detected
      ##########################################################

- alias: LED Clock - Turn Off USER1's Office when No Motion Detected
  id: 'led_clock_turn_off_USER1_office_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 20
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock

  ##########################################################
  ## USER1's Office Apps
  ##########################################################

      ##########################################################
      ## Music Title Apple TV USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Apple TV Music Title
  id: 'led_clock_USER1_office_music_title_apple_tv'

  triggers:
    - trigger: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      state: 'playing'
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.USER1_s_office_tv_activities
        state: 'power_off'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
        payload: >-
          { 
          "icon": "music",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Song: {{ state_attr('media_player.USER1_s_office_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Music Title Sonos USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Music Title Sonos
  id: 'led_clock_USER1_office_music_title_sonos'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_USER1s_office
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.sonos_USER1s_office
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_USER1s_office
      attribute: media_content_type
      state: 'music'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
        payload: >-
          { 
          "icon": "music",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Song: {{ state_attr('media_player.sonos_USER1s_office', 'media_title') }}"
          }

      ##########################################################
      ## Album Title Apple TV USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Album Title Apple TV
  id: 'led_clock_USER1_office_album_title_apple_tv'

  triggers:
    - trigger: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      state: 'playing'
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.USER1_s_office_tv_activities
        state: 'power_off'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
        payload: >-
          { 
          "icon": "album",
          "pushIcon": 2,
          "repeat": 3,
          "rainbow": true,
          "text": "Artist: {{ state_attr('media_player.USER1_s_office_apple_tv', 'media_artist') }} - Album: {{ state_attr('media_player.USER1_s_office_apple_tv', 'media_album_name') }}"
          }

      ##########################################################
      ## Album Title Sonos USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Album Title Sonos
  id: 'led_clock_USER1_office_album_title_sonos'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_USER1s_office
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.sonos_USER1s_office
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_USER1s_office
      attribute: media_content_type
      state: 'music'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
        payload: >-
          { 
          "icon": "album",
          "pushIcon": 2,
          "repeat": 3,
          "rainbow": true,
          "text": "Artist: {{ state_attr('media_player.sonos_USER1s_office', 'media_artist') }} - Album: {{ state_attr('media_player.sonos_USER1s_office', 'media_album_name') }}"
          }

      ##########################################################
      ## YouTube Title USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office YouTube Title
  id: 'led_clock_USER1_office_youtube_title'

  triggers:
    - trigger: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      state: 'playing'
    - condition: state
      entity_id: select.USER1_s_office_tv_activities
      state: "Watch TV"
    - condition: or
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        attribute: app_name
        state: "YouTube"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube
        payload: >-
          { 
          "icon": "youtube",
          "pushIcon": 2,
          "repeat": 6,
          "rainbow": true,
          "text": "{{ state_attr('media_player.USER1_s_office_apple_tv', 'media_artist') }} : {{ state_attr('media_player.USER1_s_office_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Media Remove USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Media Remove
  id: 'led_clock_USER1_office_media_remove'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_USER1s_office
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 10
    - trigger: state
      entity_id: media_player.USER1_s_office_apple_tv
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 10

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube

      ##########################################################
      ## Party Time USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Party Time
  id: 'led_clock_USER1_office_party_time'

  triggers:
    - trigger: state
      entity_id: input_boolean.office_rainbow
      to: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time
        payload: >-
          { 
          "effect": "Plasma",
          "repeat": 3,
          "rainbow": false,
          "text": "Party Time!",
          "color": [255,255,255]
          }

      ##########################################################
      ## Party Time Off USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Party Time Off
  id: 'led_clock_USER1_office_party_time_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.office_rainbow
      to: 'off'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time

  ##########################################################
  ## USER1's Office Notifications
  ##########################################################

      ##########################################################
      ## Do Not Disturb On USER1's Office LED Clock
      ##########################################################

- alias: LED Clock - USER1 Office Do Not Disturb On
  id: 'led_clock_USER1_office_do_not_disturb_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "exclamation",
          "pushIcon": 0,
          "background": [255,0,0],
          "color": [255,255,255],
          "stack": false,
          "hold": true,
          "text": "Do Not Disturb"
          }

      ##########################################################
      ## Do Not Disturb Off USER1's Office LED Clock
      ##########################################################

- alias: LED Clock - USER1 Office Do Not Disturb Off
  id: 'led_clock_USER1_office_do_not_disturb_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  actions:
    - action: button.press
      target:
        entity_id: button.USER1s_office_desktop_clock_dismiss_notification

      ##########################################################
      ## Media Title USER1's Office Clock
      ##########################################################

- alias: LED Clock - USER1's Office Media Title
  id: 'led_clock_USER1_office_media_title'

  triggers:
    - trigger: state
      entity_id: media_player.USER1_s_office_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: media_player.USER1_s_office_apple_tv
      state: 'playing'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        attribute: media_content_type
        state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "movie",
          "pushIcon": 2,
          "duration": 60,
          "rainbow": true,
          "stack": false,
          "text": "{{ state_attr('media_player.USER1_s_office_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Doorbell USER1's Office LED Clock
      ##########################################################

- alias: LED Clock - Doorbell USER1's Office
  id: 'led_clock_doorbell_USER1_office'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: person.USER1
      state: 'home'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "doorbell",
          "pushIcon": 0,
          "duration": 60,
          "text": "Doorbell"
          }

        #################################################################
        ## USER2 Left Work USER1's Office LED Clock
        #################################################################

- alias: LED Clock - USER1's Office USER2 Left
  id: 'led_clock_USER1_office_USER2_left_work'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "cars",
          "pushIcon": 0,
          "duration": 60,
          "text": "USER2 ETA: {{states('sensor.USER2_to_home')}} mins"
          }

      ##########################################################
      ## USER2 is Home USER1's Office LED Clock
      ##########################################################

- alias: LED Clock - USER1's Office USER2 is Home
  id: 'led_clock_USER1_office_USER2_is_home'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'on'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - delay: '00:00:30'
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "house",
          "pushIcon": 0,
          "duration": 60,
          "rainbow": true,
          "text": "USER2 Home"
          }

      ##########################################################
      ## Echo Timer Done USER1's Office LED Clock
      ##########################################################

- alias: LED Clock - USER1's Office Echo Timer Done
  id: 'led_clock_USER1_office_echo_timer_done'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_echo
      state: 'off'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "timer",
          "pushIcon": 0,
          "duration": 60,
          "rainbow": true,
          "text": "Echo Timer Finished"
          }

      ##########################################################
      ## Door Open USER1's LED Clock
      ##########################################################

- alias: LED Clock - USER1's Office Door Open
  id: 'led_clock_USER1_office_door_open'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.basement_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "door",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,0,0],
          "text": "{{ trigger.to_state.attributes.friendly_name }} Opened"
          }

      ##########################################################
      ## Garage Door Open USER1's LED Clock
      ##########################################################

- alias: LED Clock - USER1's Office Garage Door Open
  id: 'led_clock_USER1_office_garage_door_open'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "garage_open",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,0,0],
          "text": "Garage Open"
          }

      ##########################################################
      ## Garage Door Closed USER1's LED Clock
      ##########################################################

- alias: LED Clock - USER1's Office Garage Door Closed
  id: 'led_clock_USER1_office_garage_door_closed'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1s_office_desktop_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/notify
        payload: >-
          { 
          "icon": "garage_close",
          "pushIcon": 0,
          "duration": 30,
          "color": [0,255,0],
          "text": "Garage Closed"
          }

  ##########################################################
  ## Living Room Device Control
  ##########################################################

      ##########################################################
      ## Turn On Living Room Clock when Motion Detected
      ##########################################################

- alias: LED Clock - Turn On Living Room when Motion Detected
  id: 'led_clock_turn_on_living_room_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        state: 'playing'

  actions:
    - action: light.turn_on
      entity_id:
        - light.living_room_clock

      ##########################################################
      ## Turn Off Living Room LED Clock when No Motion Detected
      ##########################################################

- alias: LED Clock - Turn Off Living Room when No Motion Detected
  id: 'led_clock_turn_off_living_room_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: light.turn_off
      entity_id:
        - light.living_room_clock

      ##########################################################
      ## Turn Off Living Room LED Clock when Watching TV
      ##########################################################

- alias: LED Clock - urn Off Living Room LED Clock when Watching TV
  id: 'led_clock_turn_off_living_room_when_watching_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: media_content_type
        state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"

  actions:
    - action: light.turn_off
      entity_id:
        - light.living_room_clock

      ##########################################################
      ## Turn On Living Room Clock when Done Watching TV
      ##########################################################

- alias: LED Clock - urn Off Living Room Clock when Done Watching TV
  id: 'led_clock_turn_off_living_room_when_done_watching_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      from: 'playing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id:
        - light.living_room_clock

  ##########################################################
  ## Living Room Apps
  ##########################################################

      ##########################################################
      ## TV Off Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room TV Off
  id: 'led_clock_living_room_tv_off'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: 'power_off'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "tv_off",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,0,0],
          "stack": false,
          "text": "TV Off"
          }

      ##########################################################
      ## Watch TV Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Watch TV
  id: 'led_clock_living_room_watch_tv'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: 'Watch TV'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "tv",
          "pushIcon": 0,
          "duration": 30,
          "rainbow": true,
          "stack": false,
          "text": "TV"
          }
    - delay: '00:00:20'
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
        payload: >-
          { 
          "icon": "tv",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "TV"
          }

      ##########################################################
      ## Nintendo Switch Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Nintendo Switch
  id: 'led_clock_living_room_nintendo_switch'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: "Play Nintendo Switch"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "mario",
          "pushIcon": 0,
          "duration": 30,
          "stack": false,
          "text": [
            {
              "t": "Nintendo ",
              "c": "FF0000"
            },
            {
              "t": "Switch",
              "c": "FFFFFF"
            }
          ]
          }
    - delay: '00:00:20'
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
        payload: >-
          { 
          "icon": "mario",
          "pushIcon": 0,
          "repeat": 3,
          "text": [
            {
              "t": "Nintendo ",
              "c": "FF0000"
            },
            {
              "t": "Switch",
              "c": "FFFFFF"
            }
          ]
          }

      ##########################################################
      ## Xbox Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Xbox
  id: 'led_clock_living_room_xbox'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: 'Play Xbox'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "xbox",
          "pushIcon": 0,
          "duration": 30,
          "color": [0,255,0],
          "stack": false,
          "text": "Xbox"
          }
    - delay: '00:00:20'
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
        payload: >-
          { 
          "icon": "xbox",
          "pushIcon": 0,
          "repeat": 3,
          "color": [0,255,0],
          "text": "Xbox"
          }

      ##########################################################
      ## Music Title Apple TV Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Music Title Apple TV
  id: 'led_clock_living_room_music_title_apple_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'
    - condition: state
      entity_id: media_player.living_room_apple_tv
      state: 'playing'
    - condition: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: 'power_off'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
        payload: >-
          { 
          "icon": "music",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Song: {{ state_attr('media_player.living_room_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Music Title Sonos Living Room Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Music Title Sonos Living Room
  id: 'led_clock_living_room_music_title_sonos_living_room'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_living_room
      attribute: media_title


  conditions:
    - condition: state
      entity_id: media_player.sonos_living_room
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_living_room
      attribute: media_content_type
      state: 'music'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
        payload: >-
          { 
          "icon": "music",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Song: {{ state_attr('media_player.sonos_living_room', 'media_title') }}"
          }

      ##########################################################
      ## Music Title Sonos Surround Sound Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Music Title Sonos Surround Sound
  id: 'led_clock_living_room_music_title_sonos_surround_sound'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_surround_sound
      attribute: media_title


  conditions:
    - condition: state
      entity_id: media_player.sonos_surround_sound
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_surround_sound
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: source_list
        state: "TV"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: source
        state: "TV"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: media_title
        state: "TV"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
        payload: >-
          { 
          "icon": "music",
          "pushIcon": 0,
          "repeat": 3,
          "rainbow": true,
          "text": "Song: {{ state_attr('media_player.sonos_surround_sound', 'media_title') }}"
          }

      ##########################################################
      ## Album Title Apple TV Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Album Title Apple TV
  id: 'led_clock_living_room_album_title_apple_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.living_room_apple_tv
      state: 'playing'
    - condition: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: 'power_off'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
        payload: >-
          { 
          "icon": "album",
          "pushIcon": 2,
          "repeat": 3,
          "rainbow": true,
          "text": "Artist: {{ state_attr('media_player.living_room_apple_tv', 'media_artist') }} - Album: {{ state_attr('media_player.living_room_apple_tv', 'media_album_name') }}"
          }

      ##########################################################
      ## Album Title Sonos Living Room Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Album Title Sonos Living Room
  id: 'led_clock_living_room_album_title_sonos_living_room'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_living_room
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.sonos_living_room
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_living_room
      attribute: media_content_type
      state: 'music'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
        payload: >-
          { 
          "icon": "album",
          "pushIcon": 2,
          "repeat": 3,
          "rainbow": true,
          "text": "Artist: {{ state_attr('media_player.sonos_living_room', 'media_artist') }} - Album: {{ state_attr('media_player.sonos_living_room', 'media_album_name') }}"
          }

      ##########################################################
      ## Album Title Sonos Surround Sound Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Album Title Sonos Surround Sound
  id: 'led_clock_living_room_album_title_sonos_surround_sound'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_surround_sound
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: media_player.sonos_surround_sound
      state: 'playing'
    - condition: state
      entity_id: media_player.sonos_surround_sound
      attribute: media_content_type
      state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: source_list
        state: "TV"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: source
        state: "TV"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.sonos_surround_sound
        attribute: media_title
        state: "TV"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
        payload: >-
          { 
          "icon": "album",
          "pushIcon": 2,
          "repeat": 3,
          "rainbow": true,
          "text": "Artist: {{ state_attr('media_player.sonos_surround_sound', 'media_artist') }} - Album: {{ state_attr('media_player.sonos_surround_sound', 'media_album_name') }}"
          }

      ##########################################################
      ## YouTube Title Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room YouTube Title
  id: 'led_clock_living_room_youtube_title'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: media_player.living_room_apple_tv
      state: 'playing'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: or
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube
        payload: >-
          { 
          "icon": "youtube",
          "pushIcon": 2,
          "repeat": 6,
          "rainbow": true,
          "text": "{{ state_attr('media_player.living_room_apple_tv', 'media_artist') }} : {{ state_attr('media_player.living_room_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Media Remove Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Media Remove
  id: 'led_clock_living_room_media_remove'

  triggers:
    - trigger: state
      entity_id: media_player.sonos_living_room
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 10
    - trigger: state
      entity_id: media_player.sonos_surround_sound
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 10
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 10

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube

      ##########################################################
      ## Party Time Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Party Time
  id: 'led_clock_living_room_party_time'

  triggers:
    - trigger: state
      entity_id: input_boolean.livingroom_rainbow
      to: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time
        payload: >-
          { 
          "effect": "Plasma",
          "repeat": 3,
          "rainbow": false,
          "text": "Party Time!",
          "color": [255,255,255]
          }

      ##########################################################
      ## Party Time Off Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Party Time Off
  id: 'led_clock_living_room_party_time_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.livingroom_rainbow
      to: 'off'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time

  ##########################################################
  ## Living Room Notifications
  ##########################################################

      ##########################################################
      ## Media Title Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Media Title
  id: 'led_clock_living_room_media_title'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      attribute: media_title
      for:
        hours: 0
        minutes: 0
        seconds: 1

  conditions:
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'
    - condition: state
      entity_id: media_player.living_room_apple_tv
      state: 'playing'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: media_content_type
        state: 'music'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "movie",
          "pushIcon": 2,
          "duration": 60,
          "rainbow": false,
          "stack": false,
          "text": "{{ state_attr('media_player.living_room_apple_tv', 'media_title') }}"
          }

      ##########################################################
      ## Doorbell Living Room Clock
      ##########################################################

- alias: LED Clock - Doorbell Living Room
  id: 'led_clock_doorbell_living_room'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "doorbell",
          "pushIcon": 0,
          "duration": 60,
          "stack": false,
          "text": "Doorbell"
          }

        #################################################################
        ## USER2 Left Work Living Room Clock
        #################################################################

- alias: LED Clock - Living Room USER2 Left
  id: 'led_clock_living_room_USER2_left_work'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "cars",
          "pushIcon": 0,
          "duration": 60,
          "text": "USER2 ETA: {{states('sensor.USER2_to_home')}} mins"
          }

      ##########################################################
      ## USER2 is Home Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room USER2 is Home
  id: 'led_clock_living_room_USER2_is_home'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'on'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - delay: '00:00:30'
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "house",
          "pushIcon": 0,
          "duration": 60,
          "rainbow": true,
          "text": "USER2 Home"
          }

      ##########################################################
      ## USER1 is Home Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room USER1 is Home
  id: 'led_clock_living_room_USER1_is_home'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'off'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - delay: '00:00:30'
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "house",
          "pushIcon": 0,
          "duration": 60,
          "rainbow": true,
          "text": "USER1 Home"
          }

      ##########################################################
      ## Echo Timer Done Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Echo Timer Done
  id: 'led_clock_living_room_echo_timer_done'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_echo
      state: 'off'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "timer",
          "pushIcon": 0,
          "duration": 60,
          "rainbow": true,
          "text": "Echo Timer Finished"
          }

      ##########################################################
      ## Door Open Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Door Open
  id: 'led_clock_living_room_door_open'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.basement_door_opened
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "door",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,0,0],
          "stack": false,
          "text": "{{ trigger.to_state.attributes.friendly_name }} Opened"
          }

      ##########################################################
      ## Garage Door Open Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Garage Door Open
  id: 'led_clock_living_room_garage_door_open'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "garage_open",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,0,0],
          "stack": false,
          "text": "Garage Open"
          }

      ##########################################################
      ## Garage Door Closed Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Garage Door Closed
  id: 'led_clock_living_room_garage_door_closed'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "garage_close",
          "pushIcon": 0,
          "duration": 30,
          "color": [0,255,0],
          "stack": false,
          "text": "Garage Closed"
          }

      ##########################################################
      ## Fireplace On Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Fireplace On
  id: 'led_clock_living_room_fireplace_on'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "fire_2",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,98,0],
          "stack": false,
          "text": "Fireplace On"
          }

      ##########################################################
      ## Fireplace Off Living Room Clock
      ##########################################################

- alias: LED Clock - Living Room Fireplace Off
  id: 'led_clock_living_room_fireplace_off'

  triggers:
    - trigger: state
      entity_id: switch.fireplace
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_clock
      state: 'on'

  actions:
    - action: mqtt.publish
      data:
        topic: living_room_clock/notify
        payload: >-
          { 
          "icon": "fire_2",
          "pushIcon": 0,
          "duration": 30,
          "color": [255,98,0],
          "stack": false,
          "text": "Fireplace Off"
          }
#################################################################
## LED Clock Automations
#################################################################

  ##########################################################
  ## Universal Device Control
  ##########################################################

        ##########################################################
        ## Bedtime 
        ##########################################################

- alias: LED Clock - Bedtime
  id: 'led_clock_bedtime'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock
        - light.living_room_clock
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/temp
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/temp

        ##########################################################
        ## Household Away Mode LED Clock
        ##########################################################

- alias: LED Clock - Household Away Mode
  id: 'led_clock_household_away_mode'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: light.turn_off
      entity_id:
        - light.USER1s_office_desktop_clock
        - light.living_room_clock
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_song
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/music_album
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/youtube
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/party_time
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/tv_state

  ##########################################################
  ## Universal Apps
  ##########################################################

      ##########################################################
      ## Weather App
      ##########################################################

- alias: LED Clock - Weather App
  id: 'led_clock_weather_app'

  triggers:
    - trigger: time_pattern
      minutes: '/30'
    - trigger: state
      entity_id: weather.REDACTED

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/weather
        payload: >-
          { 
          "icon": "weather_{{ states("sensor.weather_condition_lcd_clock_icon") |regex_replace(find='-', replace='_', ignorecase=False) }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.weather_condition_human_readable") }}"
          }
    - action: mqtt.publish
      data:
        topic: living_room_clock/custom/weather
        payload: >-
          { 
          "icon": "weather_{{ states("sensor.weather_condition_lcd_clock_icon") |regex_replace(find='-', replace='_', ignorecase=False) }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.weather_condition_human_readable") }}"
          }

      ##########################################################
      ## Temperature App
      ##########################################################

- alias: LED Clock - Temperature App
  id: 'led_clock_temperature_app'

  triggers:
    - trigger: time_pattern
      minutes: '/30'
    - trigger: state
      entity_id: sensor.REDACTED_temperature

  actions:
    - action: mqtt.publish
      data:
        topic: USER1_office_clock/custom/temperature
        payload: >-
          { 
          "icon": "{{ states("sensor.outdoor_temp_range") }}",
          "pushIcon": 0,
          "text": "{{ states("sensor.REDACTED_temperature") }}#################################################################
## Lighting Automations
#################################################################

        ##########################################################
        ## Reset Exterior Garage Light Brightness when Garage Closed
        ##########################################################

- alias: Lights - Reset Exterior Garage Light Brightness when Garage Closed
  id: 'lights_reset_exterior_garage_light_brightness_when_garage_closed'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'closed'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: light.garage_light
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 2
       transition: 330

        ##########################################################
        ## Turn On Exterior Garage Light when Garage Open
        ##########################################################

- alias: Lights - Turn On Exterior Garage Light when Garage Open
  id: 'lights_turn_on_exterior_garage_light_when_garage_open'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off Interior Garage Light when Garage Closed
        ##########################################################

- alias: Lights - Turn Off Interior Garage Light when Garage Closed
  id: 'lights_turn_off_interior_garage_light_when_garage_closed'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'closed'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: light.garage_interior
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
      data:
       transition: 330

        ##########################################################
        ## Turn On Interior Garage Light when Garage Open
        ##########################################################

- alias: Lights - Turn On Interior Garage Light when Garage Open
  id: 'lights_turn_on_interior_garage_light_when_garage_open'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'
      for:
        hours: 0
        minutes: 0
        seconds: 9

  conditions:
    - condition: state
      entity_id: input_boolean.disable_door_open_lights_on
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_interior
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off Exterior Garage Light After Midnight
        ##########################################################

- alias: Lights - Turn Off Exterior Garage Light After Midnight
  id: 'lights_turn_off_exterior_garage_light_after_midnight'

  triggers:
    - trigger: state
      entity_id: light.garage_light
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '07:30:00'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
      data:
       transition: 330

        ##########################################################
        ## Turn On Exterior Garage Light at Sunset
        ##########################################################

- alias: Lights - Turn On Exterior Garage Light at Sunset
  id: 'lights_turn_on_exterior_garage_light_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 2

        ##########################################################
        ## Turn Off Exterior Garage Light at Midnight
        ##########################################################

- alias: Lights - Turn Off Exterior Garage Light at Midnight
  id: 'lights_turn_off_exterior_garage_light_at_midnight'

  triggers:
   - trigger: time
     at: '00:00:00'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light

        ##########################################################
        ## Turn Off Exterior Garage Light at Midnight Friends Visiting Weekdays
        ##########################################################

- alias: Lights - Turn Off Exterior Garage Light at Midnight Friends Visiting Weekdays
  id: 'lights_turn_off_exterior_garage_light_at_midnight_friends_visiting_weekdays'

  triggers:
   - trigger: time
     at: '00:00:00'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'on'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light

        ##########################################################
        ## Turn On Front Porch Lights at Sunset
        ##########################################################

- alias: Lights - Turn On Front Porch Lights at Sunset
  id: 'lights_turn_on_front_porch_lights_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        transition: 900
        brightness_pct: 50
        color_temp: 370

        ##########################################################
        ## Turn Off Front Porch Lights at Midnight
        ##########################################################

- alias: Lights - Turn Off Front Porch Lights at Midnight
  id: 'lights_turn_off_front_porch_lights_at_midnight'

  triggers:
   - trigger: time
     at: '23:45:00'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'Christmas'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: "New Year's Eve"

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
      data:
       transition: 900
    - delay: '00:16:00'
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch

        ##########################################################
        ## Turn Off Front Porch Lights After Midnight
        ##########################################################

- alias: Lights - Turn Off Front Porch Lights After Midnight
  id: 'lights_turn_off_front_porch_lights_after_midnight'

  triggers:
    - trigger: state
      entity_id: light.front_porch
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: 'Christmas'
    - condition: not
      conditions:
        - condition: state
          entity_id: input_select.holiday
          state: "New Year's Eve"

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
      data:
       transition: 300
    - delay: '00:06:00'
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch

        ##########################################################
        ## Turn Off Front Porch Lights After 2a
        ##########################################################

- alias: Lights - Turn Off Front Porch Lights After 2a
  id: 'lights_turn_off_front_porch_lights_after_2a'

  triggers:
    - trigger: state
      entity_id: light.front_porch
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
      data:
       transition: 300
    - delay: '00:06:00'
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch

        ##########################################################
        ## Turn On Front Yard Lighting at Sunset
        ##########################################################

- alias: Lights - Turn On Front Yard Lighting at Sunset
  id: 'lights_turn_on_front_yard_lighting_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.front_yard_lighting

        ##########################################################
        ## Turn Off Front Yard Lighting at 3a
        ##########################################################

- alias: Lights - Turn Off Front Yard Lighting at 3a
  id: 'lights_turn_off_front_yard_lighting_at_3a'

  triggers:
   - trigger: time
     at: '03:00:00'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.front_yard_lighting

        ##########################################################
        ## Turn Off Front Yard Lighting after 3a
        ##########################################################

- alias: Lights - Turn Off Front Yard Lighting after 3a
  id: 'lights_turn_off_front_yard_lighting_after_3a'

  triggers:
    - trigger: state
      entity_id: switch.front_yard_lighting
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: time
      after: '03:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.front_yard_lighting

        ##########################################################
        ## Turn On Back Door Lights at Sunset
        ##########################################################

- alias: Lights - Turn On Back Door Lights at Sunset
  id: 'lights_turn_on_back_door_lights_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 2
        transition: 60

        ##########################################################
        ## Turn Off Back Door Lights at Midnight
        ##########################################################

- alias: Lights - Turn Off Back Door Lights at Midnight
  id: 'lights_turn_off_back_door_lights_at_midnight'

  triggers:
    - trigger: time
      at: '00:00:00'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
   - action: light.turn_off
     target:
      entity_id:
        - light.back_door
   - delay: '00:00:30'
   - action: light.turn_off
     target:
      entity_id:
        - light.back_door
       
        ##########################################################
        ## Turn Off Back Door Lights at Midnight Weekdays Friends Visiting
        ##########################################################

- alias: Lights - Turn Off Back Door Lights at Midnight Weekdays Friends Visiting
  id: 'lights_turn_off_back_door_lights_at_midnight_weekdays_friends_visiting'

  triggers:
    - trigger: time
      at: '00:00:00'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'on'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu

  actions:
   - action: light.turn_off
     target:
      entity_id:
       - light.back_door
   - delay: '00:00:30'
   - action: light.turn_off
     target:
      entity_id:
       - light.back_door

        ##########################################################
        ## Turn Off Backyard Lighting After Midnight
        ##########################################################

- alias: Lights - Turn Off Backyard Lighting After Midnight
  id: 'lights_turn_off_backyard_lighting_after_midnight'

  triggers:
    - trigger: state
      entity_id: light.back_door
      from: 'off'
      to: 'on'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: time
      after: '00:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting

        ##########################################################
        ## Turn Off Interior Lights at Sunrise
        ##########################################################

- alias: Lights - Turn Off Interior Lights at Sunrise
  id: 'lights_turn_off_interior_lights_at_sunrise'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+00:45:00'

  conditions:
    - condition: state
      entity_id: binary_sensor.motion
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights

        ##########################################################
        ## Turn Off Exterior Lights at Sunrise
        ##########################################################

- alias: Lights - Turn Off Exterior Lights at Sunrise
  id: 'lights_turn_off_exterior_lights_at_sunrise'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+00:15:00'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.exterior_lights
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
          - switch.front_yard_lighting
    - delay: '00:02:00'
    - action: light.turn_off
      target:
        entity_id:
          - light.front_porch
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio

        ##########################################################
        ## Turn On Backyard Lighting at Sunset
        ##########################################################

- alias: Lights - Turn On Backyard Lighting at Sunset
  id: 'lights_turn_on_backyard_lighting_at_sunset'

  triggers:
    - trigger: sun
      event: 'sunset'
      offset: '-00:15:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_patio
      data:
        brightness_pct: 10
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_deck
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn Off Backyard Lighting at Midnight
        ##########################################################

- alias: Lights - Turn Off Backyard Lighting at Midnight
  id: 'lights_turn_off_backyard_lighting_at_midnight'

  triggers:
    - trigger: time
      at: '00:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
    - action: light.turn_off
      target:
        entity_id:
           light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - delay: '00:00:30'
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck

        ##########################################################
        ## Turn Off Backyard Lighting At Midnight Weekedays Friends Visiting
        ##########################################################

- alias: Lights - Turn Off Backyard Lighting At Midnight Weekedays Friends Visiting
  id: 'lights_turn_off_backyard_lighting_at_midnight_weekdays_friends_visiting'

  triggers:
    - trigger: time
      at: '00:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'on'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - delay: '00:00:30'
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
   
        ##########################################################
        ## Turn On Guest Bedroom Lamp when Ceiling is On
        ##########################################################

- alias: Lights - Turn On Guest Bedroom Lamp when Ceiling is On
  id: 'lights_turn_on_guest_bedroom_lamp_when_ceiling_is_on'

  triggers:
    - trigger: state
      entity_id: light.guest_bedroom_ceiling
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: light.guest_bedroom_nightstand
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.guest_bedroom_nightstand
      data:
       brightness_pct: 50

        ##########################################################
        ## Turn Off Guest Bedroom Lamp when Ceiling is Off
        ##########################################################

- alias: Lights - Turn Off Guest Bedroom Lamp when Ceiling is Off
  id: 'lights_turn_off_guest_bedroom_lamp_when_ceiling_is_off'

  triggers:
    - trigger: state
      entity_id: light.guest_bedroom_ceiling
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: light.guest_bedroom_nightstand
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.guest_bedroom_nightstand

        ##########################################################
        ## Turn On Basement Lights when Workbench Switch Used
        ##########################################################

- alias: Lights - Turn On Basement Lights when Workbench Switch Used
  id: 'lights_turn_on_basement_lights_when_workbench_switch_used'

  triggers:
    - trigger: state
      entity_id: light.work_bench_light
      from: 'off'
      to: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn On Basement Lights when Laundry Room Switch Used
        ##########################################################

- alias: Lights - Turn On Basement Lights when Laundry Room Switch Used
  id: 'lights_turn_on_basement_lights_when_laundry_room_switch_used'

  triggers:
    - trigger: state
      entity_id: light.laundry_room_light
      from: 'off'
      to: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
       brightness_pct: 25

        ##########################################################
        ## Turn Off Basement Lights when Laundry Switch Used
        ##########################################################

- alias: Lights - Turn Off Basement Lights when Laundry Switch Used
  id: 'lights_turn_off_basement_lights_when_laundry_switch_used'

  triggers:
    - trigger: state
      entity_id: light.laundry_room_light
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.basement_lighting
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lamp
    - action: light.turn_off
      target:
        entity_id:
          - light.work_bench_light

        ##########################################################
        ## Turn Off Basement Lights when Work Bench Switch Used
        ##########################################################

- alias: Lights - Turn Off Basement Lights when Work Bench Switch Used
  id: 'lights_turn_off_basement_lights_when_work_bench_switch_used'

  triggers:
    - trigger: state
      entity_id: light.work_bench_light
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.basement_lighting
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lamp

#################################################################
## Color Modes
#################################################################

        ##########################################################
        ## Media Center Lighting Random Color Every 30 mins
        ##########################################################

- alias: Lights - Media Center Lighting Random Color Every 30 Mins
  id: 'lights_media_center_lighting_random_color_every_30_mins'

  triggers:
    - trigger: time_pattern
      minutes: '/30'

  conditions:
    - condition: state
      entity_id: light.media_center_lighting
      state: 'on'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id: light.media_center_lighting
      data:
        transition: 300
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100

        ##########################################################
        ## Living Room Lights Random Color On
        ##########################################################

- alias: Lights - Living Room Lights Random Color On
  id: 'lights_living_room_lights_random_color_on'

  triggers:
    - trigger: time_pattern
      seconds: '/15'

  conditions:
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_fan_lights
    - action: light.turn_on
      target:
        entity_id: light.living_room_lamp_1
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id: light.media_center_lighting
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id: light.globe
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id: light.living_room_lamp_2
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100

        ##########################################################
        ## Living Room Lights Random Color Off
        ##########################################################

- alias: Lights - Living Room Lights Random Color Off
  id: 'lights_living_room_lights_random_color_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.livingroom_rainbow
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights
    - delay: '00:00:05'
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        transition: 15
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 15
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
        transition: 15
        brightness_pct: 65
        color_temp: 366

        ##########################################################
        ## Bedroom Lights Random Color On
        ##########################################################

- alias: Lights - Bedroom Lights Random Color On
  id: 'lights_bedroom_lights_random_color_on'

  triggers:
    - trigger: time_pattern
      seconds: '/15'

  conditions:
    - condition: state
      entity_id: input_boolean.bedroom_rainbow
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_closet_ceiling
    - action: light.turn_on
      data:
        brightness_pct: 100
        effect: Party
      target:
        entity_id: 
          - light.USER1s_nightstand
          - light.USER2s_nightstand
          - light.closet_lamp
    - action: light.turn_on
      target:
        entity_id: light.bedroom_lamp
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100

        ##########################################################
        ## Bedroom Lights Random Color Off
        ##########################################################

- alias: Lights - Bedroom Lights Random Color Off
  id: 'lights_bedroom_lights_random_color_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedroom_rainbow
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'
    - condition: state
      entity_id: light.bedroom_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1s_nightstand
          - light.USER2s_nightstand
          - light.bedroom_lamp
    - delay: '00:00:05'
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1s_nightstand
          - light.USER2s_nightstand
          - light.bedroom_lamp
          - light.closet_lamp
      data:
        transition: 15
        color_temp: 370
        brightness_pct: 50

        ##########################################################
        ## USER1's Office Lights Lamps Random Color On
        ##########################################################

- alias: Lights - USER1 Office Lights Random Color On
  id: 'lights_USER1_office_lights_random_color_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.office_rainbow
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'

  actions:
    - action: light.turn_on
      data:
        brightness_pct: 100
        effect: Party
      target:
        entity_id: 
          - light.USER1_office_desk_lamp
          - light.moon_globe
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_s_office_ceiling

        ##########################################################
        ## USER1's Office Lamp Random Color
        ##########################################################

- alias: Lights - USER1's Office Lamp Random Color
  id: 'lights_USER1_office_lamp_random_color'

  triggers:
    - trigger: time_pattern
      seconds: '/15'

  conditions:
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id: 
          - light.office_lamp
          - light.USER1_office_desk_accent
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100

        ##########################################################
        ## USER1 Office Random Color Off
        ##########################################################

- alias: Lights - USER1 Office Random Color Off
  id: 'lights_USER1_office_random_color_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.office_rainbow
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'
    - condition: state
      entity_id: light.office_lamp
      state: 'on'
    - condition: state
      entity_id: light.moon_globe
      state: 'on'

  actions:
    - action: light.turn_on
      entity_id: light.office_lamp
      data:
        transition: 5
        color_temp: 370
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.moon_globe
      data:
        brightness_pct: 10
        color_temp: 238
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 80
        color_temp: 370

        ##########################################################
        ## Front Porch Lights Random Color On
        ##########################################################

- alias: Lights - Front Porch Lights Random Color On
  id: 'lights_front_porch_lights_random_color_on'

  triggers:
    - trigger: time_pattern
      seconds: '/15'

  conditions:
    - condition: state
      entity_id: input_boolean.front_porch_rainbow
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.bedtime
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id: light.front_porch_left
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id: light.front_porch_right
      data:
        transition: 5
        hs_color:
          - '{{ (range(0, 360)|random) }}'
          - '100'
        brightness_pct: 100

        ##########################################################
        ## Front Porch Lights Random Color Off
        ##########################################################

- alias: Lights - Front Porch Lights Random Color Off
  id: 'lights_front_porch_lights_random_color_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.front_porch_rainbow
      to: 'off'

  conditions:
    - condition: state
      entity_id: light.front_porch
      state: 'on'

  actions:
    - action: light.turn_on
      entity_id: light.front_porch
    - delay: '00:00:01'
    - action: light.turn_on
      entity_id: light.front_porch
      data:
        transition: 15
        brightness_pct: 50
        color_temp: 370

        ##########################################################
        ## USER1's Office Desk Lamp Do Not Disturb On
        ##########################################################

- alias: Lights - USER1 Office Desk Lamp Do Not Disturb On
  id: 'lights_USER1_office_desk_lamp_do_not_disturb_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 50
        color_name: red

        ##########################################################
        ## USER1's Office Accent Light Do Not Disturb On
        ##########################################################

- alias: Lights - USER1's Office Accent Light Do Not Disturb On
  id: 'lights_USER1_office_accent_light_do_not_disturb_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'closed'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 100
        color_name: red

        ##########################################################
        ## USER1's Office Desk Lamp Do Not Disturb Off Daytime Blinds Open
        ##########################################################

- alias: Lights - USER1 Office Desk Lamp Do Not Disturb Off Daytime Blinds Open
  id: 'lights_USER1_office_desk_lamp_do_not_disturb_off_daytime_blinds_open'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: light.USER1_office_desk_lamp
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'open'
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'opening'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370
    - delay: '00:00:05'
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_desk_lamp

        ##########################################################
        ## USER1's Office Desk Lamp Do Not Disturb Off Daytime Blinds Closed
        ##########################################################

- alias: Lights - USER1 Office Desk Lamp Do Not Disturb Off Daytime Blinds Closed
  id: 'lights_USER1_office_desk_lamp_do_not_disturb_off_daytime_blinds_closed'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: light.USER1_office_desk_lamp
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'closed'
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'closing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370

        ##########################################################
        ## USER1's Office Accent Light Do Not Disturb Off Daytime Blinds Closed
        ##########################################################

- alias: Lights - USER1's Office Accent Light Do Not Disturb Off Daytime Blinds Closed
  id: 'lights_USER1_office_accent_light_do_not_disturb_off_daytime_blinds_closed'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: light.USER1_office_desk_accent
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'closed'
      - condition: state
        entity_id: cover.USER1_s_office_blinds
        state: 'closing'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 80
        color_temp: 370

        ##########################################################
        ## USER1's Office Desk Lamp Do Not Disturb Off Night
        ##########################################################

- alias: Lights - USER1 Office Desk Lamp Do Not Disturb Off Night
  id: 'lights_USER1_office_desk_lamp_do_not_disturb_off_night'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: light.USER1_office_desk_lamp
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370

        ##########################################################
        ## USER1's Office Accent Light Do Not Disturb Off Night
        ##########################################################

- alias: Lights - USER1's Office Accent Light Do Not Disturb Off Night
  id: 'lights_USER1_office_accent_light_do_not_disturb_off_night'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      to: 'off'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: light.USER1_office_desk_accent
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 80
        color_temp: 370

#################################################################
## Default Colors Temps
#################################################################

        ##########################################################
        ## Set Default Color Temp 370
        ##########################################################

- alias: Lights - Set Default Color Temp 370
  id: 'lights_set_default_color_temp_370'
  
  mode: parallel
  triggers:
    - trigger: state
      entity_id:
        - light.globe
        - light.USER1s_nightstand
        - light.USER2s_nightstand
        - light.bedroom_lamp
        - light.closet_lamp
        - light.office_lamp
        - light.USER1_office_desk_lamp
        - light.USER1_office_desk_accent
        - light.living_room_lamps
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 6

  conditions:
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'disarmed'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.bedroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bathroom_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.upstairs_bathrooom_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.utility_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.washing_machine_water_sensor
        state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id: "{{ trigger.entity_id }}"
      data:
        color_temp: 370

#################################################################
## Grow Light
#################################################################

        ##########################################################
        ## Turn Off Grow Light After 16 Hours
        ##########################################################

- alias: Lights - Turn Off Grow Light After 16 Hours
  id: 'lights_turn_off_grow_light_after_16_hours'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+16:00:00'

  conditions:
    - condition: state
      entity_id: switch.grow_light
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_grow_light
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.grow_light

        ##########################################################
        ## Turn On Grow Light at Sunrise
        ##########################################################

- alias: Lights - Turn On Grow Light at Sunrise
  id: 'lights_turn_on_grow_light_at_sunrise'

  triggers:
    - trigger: sun
      event: 'sunrise'

  conditions:
    - condition: state
      entity_id: switch.grow_light
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_grow_light
      state: 'off'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.grow_light

        ##########################################################
        ## Turn On Bedroom Grow Light at 10a
        ##########################################################

- alias: Lights - Turn On Bedroom Grow Light at 10a
  id: 'lights_turn_on_bedroom_grow_light_at_10a'

  triggers:
   - trigger: time
     at: '10:05:00'

  conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_bedroom_grow_light
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'summer'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth
    - delay:
        seconds: 30
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth

        ##########################################################
        ## Turn Off Bedroom Grow Light When Home
        ##########################################################

- alias: Lights - Turn Off Bedroom Grow Light When Home
  id: 'lights_turn_off_bedroom_grow_light_when_home'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: light.closet_lamp
      state: 'on'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_bedroom_grow_light
      state: 'off'
    - condition: state
      entity_id: light.closet_lamp
      attribute: effect
      state: "Plantgrowth"
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'summer'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.closet_lamp

        ##########################################################
        ## Turn On Bedroom Grow Light When Away
        ##########################################################

- alias: Lights - Turn On Bedroom Grow Light When Away
  id: 'lights_turn_on_bedroom_grow_light_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 16
        seconds: 00

  conditions:
    - condition: state
      entity_id: light.closet_lamp
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_bedroom_grow_light
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: light.closet_lamp
        attribute: effect
        state: "Plantgrowth"
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'summer'

  actions:
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth
    - delay:
        seconds: 30
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth

        ##########################################################
        ## Turn On Bedroom Grow Light at Sunrise Vacation Mode
        ##########################################################

- alias: Lights - Turn On Bedroom Grow Light at Sunrise Vacation Mode
  id: 'lights_turn_on_bedroom_grow_light_at_sunrise_vacation_mode'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+00:46:00'

  conditions:
    - condition: state
      entity_id: light.closet_lamp
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_bedroom_grow_light
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'summer'

  actions:
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth
    - delay:
        seconds: 30
    - action: light.turn_on
      target:
        entity_id: light.closet_lamp
      data:
        brightness_pct: 100
        effect: Plantgrowth

        ##########################################################
        ## Turn Off Bedroom Grow Light After 16 Hours
        ##########################################################

- alias: Lights - Turn Off Bedroom Grow Light After 16 Hours
  id: 'lights_turn_off_bedroom_grow_light_after_16_hours'

  triggers:
    - trigger: sun
      event: 'sunrise'
      offset: '+16:00:00'

  conditions:
    - condition: state
      entity_id: light.closet_lamp
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_bedroom_grow_light
      state: 'off'
    - condition: state
      entity_id: light.closet_lamp
      attribute: effect
      state: "Plantgrowth"
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.season
        state: 'summer'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.closet_lamp

#################################################################
## Pico Remotes
#################################################################

  #################################################################
  ## Living Room Lights On Pico Remote
  #################################################################

- alias: Lights - Living Room Lights On Pico Remote
  id: 'lights_living_room_lights_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 2
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id: 
          - light.media_center_lighting
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
        brightness_pct: 65
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Lights Off Pico Remote
  #################################################################

- alias: Lights - Living Room Lights Off Pico Remote
  id: 'lights_living_room_lights_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 4
        action: press

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Lights Increase Brightness Pico Remote
  #################################################################

- alias: Lights - Living Room Lights Increase Brightness Pico Remote
  id: 'lights_living_room_lights_increase_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 5
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
        brightness_step_pct: 10
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Lights Decrease Brightness Pico Remote
  #################################################################

- alias: Lights - Living Room Lights Decrease Brightness Pico Remote
  id: 'lights_living_room_lights_decrease_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 43846935
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: light.living_room_accent_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
        brightness_step_pct: -10
    - delay:
        seconds: 1
        
  #################################################################
  ## Living Room Fan Lights On Pico Remote
  #################################################################

- alias: Lights - Living Room Fan Lights On Pico Remote
  id: 'lights_living_room_fan_lights_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 2
        action: press

  conditions:
    - condition: state
      entity_id: light.living_room_fan_lights
      state: 'off'

  actions:
    - delay:
        seconds: 1
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_fan_lights
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fan Lights Off Pico Remote
  #################################################################

- alias: Lights - Living Room Fan Lights Off Pico Remote
  id: 'lights_living_room_fan_lights_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 49229391
        button_number: 4
        action: press

  conditions:
    - condition: state
      entity_id: light.living_room_fan_lights
      state: 'on'

  actions:
    - delay:
        seconds: 1
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_fan_lights
    - delay:
        seconds: 1

  #################################################################
  ## Living Room Fan Dimm Lights Pico Remote
  #################################################################

#- alias: Lights - Living Room Fan Dimm Lights Pico Remote
#  id: 'lights_living_room_fan_dimm)lights_pico_remote'

#  triggers:
#    - trigger: event
#      event_type: lutron_caseta_button_event
#      event_data:
#        serial: 49229391
#        button_number: 2
#        action: press

#  conditions:
#    - condition: state
#      entity_id: light.living_room_fan_lights
#      state: 'on'

#  actions:
#    - action: script.turn_on
#      entity_id:
#        - script.living_room_fan_light_dimmer
#    - delay:
#        seconds: 3

  #################################################################
  ## Living Room Fan Lights Start Dimmer Reset
  #################################################################

#- alias: Lights - Living Room Fan Lights Start Dimmer Reset
#  id: 'lights_living_room_fan_lights_start_dimmer_reset'

#  triggers:
#    - trigger: state
#      entity_id: switch.living_room_east_fan_dimmer
#      to: 'on'
#      for:
#        hours: 0
#        minutes: 0
#        seconds: 10
#    - trigger: state
#      entity_id: switch.living_room_east_fan_dimmer
#      to: 'on'
#      for:
#        hours: 0
#        minutes: 0
#        seconds: 10

#  actions:
#    - action: switch.turn_off
#      entity_id:
#        - switch.living_room_east_fan_dimmer
#        - switch.living_room_east_fan_dimmer

  #################################################################
  ## West Living Room Fan Lights On Pico Remote
  #################################################################

- alias: Lights - West Living Room Fan Lights On Pico Remote
  id: 'lights_west_living_room_fan_lights_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 2
        action: press

  conditions:
    - condition: state
      entity_id: light.living_room_ceiling_west
      state: 'off'

  actions:
    - delay:
        seconds: 1
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_ceiling_west
    - delay:
        seconds: 1

  #################################################################
  ## West Living Room Fan Lights Off Pico Remote
  #################################################################

- alias: Lights - West Fan Living Room Lights Off Pico Remote
  id: 'lights_west_living_room_fan_lights_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 91525691
        button_number: 4
        action: press

  conditions:
    - condition: state
      entity_id: light.living_room_ceiling_west
      state: 'on'

  actions:
    - delay:
        seconds: 1
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_west
    - delay:
        seconds: 1

  #################################################################
  ## Living Room West Fan Dimm Lights Pico Remote
  #################################################################

#- alias: Lights - Living Room West Fan Dimm Lights Pico Remote
#  id: 'lights_living_room_west_fan_dimm_lights_pico_remote'

#  triggers:
#    - trigger: event
#      event_type: lutron_caseta_button_event
#      event_data:
#        serial: 91525691
#        button_number: 2
#        action: press

#  conditions:
#    - condition: state
#      entity_id: light.living_room_ceiling_west
#      state: 'on'

#  actions:
#    - action: script.turn_on
#      entity_id:
#        - script.living_room_west_fan_light_dimmer
#    - delay:
#        seconds: 3

  #################################################################
  ## Living Room West Fan Lights Start Dimmer Reset
  #################################################################

#- alias: Lights - Living Room West Fan Lights Start Dimmer Reset
#  id: 'lights_living_room_west_fan_lights_start_dimmer_reset'

#  triggers:
#    - trigger: state
#      entity_id: switch.living_room_west_fan_dimmer
#      to: 'on'
#      for:
#        hours: 0
#        minutes: 0
#        seconds: 10
#    - trigger: state
#      entity_id: switch.living_room_west_fan_dimmer
#      to: 'on'
#      for:
#        hours: 0
#        minutes: 0
#        seconds: 10

#  actions:
#    - action: switch.turn_off
#      entity_id:
#        - switch.living_room_west_fan_dimmer

  #################################################################
  ## Basement Lights On Pico Remote
  #################################################################

- alias: Lights - Basement Lights On Pico Remote
  id: 'lights_basement_lights_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 2
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
      data:
        brightness_pct: 100
    - delay:
        seconds: 1

  #################################################################
  ## Basement Lights Off Pico Remote
  #################################################################

- alias: Lights - Basement Lights Off Pico Remote
  id: 'lights_basement_lights_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 4
        action: press

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lighting
    - delay:
        seconds: 1

  #################################################################
  ## Basement Lights Increase Brightness Pico Remote
  #################################################################

- alias: Lights - Basement Lights Increase Brightness Pico Remote
  id: 'lights_basement_lights_increase_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 5
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
        brightness_step_pct: 10
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
        brightness_step_pct: 10
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
        brightness_step_pct: 10
    - delay:
        seconds: 1

  #################################################################
  ## Basement Lights Decrease Brightness Pico Remote
  #################################################################

- alias: Lights - Basement Lights Decrease Brightness Pico Remote
  id: 'lights_basement_lights_decrease_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 6
        action: press
    
  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_stairs
        state: 'on'
      - condition: state
        entity_id: light.basement_lights
        state: 'on'
      - condition: state
        entity_id: light.work_bench_light
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
        brightness_step_pct: -10
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
        brightness_step_pct: -10
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
        brightness_step_pct: -10
    - delay:
        seconds: 1

  #################################################################
  ## Basement Lights On Center Pico Button
  #################################################################

- alias: Lights - Basement Lights On Center Pico Button
  id: 'lights_basement_lights_on_center_pico_button'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 3
        action: press

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_stairs
        state: 'off'
      - condition: state
        entity_id: light.basement_lights
        state: 'off'
      - condition: state
        entity_id: light.work_bench_light
        state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
    - action: light.turn_on
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
    - delay:
        seconds: 1

  #################################################################
  ## Basement Lights Off Center Pico Button
  #################################################################

- alias: Lights - Basement Lights Off Center Pico Button
  id: 'lights_basement_lights_off_center_pico_button'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 42010030
        button_number: 3
        action: press

  conditions:
    - condition: state
      entity_id: light.basement_lighting
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lighting
    - delay:
        seconds: 1

  #################################################################
  ## Bedroom Closet Lights On Pico Remote
  #################################################################

- alias: Lights - Bedroom Closet Lights On Pico Remote
  id: 'lights_bedroom_closet_lights_on_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 2
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness_pct: 100
        color_temp: 370

  #################################################################
  ## Bedroom Closet Lights Off Pico Remote
  #################################################################

- alias: Lights - Bedroom Closet Lights Off Pico Remote
  id: 'lights_bedroom_closet_lights_off_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 4
        action: press

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_closet_lights
    - delay:
        seconds: 1

  #################################################################
  ## Bedroom Closet Lights Increase Brightness Pico Remote
  #################################################################

- alias: Lights - Bedroom Closet Lights Increase Brightness Pico Remote
  id: 'lights_bedroom_closet_lights_increase_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 5
        action: press

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness_step_pct: 20
    - delay:
        seconds: 1

  #################################################################
  ## Bedroom Closet Lights Decrease Brightness Pico Remote
  #################################################################

- alias: Lights - Bedroom Closet Lights Decrease Brightness Pico Remote
  id: 'lights_bedroom_closet_lights_decrease_brightness_pico_remote'

  triggers:
    - trigger: event
      event_type: lutron_caseta_button_event
      event_data:
        serial: 92034753
        button_number: 6
        action: press

  conditions:
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness_step_pct: -20
    - delay:
        seconds: 1

#################################################################
## Aurora Dimmers
#################################################################

  #################################################################
  ## Bedroom Lamps Dimmer
  #################################################################

  mode: single
  max_exceeded: silent
- alias: Lights - Bedroom Lamps Dimmer
  id: 'lights_bedroom_lamps_dimmer'

  triggers:
    - trigger: mqtt
      topic: "zigbee2mqtt/Bedroom Lamps Dimmer"

  conditions:
    - condition: template
      value_template: "{{ trigger.payload_json.action == \"brightness_move_to_level\"}}"

  actions:
    - data:
        entity_id: light.bedroom_lamps
        brightness: "{{ trigger.payload_json.action_level }}"
        transition: "{{ 0.7 }}"
      action: light.turn_on

  #################################################################
  ## Bedroom Ceiling Dimmer
  #################################################################

  mode: single
  max_exceeded: silent
- alias: Lights - Bedroom Ceiling Dimmer
  id: 'lights_bedroom_ceiling_dimmer'

  triggers:
    - trigger: mqtt
      topic: "zigbee2mqtt/Bedroom Ceiling Dimmer"

  conditions:
    - condition: template
      value_template: "{{ trigger.payload_json.action == \"brightness_move_to_level\"}}"

  actions:
    - data:
        entity_id: light.bedroom_ceiling
        brightness: "{{ trigger.payload_json.action_level }}"
        transition: "{{ 0.7 }}"
      action: light.turn_on#################################################################
## Locaiton Automations
#################################################################

        ##########################################################
        ## Household Away Mode Locks
        ##########################################################

- alias: Location - Household Away Mode Locks
  id: 'location_household_away_mode_locks'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
        - lock.front_door
        - lock.back_door
        - lock.basement_door

        ##########################################################
        ## Household Away Mode Helpers
        ##########################################################

- alias: Location - Household Away Mode Helpers
  id: 'location_household_away_mode_helpers'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.guest_mode
          - input_boolean.office_rainbow
          - input_boolean.livingroom_rainbow
          - input_boolean.front_porch_rainbow
          - input_boolean.pop_music
          - input_boolean.jazz_music
          - input_boolean.chill_music
          - input_boolean.electronic_music
          - input_boolean.classical_music
          - input_boolean.group_all_sonos

        ##########################################################
        ## Household Away Mode Switches
        ##########################################################

- alias: Location - Household Away Mode Switches
  id: 'location_household_away_mode_switches'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.USER1s_office_air_purifier
          - switch.lower_backyard_lighting
          - switch.backyard_patio_lighting
          - switch.fireplace
          - switch.bug_zapper
          - switch.USER1s_office_desktop_clock_display

        ##########################################################
        ## Household Away Mode Fans
        ##########################################################

- alias: Location - Household Away Mode Fans
  id: 'location_household_away_mode_fans'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: fan.turn_off
      target:
        entity_id:
          - fan.USER1s_office_fan
          - fan.living_room_east
          - fan.living_room_west

        ##########################################################
        ## Household Away Mode Media
        ##########################################################

- alias: Location - Household Away Mode Media
  id: 'location_household_away_mode_media'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 0
        seconds: 45

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "power_off"
    - action: select.select_option
      data:
        entity_id: select.bedroom_tv_activities
        option: "power_off"
    - action: select.select_option
      data:
        entity_id: select.USER1_s_office_tv_activities
        option: "power_off"
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "None"
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_surround_sound
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_backyard_patio
          - media_player.sonos_roam

        ##########################################################
        ## Household Away Mode Lights
        ##########################################################

- alias: Location - Household Away Mode Lights
  id: 'location_household_away_mode_lights'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: light.interior_lights
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_interior
    - delay: '00:00:60'
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_deck
    - action: light.turn_off
      target:
        entity_id:
          - light.backyard_patio

        ##########################################################
        ## Household Away Mode Blinds
        ##########################################################

- alias: Location - Household Away Mode Blinds
  id: 'location_household_away_mode_blinds'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: cover.kitchen_blinds
        state: 'open'
      - condition: state
        entity_id: cover.bedroom_closet_blinds
        state: 'open'
      - condition: state
        entity_id: cover.stairs_blinds
        state: 'open'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.stairs_blinds
    - delay: '00:00:15'
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.bedroom_closet_blinds
    - delay: '00:00:15'
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.kitchen_blinds

        ##########################################################
        ## USER1 Home from Walking Unlock Doors Turn On Garage Light
        ##########################################################

- alias: Location - USER1 Home from Waling Unlock Doors Turn On Garage Light
  id: 'location_USER1_home_from_walking_unlock_doors_turn_on_garage_light'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_away_driving
      state: 'off'

  actions:
    - action: lock.unlock
      target:
        entity_id:
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## USER1 Home from Driving Unlock Door
        ##########################################################

- alias: Location - USER1 Home from Driving Unlock Door
  id: 'location_USER1_home_from_driving_unlock_door'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_away_driving
      state: 'on'
    - condition: state
      entity_id: lock.back_door
      state: 'locked'

  actions:
    - action: lock.unlock
      target:
        entity_id: 
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## After USER1 Home Lock Doors
        ########################################################

- alias: Location - After USER1 Home Lock Doors
  id: 'location_after_USER1_home_lock_doors'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.back_door
          - lock.front_door
          - lock.basement_door

        ##########################################################
        ## USER2 Home from Walking Unlock Doors
        ##########################################################

- alias: Location - USER2 Home from Walking Unlock Doors
  id: 'location_USER2_home_from_walking_unlock_doors'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_away_driving
      state: 'off'

  actions:
    - action: lock.unlock
      target:
        entity_id:
          - lock.back_door
          - lock.front_door
          - lock.basement_door

        ##########################################################
        ## USER2 Home from Driving Unlock Door
        ##########################################################

- alias: Location - USER2 Home from Driving Unlock Door
  id: 'location_USER2_home_from_driving_unlock_door'

  triggers:
    - trigger: state
      entity_id: person.USER2
#      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_away_driving
      state: 'on'
    - condition: state
      entity_id: lock.back_door
      state: 'locked'

  actions:
    - action: lock.unlock
      target:
        entity_id: 
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## After USER2 Home Lock Doors
        ########################################################

- alias: Location - USER2 Home Lock Doors
  id: 'location_USER2_home_lock_doors'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.back_door
          - lock.front_door
          - lock.basement_door

        ##########################################################
        ## USER1 Home Turn On Lights
        ##########################################################

- alias: Location - USER1 Home Turn On Lights
  id: 'location_USER1_home_turn_on_lights'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
       color_temp: 370
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.media_center_lighting
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       color_temp: 366
       brightness_pct: 65

        ##########################################################
        ## USER1 Home Reset Front Porch Lights Brightness
        ##########################################################

- alias: Location - USER1 Home Reset Front Porch Lights Brightness
  id: 'location_USER1_home_reset_front_porch_lights_brightness'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 50
        transition: 120

        ##########################################################
        ## USER1 Home Reset Back Door Lights Brightness
        ##########################################################

- alias: Location - USER1 Home Reset Back Door Lights Brightness
  id: 'location_USER1_home_reset_back_door_lights_brightness'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 2
        transition: 120

        ##########################################################
        ## USER1 Home Dim Garage Light after 16 Mins
        ##########################################################

- alias: Location - USER1 Home Dim Garage Light after 16 Mins
  id: 'location_USER1_home_dim_garage_light_after_16_mins'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 2

        ##########################################################
        ## USER2 Home Turn On Lights
        ##########################################################

- alias: Location - USER2 Home Turn On Lights
  id: 'location_USER2_home_turn_on_lights'

  triggers:
    - trigger: state
      entity_id: person.USER2
      #from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
       color_temp: 370
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.media_center_lighting
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       color_temp: 366
       brightness_pct: 65

        ##########################################################
        ## USER2 Home from Work Lights Turn On Lights
        ##########################################################

- alias: Location - USER2 Home from Work Turn On Lights
  id: 'location_USER2_home_from_work_turn_on_lights'

  triggers:
    - trigger: state
      entity_id: person.USER2
      #from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: time
      after: '15:45:00'
      before: '17:30:00'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_lights
      data:
       brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1s_nightstand
      data:
       transition: 90
       brightness_pct: 50
    - action: light.turn_on
      target:
        entity_id:
          - light.USER2s_nightstand
      data:
       transition: 90
       brightness_pct: 50
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_lamp
      data:
       transition: 90
       brightness_pct: 50
    - action: light.turn_on
      target:
        entity_id:
          - light.closet_lamp
      data:
       transition: 90
       brightness_pct: 50

        ##########################################################
        ## USER2 Home Reset Front Porch Lights Brightness
        ##########################################################

- alias: Location - USER2 Home Reset Front Porch Lights Brightness
  id: 'location_USER2_home_reset_front_porch_lights_brightness'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.front_porch
      data:
        brightness_pct: 50
        transition: 120

        ##########################################################
        ## USER2 Home Reset Back Door Lights Brightness
        ##########################################################

- alias: Location - USER2 Home Reset Back Door Lights Brightness
  id: 'location_USER2_home_reset_back_door_lights_brightness'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.back_door
      data:
        brightness_pct: 2
        transition: 120

        ##########################################################
        ## USER2 Home Dim Garage Light after 16 Mins
        ##########################################################

- alias: Location - USER2 Home Dim Garage Light after 16 Mins
  id: 'location_USER2_home_dim_garage_light_after_16_mins'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.garage_light
      data:
       brightness_pct: 2

        ##########################################################
        ## USER1 Away Shut Off Office
        ##########################################################

- alias: Location - USER1 Away Shut Off Office
  id: 'location_USER1_away_shut_off_office'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.USER1s_office_air_purifier
          - switch.USER1s_office_desktop_clock_display
    - action: fan.turn_off
      target:
        entity_id:
          - fan.USER1s_office_fan
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights
    - action: select.select_option
      data:
        entity_id: select.USER1_s_office_tv_activities
        option: "power_off"

        ##########################################################
        ## USER1 Away Close Blinds
        ##########################################################

- alias: Location - USER1 Away Close Blinds
  id: 'location_USER1_away_close_blinds'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1_s_office_blinds

        ##########################################################
        ## USER1 Away Close Blinds Window Open
        ##########################################################

- alias: Location - USER1 Away Close Blinds Window Open
  id: 'location_USER1_away_shut_off_office_window_open'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'off'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: cover.USER1s_office_blinds_right
        position: 45
    - action: notify.USER1_devices
      data:
        message: Office Window Open!

        ##########################################################
        ## USER1 Away Close Blinds Portable AC
        ##########################################################

- alias: Location - USER1 Away Close Blinds Portable AC
  id: 'location_USER1_away_shut_off_office_portable_ac'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_window_right
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_office_portable_ac
      state: 'on'

  actions:
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER1s_office_blinds_left
          - cover.USER1s_office_blinds_center
    - action: cover.set_cover_position
      data:
        entity_id: cover.USER1s_office_blinds_right
        position: 13

        ##########################################################
        ## USER2 Away Shut Off Office
        ##########################################################

- alias: Location - USER2 Away Shut Off Office
  id: 'location_USER2_away_shut_off_office'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_s_office_ceiling
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2_s_office_blinds

        ##########################################################
        ## USER2 Away Shut Off Office Portable AC
        ##########################################################

- alias: Location - USER2 Away Shut Off Office Portable AC
  id: 'location_USER2_away_shut_off_office_portable_ac'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_office_portable_ac
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_s_office_ceiling
    - action: cover.close_cover
      data:
        entity_id: 
          - cover.USER2s_office_blinds_left
    - action: cover.set_cover_position
      data:
        entity_id: 
          - cover.USER2s_office_blinds_right
        position: 15

        ##########################################################
        ## USER1 Away Lock Doors
        ##########################################################

- alias: Location - USER1 Away Lock Doors
  id: 'location_USER1_away_lock_doors'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.front_door
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## USER2 Away Lock Doors
        ##########################################################

- alias: Location - USER2 Away Lock Doors
  id: 'location_USER2_away_lock_doors'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER2_away
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.front_door
          - lock.back_door
          - lock.basement_door

        ##########################################################
        ## Turn Off Lights when USER2 Leaves
        ##########################################################

- alias: Location - Turn Off Lights when USER2 Leaves
  id: 'location_turn_off_lights_when_USER2_leaves'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: time
      after: '06:00:00'
      before: '07:30:00'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.interior_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.garage_light
    - delay: '00:00:30'
    - action: light.turn_off
      target:
        entity_id:
          - light.back_door

        ##########################################################
        ## Turn On Outdoor Lighting when Home
        ##########################################################

- alias: Location - Turn On Outdoor Lighting when Home
  id: 'location_turn_on_outdoor_lighting_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.disable_home_away
          state: 'off'
        - condition: state
          entity_id: sun.sun
          state: 'below_horizon'
        - condition: or
          conditions:
            - condition: state
              entity_id: input_boolean.USER1_away
              state: 'on'
            - condition: state
              entity_id: input_boolean.USER2_away
              state: 'on'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
#          - switch.front_yard_lighting
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_patio
      data:
        brightness_pct: 10
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_deck
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn On Backyard Lighting when Friends Visiting
        ##########################################################

- alias: Location - Turn On Backyard Lighting when Friends Visiting
  id: 'location_turn_on_backyard_lighting_when_friends_visiting'

  triggers:
    - trigger: state
      entity_id: input_boolean.guest_mode
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: time
      after: '13:00:00'
      before: '23:59:00'

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.backyard_patio_lighting
          - switch.lower_backyard_lighting
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_patio
      data:
        brightness_pct: 10
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.backyard_deck
      data:
        brightness_pct: 2

        ##########################################################
        ## Set USER1 Away Driving
        ##########################################################

- alias: Location - Set USER1 Away Driving
  id: 'location_set_USER1_away_driving'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.USER1_away_driving

        ##########################################################
        ## Set USER1 Away after 1 Min
        ##########################################################

- alias: Location - Set USER1 Away after 1 Min
  id: 'location_set_USER1_away_after_1_min'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.USER1_away
          - input_boolean.USER1_greeting

        ##########################################################
        ## Set USER1 Home after 10 Mins
        ##########################################################

- alias: Location - Set USER1 Home after 10 Mins
  id: 'location_set_USER1_home_after_10_mins'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 10
        seconds: 30

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.USER1_away
          - input_boolean.USER1_away_driving
          - input_boolean.USER1_greeting

        ##########################################################
        ## Set USER2 Away Driving
        ##########################################################

- alias: Location - Set USER2 Away Driving
  id: 'location_set_USER2_away_driving'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.USER2_away_driving

        ##########################################################
        ## Set USER2 Away after 1 Min
        ##########################################################

- alias: Location - Set USER2 Away after 1 Min
  id: 'location_set_USER2_away_after_1_min'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.USER2_away
          - input_boolean.USER2_greeting

        ##########################################################
        ## Set USER2 Home after 10 Mins
        ##########################################################

- alias: Location - Set USER2 Home after 10 Mins
  id: 'location_set_USER2_home_after_10_min'

  triggers:
    - trigger: state
      entity_id: person.USER2
      #from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.USER2_away
          - input_boolean.USER2_away_driving
          - input_boolean.USER2_greeting

#################################################################
## Notifications
#################################################################

    #################################################################
    ## USER1 Home Driving iOS Notification
    #################################################################

- alias: Location - USER1 Home Driving iOS Notification
  id: 'location_USER1_home_driving_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_away_driving
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER1 Home
        data:
          tag: USER1-location
          entity_id: camera.driveway

    #################################################################
    ## USER1 Home Walking iOS Notification
    #################################################################

- alias: Location - USER1 Home Walking iOS Notification
  id: 'location_USER1_home_walking_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_away_driving
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER1 Home
        data:
          tag: USER1-location
          entity_id: camera.front_porch

    #################################################################
    ## USER1 Away iOS Notification
    #################################################################

- alias: Location - USER1 Away iOS Notification
  id: 'location_USER1_away_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER1
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER1 Away
        data:
          tag: USER1-location

        #################################################################
        ## USER2 Home Driving iOS Notification 
        #################################################################

- alias: Location - USER2 Home Driving iOS Notification
  id: 'location_USER2_home_driving_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_away_driving
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER2 Home
        data:
          tag: USER2-location
          entity_id: camera.driveway

        #################################################################
        ## USER2 Home Walking iOS Notification
        #################################################################

- alias: Location - USER2 Home Walking iOS Notification
  id: 'location_USER2_home_walking_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_away_driving
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER2 Home
        data:
          tag: USER2-location
          entity_id: camera.front_porch

        #################################################################
        ## USER2 Away iOS Notification
        #################################################################

- alias: Location - USER2 Away iOS Notification
  id: 'location_USER2_away_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: USER2 Away
        data:
          tag: USER2-location

        #################################################################
        ## USER2 Left Work iOS Notification
        #################################################################

- alias: Location - USER2 Left Work iOS Notification
  id: 'location_USER2_left_work_ios_notification'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "USER2 has left work, ETA: {{states('sensor.USER2_to_home')}} mins"
        data:
          tag: USER2-location

        ##########################################################
        ## Welcome Home USER1 Audio Greeting
        ##########################################################

- alias: Location - Welcome Home USER1 Audio Greeting
  id: 'location_welcome_home_USER1_audio_greeting'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '22:00:00'

  actions:
    - delay: '00:00:08'
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_kitchen
          - media_player.sonos_move
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Welcome home, USER1."
        media_content_type: "music"
        extra:
          volume: 45
    - delay: '00:00:30'
    - action: homeassistant.turn_off
      entity_id: input_boolean.USER1_greeting

        ##########################################################
        ## Notify USER2s Office that USER1 is Home
        ##########################################################

- alias: Location - Notify USER2s Office that USER1 is Home
  id: 'location_notify_USER2s_office_that_USER1_is_home'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER2_office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '22:00:00'

  actions:
    - delay: '00:00:10'
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_USER2s_office
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="USER1, is Home."
        media_content_type: "music"
        extra:
          volume: 45

        ##########################################################
        ## Welcome Home USER2 Audio Greeting
        ##########################################################

- alias: Location - Welcome Home USER2 Audio Greeting
  id: 'location_welcome_home_USER2_audio_greeting'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '22:00:00'

  actions:
    - delay: '00:00:04'
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_kitchen
          - media_player.sonos_move
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Welcome home, USER2."
        media_content_type: "music"
        extra:
          volume: 45
    - delay: '00:00:30'
    - action: homeassistant.turn_off
      entity_id: input_boolean.USER2_greeting

        ##########################################################
        ## Notify USER1s Office that USER2 is Home
        ##########################################################

- alias: Location - Notify USER1s Office that USER2 is Home
  id: 'location_notify_USER1s_office_that_USER2_is_home'

  triggers:
    - trigger: state
      entity_id: binary_sensor.doors
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_greeting
      state: 'on'
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '22:00:00'

  actions:
    - delay: '00:00:10'
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_USER1s_office
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="USER2, is Home."
        media_content_type: "music"
        extra:
          volume: 45

        #################################################################
        ## USER2 Left Work Audio Notification
        #################################################################

- alias: Location - USER2 Left Work Audio Notification
  id: 'location_USER2_left_work_audio_notification'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'Work'
      to: 'not_home'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '19:00:00'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_move
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="USER2 has left work, and will arrive Home in about, {{states('sensor.USER2_to_home')}} minutes"
        media_content_type: "music"
        extra:
          volume: 45#################################################################
## Door Lock Automations
#################################################################

        ##########################################################
        ## Doorbell Fingerprint Unlock Front Door
        ##########################################################

- alias: Locks - doorbell fingerprint unlock front door
  id: 'locks_doorbell_fingerprint_unlock_front_door'

  triggers:
    - platform: event
      event_type: state_changed
      event_data:
        entity_id: event.front_door_camera_fingerprint

  conditions:
    - condition: state
      entity_id: lock.front_door
      state: 'locked'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: template
      value_template: >
        {{
          not trigger.event.data.old_state.attributes.get('restored', false) and
          not trigger.event.data.old_state.state == 'unavailable' and
          trigger.event.data.new_state is not none and
          trigger.event.data.new_state.attributes.event_type == 'identified' and
          (trigger.event.data.new_state.attributes.ulp_id|default('')) != '' and
          trigger.event.data.new_state.attributes.ulp_id in ['REDACTED', 'REDACTED']
        }}

  actions:
    - action: lock.unlock
      entity_id: lock.front_door

        ##########################################################
        ## Lock Front Door After 30 Mins
        ##########################################################

- alias: Locks - Lock Front Door After 30 Mins
  id: 'locks_lock_front_door_after_30_mins'

  triggers:
    - trigger: state
      entity_id: lock.front_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.front_door

        ##########################################################
        ## Lock Back Door After 2 Hours
        ##########################################################

- alias: Locks - Lock Back Door After 2 Hours
  id: 'locks_lock_back_door_after_2_hours'

  triggers:
    - trigger: state
      entity_id: lock.back_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.back_door

        ##########################################################
        ## Lock Basement Door After 2 hours
        ##########################################################

- alias: Locks - Lock Basement Door After 45 Mins
  id: 'locks_lock_basement_door_after_45_mins'

  triggers:
    - trigger: state
      entity_id: lock.basement_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.basement_door_opened
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.basement_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.basement_door

        ##########################################################
        ## Lock Doors at 2a
        ##########################################################

- alias: Locks - Lock Doors at 2a
  id: 'locks_lock_back_door_at_2a'

  triggers:
    - trigger: time
      at: '02:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.doors
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.front_door
          - lock.back_door
          - lock.basement_door

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Locks Low Battery Notification
        ##########################################################

- alias: Locks - Low Battery Notification
  id: 'locks_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.front_door_lock_batt
          - sensor.back_door_lock_batt
          - sensor.basement_door_lock_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low"#################################################################
## Media Player Automations
#################################################################

        ##########################################################
        ## Turn Off Lamp 1 for TV
        ##########################################################

- alias: Media - Turn Off Lamp 1 for TV
  id: 'media_turn_off_lamp_1_for_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 35

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_lamp_1
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "power_off"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.apple.TVPhotos"

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lamp_1
      data:
       transition: 5

        ##########################################################
        ## Turn Off Lamp 1 for Game Consoles
        ##########################################################

- alias: Media - Turn Off Lamp 1 for Game Consoles
  id: 'media_turn_off_lamp_1_for_game_consoles'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: "Play Xbox"
      for:
        hours: 0
        minutes: 2
        seconds: 5
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: "Play Nintendo Switch"
      for:
        hours: 0
        minutes: 2
        seconds: 5

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_lamp_1
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "power_off"

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lamp_1
      data:
       transition: 5

        ##########################################################
        ## Turn On Lamp 1 for TV
        ##########################################################

- alias: Media - Turn On Lamp 1 for TV
  id: 'media_turn_on_lamp_1_for_tv'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      from: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 35
    - trigger: state
      entity_id: select.living_room_tv_activities
      from: "Play Xbox"
      for:
        hours: 0
        minutes: 0
        seconds: 35
    - trigger: state
      entity_id: select.living_room_tv_activities
      from: "Play Nintendo Switch"
      for:
        hours: 0
        minutes: 0
        seconds: 35

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_lamp_1
      state: 'off'
    - condition: state
      entity_id: light.living_room_lamp_2
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Xbox"
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Nintendo Switch"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        state: "playing"

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamp_1
      data:
       transition: 5
       color_temp: 370
       brightness_pct: 100

        ##########################################################
        ## Plex Lights On
        ##########################################################

- alias: Media - Plex Stopped Lights On
  id: 'media_plex_stopped_lights_on'

  triggers:
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'idle'
      for:
        hours: 0
        minutes: 0
        seconds: 10
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'paused'
      for:
        hours: 0
        minutes: 0
        seconds: 10

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id: light.living_room_lamps
      data:
       transition: 5
       color_temp: 370
       brightness_pct: 100
    - action: light.turn_on
      entity_id: light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id: 
          - light.hallway_light
      data:
       brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 40
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
       brightness_pct: 40
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 40
    - action: light.turn_on
      entity_id: light.kitchen_cabinets
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Plex Lights Off
        ##########################################################

- alias: Media - Plex Started Lights Off
  id: 'media_plex_started_lights_off'

  triggers:
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.watching_plex
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
       transition: 10
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_east
    - delay: '00:00:05'
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_west
    - delay: '00:00:15' 
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Watching Plex Boolean
        ##########################################################

- alias: Media - Turn Off Watching Plex Boolean
  id: 'media_turn_off_watching_plex_boolean'

  triggers:
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'idle'
      for:
        hours: 0
        minutes: 3
        seconds: 0
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'paused'
      for:
        hours: 0
        minutes: 3
        seconds: 0
    - trigger: state
      entity_id: media_player.plex_living_room_appletv
      to: 'unavailable'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.watching_plex

        ##########################################################
        ## Late Night TV Watching before Midnight Lights On
        ##########################################################

- alias: Media - Late Night TV Watching Lights On before Midnight
  id: 'media_late_night_tv_watching_lights_on_before_midnight'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 0
        seconds: 30
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '21:30:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id: light.living_room_lamps
      data:
       transition: 5
       color_temp: 370
       brightness_pct: 100
    - action: light.turn_on
      entity_id: light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      entity_id: light.hallway_light
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
       brightness_pct: 30
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Late Night TV Watching after Midnight Lights On
        ##########################################################

- alias: Media - Late Night TV Watching Lights On after Midnight
  id: 'media_late_night_tv_watching_lights_on_after_midnight'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'paused'
      for:
        hours: 0
        minutes: 0
        seconds: 30
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'idle'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '00:00:00'
      before: '03:00:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id: light.living_room_lamps
      data:
       transition: 5
       color_temp: 370
       brightness_pct: 100
    - action: light.turn_on
      entity_id: light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      entity_id: light.hallway_light
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
       brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
       brightness_pct: 30
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Late Night TV Watching after Midnight Lights Off
        ##########################################################

- alias: Media - Late Night TV Watching Lights Off after Midnight
  id: 'media_late_night_tv_watching_lights_off_after_midnight'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '00:00:00'
      before: '03:00:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.apple.TVPhotos"
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
       transition: 10
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_east
    - delay: '00:00:05'
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_west
    - delay: '00:00:15' 
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Late Night TV Watching before Midnight Lights Off
        ##########################################################

- alias: Media - Late Night TV Watching Lights Off before Midnight
  id: 'media_late_night_tv_watching_lights_off_before_midnight'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_apple_tv
      to: 'playing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_media_lights
      state: 'off'
    - condition: time
      after: '21:30:00'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: select.living_room_tv_activities
      state: "Watch TV"
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.google.ios.youtube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_name
        state: "YouTube"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        attribute: app_id
        state: "com.apple.TVPhotos"
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
       transition: 10
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_east
    - delay: '00:00:05'
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_west
    - delay: '00:00:15' 
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_accent_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Living Room TV Turn Off Harmony Activity if TV Off
        ##########################################################

- alias: Media - Living Room TV Turn Off Harmony Activity if TV Off
  id: 'media_living_room_tv_turn_off_harmony_activity_if_tv_off'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_tv
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: 'power_off'

  actions:
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "power_off"      

        ##########################################################
        ## Bedroom TV Turn Off Harmony Activity if TV Off
        ##########################################################

- alias: Media - Bedroom TV Turn Off Harmony Activity if TV Off
  id: 'media_bedroom_tv_turn_off_harmony_activity_if_tv_off'

  triggers:
    - trigger: state
      entity_id: media_player.bedroom_tv
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.bedroom_tv_activities
        state: 'power_off'

  actions:
    - action: select.select_option
      data:
        entity_id: select.bedroom_tv_activities
        option: "power_off"

      #################################################################
      ## Reset Sonos Every Morning
      #################################################################

- alias: Media - Reset Sonos Every Morning
  id: 'media_reset_sonos_every_morning'

  triggers:
    - trigger: time
      at: '05:00:00'

  actions:
    - action: media_player.unjoin
      target:
        entity_id:
          - media_player.sonos_surround_sound
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_backyard_patio
          - media_player.sonos_roam
    - action: media_player.clear_playlist
      target:
        entity_id:
          - media_player.sonos_surround_sound
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_backyard_patio
          - media_player.sonos_roam
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.pop_music
          - input_boolean.jazz_music
          - input_boolean.chill_music
          - input_boolean.classical_music
          - input_boolean.group_all_sonos
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "None"
    - action: switch.turn_off
      data:
        entity_id: 
          - switch.sonos_bedroom_night_sound
          - switch.sonos_fitness_room_night_sound
          - switch.sonos_surround_sound_night_sound

        ##########################################################
        ## Group All Sonos
        ##########################################################

- alias: Media - Group All Sonos
  id: 'media_group_all_sonos'

  triggers:
    - trigger: state
      entity_id: input_boolean.group_all_sonos
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.join
      data:
        entity_id:
          - media_player.sonos_living_room
        group_members:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_move

        ##########################################################
        ## Ungroup All Sonos
        ##########################################################

- alias: Media - Ugroup All Sonos
  id: 'media_ungroup_all_sonos'

  triggers:
    - trigger: state
      entity_id: input_boolean.group_all_sonos
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.unjoin
      data:
        entity_id:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_craft_room
          - media_player.sonos_fitness_room
          - media_player.sonos_move

        ##########################################################
        ## Play Pop Music
        ##########################################################

- alias: Media - Play Pop Music
  id: 'media_play_pop_music'

  triggers:
    - trigger: state
      entity_id: input_boolean.pop_music
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.join
      data:
        group_members:
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      target:
        entity_id:
          - media_player.sonos_living_room
    - delay: '00:00:05'
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      data:
        volume_level: 0.2
    - delay: '00:00:05'
    - action: media_player.select_source
      data:
        source: 'Pop Station'
      target:
        entity_id: 
          - media_player.sonos_living_room
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.classical_music
          - input_boolean.jazz_music
          - input_boolean.chill_music
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "Pop Music"

        ##########################################################
        ## Play Jazz Music
        ##########################################################

- alias: Media - Play Jazz Music
  id: 'media_play_jazz_music'

  triggers:
    - trigger: state
      entity_id: input_boolean.jazz_music
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.join
      data:
        group_members:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      target:
        entity_id:
          - media_player.sonos_living_room
    - delay: '00:00:05'
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      data:
        volume_level: 0.03
    - delay: '00:00:05'
    - action: media_player.select_source
      data:
        source: 'Smooth Jazz'
      target:
        entity_id: 
          - media_player.sonos_living_room
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.classical_music
          - input_boolean.pop_music
          - input_boolean.chill_music
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "Jazz Music"

        ##########################################################
        ## Play Classical Music
        ##########################################################

- alias: Media - Play Classical Music
  id: 'media_play_classical_music'

  triggers:
    - trigger: state
      entity_id: input_boolean.classical_music
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.join
      data:
        group_members:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      target:
        entity_id:
          - media_player.sonos_living_room
    - delay: '00:00:05'
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      data:
        volume_level: 0.03
    - delay: '00:00:05'
    - action: media_player.select_source
      data:
        source: 'Classical'
      target:
        entity_id: 
          - media_player.sonos_living_room
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.jazz_music
          - input_boolean.pop_music
          - input_boolean.chill_music
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "Classical Music"

        ##########################################################
        ## Play Chill Music
        ##########################################################

- alias: Media - Play Chill Music
  id: 'media_play_chill_music'

  triggers:
    - trigger: state
      entity_id: input_boolean.chill_music
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: media_player.join
      data:
        group_members:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      target:
        entity_id:
          - media_player.sonos_living_room
    - delay: '00:00:05'
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_living_room
          - media_player.sonos_surround_sound
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
      data:
        volume_level: 0.03
    - delay: '00:00:05'
    - action: media_player.select_source
      data:
        source: 'Chill'
      target:
        entity_id: 
          - media_player.sonos_living_room
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.jazz_music
          - input_boolean.pop_music
          - input_boolean.classical_music
    - action: input_select.select_option
      data:
        entity_id: input_select.sonos
        option: "Chill Music"

        ##########################################################
        ## Play Music USER1's Office
        ##########################################################

- alias: Media - Play Music USER1's Office
  id: 'media_play__music_USER1_office'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_music
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'

  actions:
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_USER1s_office
      data:
        volume_level: 0.1
    - delay: '00:00:01'
    - action: media_player.select_source
      data:
        source: 'Chill'
      target:
        entity_id: 
          - media_player.sonos_USER1s_office

        ##########################################################
        ## Stop Playing Music USER1's Office
        ##########################################################

- alias: Media - Stop Playing Music USER1's Office
  id: 'media_stop_playing_music_USER1_office'

  triggers:
    - trigger: state
      entity_id: input_boolean.USER1_s_office_music
      from: 'on'
      to: 'off'

  actions:
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_USER1s_office

        ##########################################################
        ## Sonos start activity from input select Pop Music
        ##########################################################

- alias: Media - Sonos start activity from input select Pop Music
  id: 'media_sonos_start_activity_from_input_select_pop_music'

  triggers:
    - trigger: state
      entity_id: input_select.sonos
      to: 'Pop Music'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.pop_music

        ##########################################################
        ## Sonos start activity from input select Jazz Music
        ##########################################################

- alias: Media - Sonos start activity from input select Jazz Music
  id: 'media_sonos_start_activity_from_input_select_jazz_music'

  triggers:
    - trigger: state
      entity_id: input_select.sonos
      to: 'Jazz Music'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.jazz_music

        ##########################################################
        ## Sonos start activity from input select Chill Music
        ##########################################################

- alias: Media - Sonos start activity from input select Chill Music
  id: 'media_sonos_start_activity_from_input_select_chill_music'

  triggers:
    - trigger: state
      entity_id: input_select.sonos
      to: 'Chill Music'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.chill_music

        ##########################################################
        ## Sonos start activity from input select Classical Music
        ##########################################################

- alias: Media - Sonos start activity from input select Classical Music
  id: 'media_sonos_start_activity_from_input_select_classical_music'

  triggers:
    - trigger: state
      entity_id: input_select.sonos
      to: 'Classical Music'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.classical_music

        ##########################################################
        ## Sonos stop activity from input select Off
        ##########################################################

- alias: Media - Sonos stop activity from input select Off
  id: 'media_sonos_stop_activity_from_input_select_off'

  triggers:
    - trigger: state
      entity_id: input_select.sonos
      to: 'None'

  actions:
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_surround_sound
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.pop_music
          - input_boolean.jazz_music
          - input_boolean.chill_music
          - input_boolean.classical_music
          - input_boolean.group_all_sonos

        ##########################################################
        ## Turn Down Backyard Sonos at 10p
        ##########################################################

- alias: Media - Turn Down Backyard Sonos at 10p
  id: 'media_turn_down_backyard_sonos_at_10p'

  triggers:
   - trigger: time
     at: '22:00:00'

  actions:
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_backyard_patio
      data:
        volume_level: 0.3

        ##########################################################
        ## Turn Off Backyard Sonos at Midnight
        ##########################################################

- alias: Media - Turn Off Backyard Sonos at Midnight
  id: 'media_turn_off_backyard_sonos_at_midnight'

  triggers:
   - trigger: time
     at: '23:59:00'

  actions:
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_backyard_patio
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_backyard_patio
      data:
        volume_level: 0

        ##########################################################
        ## Reset Backyard Sonos Volume if after 10p
        ##########################################################

- alias: Media - Reset Backyard Sonos Volume after 10p
  id: 'media_reset_backyard_sonos_volume_after_10p'

  triggers:
   - trigger: template
     value_template: '{{ states.media_player.sonos_backyard_patio.attributes.volume_level | int > 0.3 }}'

  conditions:
    - condition: time
      after: '22:00:00'
      before: '23:59:00'

  actions:
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_backyard_patio
      data:
        volume_level: 0.3

        ##########################################################
        ## Reset Backyard Sonos Volume if after Midnight
        ##########################################################

- alias: Media - Reset Backyard Sonos Volume after Midnight
  id: 'media_reset_backyard_sonos_volume_after_midnight'

  triggers:
   - trigger: template
     value_template: '{{ states.media_player.sonos_backyard_patio.attributes.volume_level | int > 0.3 }}'

  conditions:
    - condition: time
      after: '00:00:00'
      before: '06:00:00'

  actions:
    - action: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_backyard_patio
      data:
        volume_level: 0

        ##########################################################
        ## Turn on Bedroom Sonos Night Sound Weeknights
        ##########################################################

- alias: Media - Turn on Bedroom Sonos Night Sound Weeknights
  id: 'media_turn_on_bedroom_sonos_night_sound_weeknights'

  triggers:
    - trigger: time
      at: '22:00:00'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu

  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.sonos_bedroom_night_sound

        ##########################################################
        ## Fix Bedroom TV Sound Output Power On
        ##########################################################

- alias: Media - Fix Bedroom TV Sound Output Power On
  id: 'media_fix_bedroom_tv_sound_output_power_on'

  triggers:
    - trigger: state
      entity_id: media_player.bedroom_tv
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  actions:
    - action: webostv.select_sound_output
      data:
        entity_id: media_player.bedroom_tv
        sound_output: external_arc

        ##########################################################
        ## Fix Bedroom TV Sound Output When Changed
        ##########################################################

- alias: Media - Fix Bedroom TV Sound Output When Changed
  id: 'media_fix_bedroom_tv_sound_output_when_changed'

  triggers:
    - trigger: state
      entity_id: media_player.bedroom_tv
      attribute: sound_output
      from: external_arc
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: media_player.bedroom_tv
      state: 'on'

  actions:
    - action: webostv.select_sound_output
      data:
        entity_id: media_player.bedroom_tv
        sound_output: external_arc

        ##########################################################
        ## Fix Living Room TV Sound Output Power On
        ##########################################################

- alias: Media - Fix Living Room TV Sound Output Power On
  id: 'media_fix_living_room_tv_sound_output_power_on'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_tv
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  actions:
    - action: webostv.select_sound_output
      data:
        entity_id: media_player.living_room_tv
        sound_output: external_arc

        ##########################################################
        ## Fix Living Room TV Sound Output When Changed
        ##########################################################

- alias: Media - Fix Living Room TV Sound Output When Changed
  id: 'media_fix_living_room_tv_sound_output_when_changed'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_tv
      attribute: sound_output
      from: external_arc
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: media_player.living_room_tv
      state: 'on'

  actions:
    - action: webostv.select_sound_output
      data:
        entity_id: media_player.living_room_tv
        sound_output: external_arc

        ##########################################################
        ## Turn off Living Room Lights When Playing Xbox
        ##########################################################

- alias: Media - Turn off Living Room Lights When Playing Xbox
  id: 'media_turn_off_living_room_lights_when_playing_xbox'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      to: "Play Xbox"
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '05:00:00'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lamps
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_east
    - delay: '00:00:05' 
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_ceiling_west

        ##########################################################
        ## Turn on Living Room Lights When Done Playing Xbox
        ##########################################################

- alias: Media - Turn on Living Room Lights When Done Playing Xbox
  id: 'media_turn_on_living_room_lights_when_done_playing_xbox'

  triggers:
    - trigger: state
      entity_id: select.living_room_tv_activities
      from: "Play Xbox"
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '05:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights

        ##########################################################
        ## Set Living Room Remote Input when Xbox On
        ##########################################################

- alias: Media - Set Living Room Remote Input when Xbox On
  id: 'media_turn_set_living_room_remote_input_when_xbox_on'

  triggers:
    - trigger: state
      entity_id: media_player.living_room_xbox
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: media_player.living_room_tv
      state: 'on'

  actions:
    - action: select.select_option
      data:
        entity_id: select.living_room_tv_activities
        option: "Play Xbox"#################################################################
## Motion Automations
#################################################################

        ##########################################################
        ## Turn On Living Room Lights when Motion Detected at Night
        ##########################################################

- alias: Motion - Turn On Living Room Lights when Motion Detected at Night
  id: 'motion_turn_on_living_room_lights_when_motion_detected_at_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: light.living_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '02:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        state: 'playing'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Xbox"
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Nintendo Switch"

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        transition: 5
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Turn On Living Room Lights when Motion Detected at Night Weekends
        ##########################################################

- alias: Motion - Turn On Living Room Lights when Motion Detected at Night Weekends
  id: 'motion_turn_on_living_room_lights_when_motion_detected_at_night_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: light.living_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '02:00:00'
      before: '03:00:00'
    - condition: time
      weekday:
        - fri
        - sat
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        state: 'playing'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Xbox"
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Nintendo Switch"

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        transition: 5
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Turn On Living Room Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Living Room Lights when Motion Detected Daytime
  id: 'motion_turn_on_living_room_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: input_boolean.watching_plex
      state: 'off'
    - condition: state
      entity_id: light.living_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: time
      after: '07:00:00'
      before: '02:00:00'
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.living_room_light_level
        below: 15
      - condition: state
        entity_id: sensor.living_room_light_level
        state: 'unknown'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.living_room_apple_tv
        state: 'playing'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Xbox"
    - condition: not
      conditions:
      - condition: state
        entity_id: select.living_room_tv_activities
        state: "Play Nintendo Switch"

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        transition: 5
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id: 
          - light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65

        ##########################################################
        ## Turn Off Living Room Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Living Room Lights when No Motion Detected
  id: 'motion_turn_off_living_room_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights

        ##########################################################
        ## Turn Off Living Room Lights when No Motion Detected when Daytime
        ##########################################################

- alias: Motion - Turn Off Living Room Lights when No Motion Detected when Daytime
  id: 'motion_turn_off_living_room_lights_when_no_motion_detected_when_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights

        ##########################################################
        ## Turn Off Living Room Lights when No Motion Detected when Daytime USER2 Away
        ##########################################################

- alias: Motion - Turn Off Living Room Lights when No Motion Detected when Daytime USER2 Away
  id: 'motion_turn_off_living_room_lights_when_no_motion_detected_when_daytime_USER2_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights

        ##########################################################
        ## Turn On Living Room Fans when Motion Detected and USER2 Away
        ##########################################################

- alias: Motion - Turn On Living Room Fans when Motion Detected and USER2 Away
  id: 'motion_turn_on_living_room_fans_when_motion_detected_and_USER2_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: fan.living_room_fans
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'

  actions:
    - action: fan.turn_on
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west

        ##########################################################
        ## Turn On Living Room Fans when Motion Detected at Night
        ##########################################################

- alias: Motion - Turn On Living Room Fans when Motion Detected at Night
  id: 'motion_turn_on_living_room_fans_when_motion_detected_at_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: fan.living_room_fans
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '21:30:00'
      before: '02:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: fan.turn_on
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west

        ##########################################################
        ## Turn Off Living Room Fans when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Living Room Fans when No Motion Detected
  id: 'motion_turn_off_living_room_fans_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.living_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: fan.living_room_fans
      state: 'on'

  actions:
    - action: fan.turn_off
      target:
        entity_id:
          - fan.living_room_east
          - fan.living_room_west

        ##########################################################
        ## Turn On Kitchen Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On Kitchen Lights when Motion Detected Evening
  id: 'motion_turn_on_kitchen_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '22:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
        brightness_pct: 2
    - action: light.turn_on
      entity_id: light.kitchen_sink
      data:
       brightness_pct: 40
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_ceiling
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn On Kitchen Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On Kitchen Lights when Motion Detected Night
  id: 'motion_turn_on_kitchen_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
        brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
       brightness_pct: 2

        ##########################################################
        ## Turn On Kitchen Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Kitchen Lights when Motion Detected Daytime
  id: 'motion_turn_on_kitchen_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.kitchen_light_level
        below: 40
      - condition: state
        entity_id: sensor.kitchen_light_level
        state: 'unknown'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_cabinets
      data:
        brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off Kitchen Lights when No Motion Detected Evenings
        ##########################################################

- alias: Motion - Turn Off Kitchen Lights when No Motion Detected Evenings
  id: 'motion_turn_off_kitchen_lights_when_no_motion_detected_evenings'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '06:00:00'
      before: '22:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights when No Motion Detected Weeknights
        ##########################################################

- alias: Motion - Turn Off Kitchen Lights when No Motion Detected Weeknights
  id: 'motion_turn_off_kitchen_lights_when_no_motion_detected_weeknights'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '06:00:00'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights when No Motion Detected Weekends
        ##########################################################

- alias: Motion - Turn Off Kitchen Lights when No Motion Detected Weekends
  id: 'motion_turn_off_kitchen_lights_when_no_motion_detected_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 45
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '06:00:00'
    - condition: time
      weekday:
        - fri
        - sat
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights when No Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn Off Kitchen Lights when No Motion Detected Daytime
  id: 'motion_turn_off_kitchen_lights_when_no_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 45
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights when No Motion Detected Daytime USER2 Away
        ##########################################################

- alias: Motion - Turn Off Kitchen Lights when No Motion Detected Daytime USER2 Away
  id: 'motion_turn_off_kitchen_lights_when_no_motion_detected_daytime_USER2_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn On Dining Room Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On Dining Room Lights when Motion Detected Evening
  id: 'motion_turn_on_dining_room_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '21:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
          - light.dining_room_ceiling
      data:
       brightness_pct: 25

        ##########################################################
        ## Turn On Dining Room Lights when Motion Detected Night Weekdays
        ##########################################################

- alias: Motion - Turn On Dining Room Lights when Motion Detected Night Weekdays
  id: 'motion_turn_on_dining_room_lights_when_motion_detected_night_weekdays'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '23:59:00'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
        brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 2

        ##########################################################
        ## Turn On Dining Room Lights when Motion Detected Night Weekends
        ##########################################################

- alias: Motion - Turn On Dining Room Lights when Motion Detected Night Weekends
  id: 'motion_turn_on_dining_room_lights_when_motion_detected_night_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.living_room_guest
      state: 'off'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '21:00:00'
      before: '02:00:00'
    - condition: time
      weekday:
        - fri
        - sat
        - sun
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
        brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 2

        ##########################################################
        ## Turn On Dining Room Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Dining Room Lights when Motion Detected Daytime
  id: 'motion_turn_on_dining_room_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.dining_room_light_level
        below: 25
      - condition: state
        entity_id: sensor.dining_room_light_level
        state: 'unknown'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
        brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 25

        ##########################################################
        ## Turn Off Dining Room Lights when No Motion Detected Weeknights
        ##########################################################

- alias: Motion - Turn Off Dining Room Lights when No Motion Detected Weeknights
  id: 'motion_turn_off_dining_room_lights_when_no_motion_detected_weeknights'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Dining Room Lights when No Motion Detected Evenings
        ##########################################################

- alias: Motion - Turn Off Dining Room Lights when No Motion Detected Evenings
  id: 'motion_turn_off_dining_room_lights_when_no_motion_detected_evenings'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '06:00:00'
      before: '22:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights

        ##########################################################
        ## Turn Off Dining Room Lights when No Motion Detected Weekends
        ##########################################################

- alias: Motion - Turn Off Dining Room Lights when No Motion Detected Weekends
  id: 'motion_turn_off_dining_room_lights_when_no_motion_detected_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: time
      weekday:
        - fri
        - sat
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Dining Room Lights when No Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn Off Dining Room Lights when No Motion Detected Daytime
  id: 'motion_turn_off_dining_room_lights_when_no_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Dining Room Lights when No Motion Detected Daytime USER2 Away
        ##########################################################

- alias: Motion - Turn Off Dining Room Lights when No Motion Detected Daytime USER2 Away
  id: 'motion_turn_off_dining_room_lights_when_no_motion_detected_daytime_USER2_away'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn On Bathroom Lights when Motion Detected Morning
        ##########################################################

- alias: Motion - Turn On Bathroom Lights when Motion Detected Morning
  id: 'motion_turn_on_bathroom_lights_when_motion_detected_morning'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'off'
    - condition: time
      after: '05:45:00'
      before: '09:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
        brightness_pct: 50
        transition: 60
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_shower
      data:
        brightness_pct: 25
        transition: 60

        ##########################################################
        ## Turn On Bathroom Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Bathroom Lights when Motion Detected Daytime
  id: 'motion_turn_on_bathroom_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: time
      after: '09:00:00'
      before: '22:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
        brightness_pct: 50
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_shower
      data:
        brightness_pct: 25

        ##########################################################
        ## Turn On Bathroom Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On Bathroom Lights when Motion Detected Evening
  id: 'motion_turn_on_bathroom_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00:00'
      before: '22:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
        brightness_pct: 75
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_shower
      data:
        brightness_pct: 25

        ##########################################################
        ## Turn On Bathroom Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On Bathroom Lights when Motion Detected Night
  id: 'motion_turn_on_bathroom_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '00:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
        brightness_pct: 25

        ##########################################################
        ## Turn On Bathroom Lights when Motion Detected Late Night
        ##########################################################

- alias: Motion - Turn On Bathroom Lights when Motion Detected Late Night
  id: 'motion_turn_on_bathroom_lights_when_motion_detected_late_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '00:00:00'
      before: '05:45:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_vanity
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn Off Bathroom Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Bathroom Lights when No Motion Detected
  id: 'motion_turn_off_bathroom_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'on'
    - condition: time
      after: '06:00:00'
      before: '23:59:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights

        ##########################################################
        ## Turn Off Bathroom Lights when No Motion Detected Late Night
        ##########################################################

- alias: Motion - Turn Off Bathroom Lights when No Motion Detected Late Night
  id: 'motion_turn_off_bathroom_lights_when_no_motion_detected_late_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'on'
    - condition: time
      after: '00:00:00'
      before: '06:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights        
        
        ##########################################################
        ## Turn On Stair Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On Stair Lights when Motion Detected Evening
  id: 'motion_turn_on_stair_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.stairs_light
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '22:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.stairs_light
      data:
        brightness_pct: 75

        ##########################################################
        ## Turn On Stair Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On Stair Lights when Motion Detected Night
  id: 'motion_turn_on_stair_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.stairs_light
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.stairs_light
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn On Stair Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Stair Lights when Motion Detected Daytime
  id: 'motion_turn_on_stair_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.stairs_light
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.stairs_light_level
        below: 15
      - condition: state
        entity_id: sensor.stairs_light_level
        state: 'unknown'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.stairs_light
      data:
        brightness_pct: 15

        ##########################################################
        ## Turn Off Stair Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Stair Lights when No Motion Detected
  id: 'motion_turn_off_stair_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '22:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.stairs_light

        ##########################################################
        ## Turn Off Stair Lights when No Motion Detected Night
        ##########################################################

- alias: Motion - Turn Off Stair Lights when No Motion Detected Night
  id: 'motion_turn_off_stair_lights_when_no_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.stairs_light

        ##########################################################
        ## Turn Off Stair Lights when No Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn Off Stair Lights when No Motion Detected Daytime
  id: 'motion_turn_off_stair_lights_when_no_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.stairs_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.stairs_light

        ##########################################################
        ## Turn On Basement Lights when Motion Detected
        ##########################################################

- alias: Motion - Turn On Basement Lights when Motion Detected
  id: 'motion_turn_on_basement_lights_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_stairs
        state: 'off'
      - condition: state
        entity_id: light.basement_lights
        state: 'off'
      - condition: state
        entity_id: light.work_bench_light
        state: 'off'
      - condition: state
        entity_id: light.laundry_room_light
        state: 'off'
      - condition: state
        entity_id: light.basement_lamp
        state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_stairs
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
      data:
        brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.work_bench_light
      data:
        brightness_pct: 25
    - action: light.turn_on
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lamp
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off Basement Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Basement Lights when No Motion Detected
  id: 'motion_turn_off_basement_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.basement_lighting
      state: 'on'
    - condition: state
      entity_id: binary_sensor.fitness_room_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.craft_room_motion
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.work_bench_light
    - action: light.turn_off
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lamp

        ##########################################################
        ## Turn Off Basement Lights when No Motion Detected Night
        ##########################################################

- alias: Motion - Turn Off Basement Lights when No Motion Detected Night
  id: 'motion_turn_off_basement_lights_when_no_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.basement_lighting
      state: 'on'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_stairs
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.work_bench_light
    - action: light.turn_off
      target:
        entity_id:
          - light.laundry_room_light
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lamp

        ##########################################################
        ## Turn On Craft Room Lights when Motion Detected
        ##########################################################

- alias: Motion - Turn On Craft Room Lights when Motion Detected
  id: 'motion_turn_on_craft_room_lights_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.craft_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.craft_room_ceiling
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.craft_room_ceiling
      data:
        brightness_pct: 100
    - action: light.turn_on
      data:
        brightness_pct: 100
        effect: Club
      target:
        entity_id: 
          - light.jupitier_globe

        ##########################################################
        ## Turn Off Craft Room Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Craft Room Lights when No Motion Detected
  id: 'motion_turn_off_craft_room_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.craft_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.craft_room_ceiling
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.craft_room_ceiling
          - light.jupitier_globe

        ##########################################################
        ## Turn Off Craft Room Lights when No Motion Detected Night
        ##########################################################

- alias: Motion - Turn Off Craft Room Lights when No Motion Detected Night
  id: 'motion_turn_off_craft_room_lights_when_no_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.craft_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.craft_room_ceiling
      state: 'on'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.craft_room_ceiling
          - light.jupitier_globe

        ##########################################################
        ## Turn On Fitness Room Lights when Motion Detected
        ##########################################################

- alias: Motion - Turn On Fitness Room Lights when Motion Detected
  id: 'motion_turn_on_fitness_room_lights_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.fitness_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.fitness_room_ceiling
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.fitness_room_ceiling
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off Fitness Room Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Fitness Room Lights when No Motion Detected
  id: 'motion_turn_off_fitness_room_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.fitness_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.fitness_room_ceiling
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.fitness_room_ceiling

        ##########################################################
        ## Turn Off Fitness Room Lights when No Motion Detected Night
        ##########################################################

- alias: Motion - Turn Off Fitness Room Lights when No Motion Detected Night
  id: 'motion_turn_off_fitness_room_lights_when_no_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.fitness_room_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.fitness_room_ceiling
      state: 'on'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.fitness_room_ceiling

        ##########################################################
        ## Turn On USER2 Closet Light when Motion Detected Weekdays
        ##########################################################

- alias: Motion - Turn On USER2 Closet Light when Motion Detected Weekdays
  id: 'motion_turn_on_USER2_closet_light_when_motion_detected_weekdays'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2_bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.USER2s_bedroom_closet
      state: 'off'
    - condition: time
      after: '04:30:00'
      before: '22:30:00'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER2s_bedroom_closet
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn On USER2 Closet Light when Motion Detected Weekends
        ##########################################################

- alias: Motion - Turn On USER2 Closet Light when Motion Detected Weekends
  id: 'motion_turn_on_USER2_closet_light_when_motion_detected_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2_bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.USER2s_bedroom_closet
      state: 'off'
    - condition: time
      weekday:
        - fri
        - sat
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER2s_bedroom_closet
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn Off USER2 Closet Light when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER2 Closet Light when No Motion Detected
  id: 'motion_turn_off_USER2_closet_light_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2_bedroom_closet_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER2s_bedroom_closet
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2s_bedroom_closet

        ##########################################################
        ## Turn On USER1 Office Fan when Motion Detected
        ##########################################################

- alias: Motion - Turn On USER1 Office Fan when Motion Detected
  id: 'motion_turn_on_USER1_office_fan_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: fan.USER1s_office_fan
      state: 'off'
    - condition: state
      entity_id: switch.USER1s_office_air_purifier
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: fan.turn_on
      target:
        entity_id:
          - fan.USER1s_office_fan
    - delay: '00:00:01'
    - action: fan.set_preset_mode
      target:
        entity_id: fan.USER1s_office_fan
      data:
        preset_mode: Auto
    - action: climate.set_hvac_mode
      data:
        entity_id: 
          - climate.office_fan
        hvac_mode: cool
    - delay: '00:00:01'
    - action: fan.oscillate
      data:
        entity_id: 
          - fan.USER1s_office_fan
        oscillating: 'true'
    - action: switch.turn_on
      target:
        entity_id:
          - switch.USER1s_office_air_purifier

        ##########################################################
        ## Turn On USER1 Office TV when Motion Detected
        ##########################################################

- alias: Motion - Turn On USER1 Office TV when Motion Detected
  id: 'motion_turn_on_USER1_office_tv_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: select.USER1_s_office_tv_activities
      state: "power_off"
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: select.select_option
      data:
        entity_id: select.USER1_s_office_tv_activities
        option: "Watch TV"
    - delay: '00:00:30'
    - action: media_player.select_source
      data:
        source: Protect
      target:
        entity_id: media_player.USER1_s_office_apple_tv

        ##########################################################
        ## Turn Off USER1 Office Fan when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER1 Office Fan when No Motion Detected
  id: 'motion_turn_off_USER1_office_fan_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: fan.turn_off
      target:
        entity_id:
          - fan.USER1s_office_fan
    - action: switch.turn_off
      target:
        entity_id:
          - switch.USER1s_office_air_purifier

        ##########################################################
        ## Turn Off USER1 Office TV when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER1 Office TV when No Motion Detected
  id: 'motion_turn_off_USER1_office_tv_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 20
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.USER1_s_office_tv_activities
        state: "power_off"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        state: 'playing'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: select.select_option
      data:
        entity_id: select.USER1_s_office_tv_activities
        option: "power_off"

        ##########################################################
        ## Turn On USER1 Office Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On USER1 Office Lights when Motion Detected Night
  id: 'motion_turn_on_USER1_office_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER1_s_office_ceiling
      state: 'off'
    - condition: state
      entity_id: light.USER1_office_desk_accent
      state: 'off'
    - condition: state
      entity_id: light.office_lamp
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.USER1_s_office_tv_activities
        state: "Play Xbox One"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        state: 'playing'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id: light.office_lamp
      data:
        transition: 60
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      entity_id: light.USER1_office_desk_accent
      data:
        transition: 60
        brightness_pct: 80
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_s_office_ceiling
      data:
        brightness_pct: 15
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370

        ##########################################################
        ## Turn On USER1 Office Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On USER1 Office Lights when Motion Detected Daytime
  id: 'motion_turn_on_USER1_office_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.USER1_s_office_ceiling
      state: 'off'
    - condition: state
      entity_id: light.office_lamp
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'closed'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: select.USER1_s_office_tv_activities
        state: "Play Xbox One"
    - condition: not
      conditions:
      - condition: state
        entity_id: media_player.USER1_s_office_apple_tv
        state: 'playing'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: light.turn_on
      entity_id: light.office_lamp
      data:
        brightness_pct: 100
        color_temp: 370
    - action: light.turn_on
      entity_id: light.USER1_office_desk_accent
      data:
        transition: 15
        brightness_pct: 80
        color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_s_office_ceiling
      data:
        brightness_pct: 15
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 370

        ##########################################################
        ## Turn On USER1 Office Moon Globe when Motion Detected
        ##########################################################

- alias: Motion - Turn On Moon Globe when Motion Detected
  id: 'motion_turn_on_USER1_office_moon_globe_when_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.moon_globe
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.moon_globe
      data:
        brightness_pct: 10
        color_temp: 238

        ##########################################################
        ## Turn Off USER1 Office Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER1 Office Lights when No Motion Detected
  id: 'motion_turn_off_USER1_office_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 20
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.USER1_office_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights

        ##########################################################
        ## Turn Off USER1 Office Music when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER1 Office Music when No Motion Detected
  id: 'motion_turn_off_USER1_office_music_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 20
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_office_guest
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id: 
          - input_boolean.USER1_s_office_music
    - delay: '00:00:15'
    - action: media_player.media_stop
      target:
        entity_id:
          - media_player.sonos_USER1s_office

        ##########################################################
        ## Turn Off USER1 Office Do Not Disturb No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER1 Office Do Not Disturb when No Motion Detected
  id: 'motion_turn_off_USER1_office_do_not_disturb_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 19
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'on'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.USER1_s_office_do_not_disturb

        ##########################################################
        ## Turn On Dining Room Lights Lights When USER2 Working
        ##########################################################

- alias: Motion - Turn On Dining Room Lights When USER2 Working
  id: 'motion_turn_on_dining_room_lights_when_USER2_working'

  triggers:
    - trigger: state
      entity_id: binary_sensor.dining_room_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '04:45:00'
      before: '07:00:00'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
        brightness_pct: 2
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 2

        ##########################################################
        ## Turn On USER2 Office Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On USER2 Office when Motion Detected Daytime
  id: 'motion_turn_on_USER2_office_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: light.USER2_s_office_ceiling
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id: 
          - light.USER2_s_office_ceiling
      data:
        brightness_pct: 75
        transition: 30

        ##########################################################
        ## Turn On USER2 Office Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On USER2 Office Lights when Motion Detected Evening
  id: 'motion_turn_on_USER2_office_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: light.USER2_s_office_ceiling
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '23:00:00'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id: 
          - light.USER2_s_office_ceiling
      data:
        brightness_pct: 100

        ##########################################################
        ## Turn On USER2 Office Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On USER2 Office Lights when Motion Detected Night
  id: 'motion_turn_on_USER2_office_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: light.USER2_s_office_ceiling
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '23:00:00'
      before: '07:00:00'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER2_s_office_ceiling
      data:
        brightness_pct: 15

        ##########################################################
        ## Turn Off USER2 Office Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off USER2 Office Lights when No Motion Detected
  id: 'motion_turn_off_USER2_office_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: light.USER2_office_lights
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_s_office_ceiling

        ##########################################################
        ## Turn Off USER2 Office Lights when No Motion Detected Night
        ##########################################################

- alias: Motion - Turn Off USER2 Office Lights when No Motion Detected Night
  id: 'motion_turn_off_USER2_office_lights_when_no_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER2s_office_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.USER2_s_office_ceiling
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '23:00:00'
      before: '07:00:00'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_s_office_ceiling

        ##########################################################
        ## Turn On Upstairs Bathroom Lights when Motion Detected Evening
        ##########################################################

- alias: Motion - Turn On Upstairs Bathroom Lights when Motion Detected Evening
  id: 'motion_turn_on_upstairs_bathroom_lights_when_motion_detected_evening'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.upstairs_bathroom_vanity
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '07:00:00'
      before: '22:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.upstairs_bathroom_vanity
      data:
        brightness_pct: 60

        ##########################################################
        ## Turn On Upstairs Bathroom Lights when Motion Detected Night
        ##########################################################

- alias: Motion - Turn On Upstairs Bathroom Lights when Motion Detected Night
  id: 'motion_turn_on_upstairs_bathroom_lights_when_motion_detected_night'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.upstairs_bathroom_vanity
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '22:00:00'
      before: '07:00:00'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.upstairs_bathroom_vanity
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn On Upstairs Bathroom Lights when Motion Detected Daytime
        ##########################################################

- alias: Motion - Turn On Upstairs Bathroom Lights when Motion Detected Daytime
  id: 'motion_turn_on_upstairs_bathroom_lights_when_motion_detected_daytime'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.upstairs_bathroom_vanity
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.upstairs_bathroom_light_level
        below: 10
      - condition: state
        entity_id: sensor.upstairs_bathroom_light_level
        state: 'unknown'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.upstairs_bathroom_vanity
      data:
        brightness_pct: 2

        ##########################################################
        ## Turn Off Upstairs Bathroom Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Upstairs Bathroom Lights when No Motion Detected
  id: 'motion_turn_off_upstairs_bathroom_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathroom_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.upstairs_bathroom_vanity
      state: 'on'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.upstairs_bathroom_vanity

        ##########################################################
        ## Turn On Bedroom Closet Lights when Motion Detected Early Morning
        ##########################################################

- alias: Motion - Turn On Bedroom Closet Lights when Motion Detected Early Morning
  id: 'motion_turn_on_bedroom_closet_lights_when_motion_detected_early_morning'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: time
      after: '05:00:00'
      before: '09:00:00'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'off'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'closed'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness: 2
        color_temp: 370

        ##########################################################
        ## Turn On Bedroom Closet Lights when Motion Detected Weekdays
        ##########################################################

- alias: Motion - Turn On Bedroom Closet Lights when Motion Detected Weekdays
  id: 'motion_turn_on_bedroom_closet_lights_when_motion_detected_weekdays'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: time
      after: '09:00:00'
      before: '22:30:00'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'off'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'closed'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness: 77
        color_temp: 370

        ##########################################################
        ## Turn On Bedroom Closet Lights when Motion Detected Weekends
        ##########################################################

- alias: Motion - Turn On Bedroom Closet Lights when Motion Detected Weekends
  id: 'motion_turn_on_bedroom_closet_lights_when_motion_detected_weekends'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bedroom_closet_motion
      from: 'off'
      to: 'on'

  conditions:
    - condition: time
      after: '09:00:00'
      before: '01:30:00'
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'off'
    - condition: state
      entity_id: cover.bedroom_closet_blinds
      state: 'closed'
    - condition: time
      weekday:
        - fri
        - sat

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_lights
      data:
        brightness: 77
        color_temp: 370

        ##########################################################
        ## Turn Off Bedroom Closet Lights when No Motion Detected
        ##########################################################

- alias: Motion - Turn Off Bedroom Closet Lights when No Motion Detected
  id: 'motion_turn_off_bedroom_closet_lights_when_no_motion_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bedroom_closet_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_motion
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: light.closet_lamp
        attribute: effect
        state: "Plantgrowth"

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_closet_lights

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Motion Sensor Low Battery Notification
        ##########################################################

- alias: Motion - Low Battery Notification
  id: 'motion_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id: 
        - sensor.living_room_motion_batt
        - sensor.dining_room_motion_batt
        - sensor.kitchen_motion_batt
        - sensor.bathroom_motion_batt
        - sensor.USER1s_office_motion_batt
        - sensor.USER2s_office_motion_batt
        - sensor.stairs_motion_batt
        - sensor.upstairs_bath_motion_batt
        - sensor.basement_motion_batt
        - sensor.craft_room_motion_batt
        - sensor.fitness_room_motion_batt
        - sensor.USER2s_closet_motion_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low"#################################################################
## Network
#################################################################

        ##########################################################
        ## Re-Enable Pi-hole After 30 Mins
        ##########################################################

- alias: Network - Re-Enable Pi-hole After 30 Mins
  id: 'network_reenable_pihole_after_30_mins'

  triggers:
    - trigger: state
      entity_id: input_boolean.pihole
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 31
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.pihole
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.pihole

        ##########################################################
        ## Disable Pi-hole
        ##########################################################

- alias: Network - Disable Pi-hole
  id: 'network_disable_pihole'

  triggers:
    - trigger: state
      entity_id: input_boolean.pihole
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  conditions:
    - condition: state
      entity_id: input_boolean.pihole
      state: 'off'

  actions:
    - action: script.pihole_disable
      data: {}

        ##########################################################
        ## Enable Pi-hole
        ##########################################################

- alias: Network - Enable Pi-hole
  id: 'network_enable_pihole'

  triggers:
    - trigger: state
      entity_id: input_boolean.pihole
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  conditions:
    - condition: state
      entity_id: input_boolean.pihole
      state: 'on'

  actions:
    - action: script.pihole_enable
      data: {}

#################################################################
## Notifications
#################################################################

    #################################################################
    ## WAN Down Notification
    #################################################################

- alias: Network - WAN Down Notification
  id: 'network_wan_down_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.wan
      to: 'off'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Internet is Down!
        data:
          tag: network

    #################################################################
    ## WAN Up Notification
    #################################################################

- alias: Network - WAN Up Notification
  id: 'network_wan_up_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.wan
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Internet is Up
        data:
          tag: network
#################################################################
## Occupancy Automations
#################################################################

        ##########################################################
        ## Turn Off Bedroom when Unoccupied
        ##########################################################

- alias: Occupancy - Turn Off Bedroom Lights when Unoccupied
  id: 'occupancy_turn_off_bedroom_lights_when_unoccupied'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bedroom_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_occupancy
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: not
      conditions:
      - condition: state
        entity_id: light.closet_lamp
        attribute: effect
        state: "Plantgrowth"

  actions:
    - action: light.turn_off
      target:
        entity_id: 
          - light.bedroom_lights

        ##########################################################
        ## Turn Off Guest Bedroom when Unoccupied
        ##########################################################

- alias: Occupancy - Turn Off Guest Bedroom Lights when Unoccupied
  id: 'occupancy_turn_off_guest_bedroom_lights_when_unoccupied'

  triggers:
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_occupancy
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'

  actions:
    - action: light.turn_off
      entity_id: light.guest_bedroom_lights
#################################################################
## Roomba Automations
#################################################################

#################################################################
## Vacuuming Automations
#################################################################

        ##########################################################
        ## Run Roombas Vacation Mode
        ##########################################################

- alias: Roomba - Run Roomba Vacation Mode
  id: 'roomba_run_vacation_mode'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
    - condition: time
      weekday:
        - mon
        - wed
        - fri
        - sat
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba
          - vacuum.basement_roomba
          - vacuum.upstairs_roomba

        ##########################################################
        ## Run Main Floor Roomba Weekdays
        ##########################################################

- alias: Roomba - Run Main Floor Roomba Weekdays
  id: 'roomba_run_main_floor_roomba_weekdays'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba

        ##########################################################
        ## Run Main Floor Roomba Weekdays Partial Clean
        ##########################################################

- alias: Roomba - Run Main Floor Roomba Weekdays Partial Clean
  id: 'roomba_run_main_floor_roomba_weekdays_partial_clean'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_kitchen
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_dining_room_table
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_bedroom
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_front_door
    - delay: '00:00:02'
    - action: python_script.main_floor_roomba

        ##########################################################
        ## Run Main Floor Roomba Weekends
        ##########################################################

- alias: Roomba - Run Main Floor Roomba Weekends
  id: 'roomba_run_main_floor_roomba_weekends'

  triggers:
   - trigger: time
     at: '11:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - sat
        - sun
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: select.living_room_tv_activities
      state: 'power_off'
    - condition: state
      entity_id: binary_sensor.living_room_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.dining_room_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.kitchen_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba

        ##########################################################
        ## Pause Main Floor Roomba when Doorbell Rings
        ##########################################################

- alias: Roomba - Pause Main Floor Roomba when Doorbell Rings
  id: 'roomba_pause_main_floor_roomba_when_doorbell_rings'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'cleaning'
    - condition: state
      entity_id: group.household
      state: 'home'

  actions:
    - action: vacuum.pause
      target:
        entity_id:
          - vacuum.main_floor_roomba
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.main_floor_roomba_pause

        ##########################################################
        ## Resume Main Floor Roomba after Doorbell Rings
        ##########################################################

- alias: Roomba - Resume Main Floor Roomba after Doorbell Rings
  id: 'roomba_resume_main_floor_roomba_after_doorbell_rings'

  triggers:
    - trigger: state
      entity_id: binary_sensor.front_door_camera_doorbell
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_doorbell
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_pause
      state: 'on'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'paused'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.main_floor_roomba_pause

        ##########################################################
        ## Run Main Floor Roomba when Away
        ##########################################################

- alias: Roomba - Run Main Floor Roomba when Away
  id: 'roomba_run_main_floor_roomba_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: time
      after: '08:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba

        ##########################################################
        ## Run Main Floor Roomba when Away Already Ran
        ##########################################################

- alias: Roomba - Run Main Floor Roomba when Away Already Ran
  id: 'roomba_run_main_floor_roomba_when_away_already_ran'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'on'
    - condition: time
      after: '08:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_front_door
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_back_door
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_bedroom
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_bedroom_closet
    - delay: '00:00:02'
    - action: python_script.main_floor_roomba

        ##########################################################
        ## Run Upstairs Roomba in USER1's Office
        ##########################################################

- alias: Roomba - Run Upstairs Roomba in USER1's Office
  id: 'roomba_run_upstairs_roomba_USER1_office'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1s_office_motion
      to: 'off'
      for:
        hours: 0
        minutes: 26
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran_USER1_office
      state: 'off'
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.upstairs_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_motion
      state: 'off'
      for:
        minutes: 10
    - condition: state
      entity_id: binary_sensor.USER1_s_macbook_pro_active
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: time
      after: '09:00:00'
      before: '18:30:00'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_USER1_office
          - input_boolean.upstairs_roomba_ran_USER1_office
    - delay: '00:00:02'
    - action: python_script.upstairs_roomba

        ##########################################################
        ## Run Upstairs Roomba when USER2 Away Partial Clean
        ##########################################################

- alias: Roomba - Run Upstairs Roomba when USER2 Away Partial Clean
  id: 'roomba_run_upstairs_roomba_when_USER2_away_partial_clean'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran
      state: 'off'
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.upstairs_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_USER2_office
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_guest_bedroom
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_upstairs_hallway
    - delay: '00:00:02'
    - action: python_script.upstairs_roomba

        ##########################################################
        ## Run Upstairs Roomba when Away
        ##########################################################

- alias: Roomba - Run Upstairs Roomba when Away
  id: 'roomba_run_upstairs_roomba_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran
      state: 'off'
    - condition: time
      after: '08:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.upstairs_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.upstairs_roomba

        ##########################################################
        ## Shut Off Roombas when Home
        ##########################################################

- alias: Roomba - Shut Off Roombas when Home
  id: 'roomba_shut_off_roombas_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 90

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'

  actions:
    - action: vacuum.return_to_base
      target:
        entity_id:
          - vacuum.main_floor_roomba
          - vacuum.upstairs_roomba
          - vacuum.basement_roomba

        ##########################################################
        ## Run Upstairs Roomba Mornings when Away
        ##########################################################

- alias: Roomba - Run Upstairs Roomba Mornings when Away
  id: 'roomba_run_upstairs_roomba_mornings_when_away'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran
      state: 'off'

    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.upstairs_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.upstairs_roomba

        ##########################################################
        ## Run Basement Roomba Weekdays
        ##########################################################

- alias: Roomba - Run Basement Roomba Weekdays
  id: 'roomba_run_basement_roomba_weekdays'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.basement_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - mon
        - wed
        - fri
    - condition: state
      entity_id: vacuum.basement_roomba
      state: 'docked'
    - condition: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.basement_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.washer
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.dryer
        state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.basement_roomba

        ##########################################################
        ## Run Basement Roomba Partial Clean
        ##########################################################

- alias: Roomba - Run Basement Roomba Partial Clean
  id: 'roomba_run_basement_roomba_partial_clean'

  triggers:
   - trigger: time
     at: '09:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.basement_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - tue
        - thu
    - condition: state
      entity_id: vacuum.basement_roomba
      state: 'docked'
    - condition: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.basement_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.washer
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.dryer
        state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_workbench
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_laundry_room
    - delay: '00:00:02'
    - action: python_script.basement_roomba

        ##########################################################
        ## Run Basement Roomba Partial Clean Weekend
        ##########################################################

- alias: Roomba - Run Basement Roomba Partial Clean Weekend
  id: 'roomba_run_basement_roomba_partial_clean_weekend'

  triggers:
   - trigger: time
     at: '14:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.basement_roomba_ran
      state: 'off'
    - condition: time
      weekday:
        - sat
        - sun
    - condition: state
      entity_id: vacuum.basement_roomba
      state: 'docked'
    - condition: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.basement_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.washer
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.dryer
        state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_workbench
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_laundry_room
    - delay: '00:00:02'
    - action: python_script.basement_roomba

        ##########################################################
        ## Run Basement Roomba when Away
        ##########################################################

- alias: Roomba - Run Basement Roomba when Away
  id: 'roomba_run_basement_roomba_when_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: time
      after: '08:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: vacuum.basement_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.basement_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_workbench
    - delay: '00:00:02'
    - action: python_script.basement_roomba

        ##########################################################
        ## Run Main Floor Roomba when USER2 Leaves
        ##########################################################

- alias: Roomba - Run Main Floor Roomba when USER2 Leaves
  id: 'roomba_run_main_floor_roomba_when_USER2_leaves'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.main_floor_roomba_ran
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: time
      after: '10:01:00'
      before: '18:00:00'
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.main_floor_roomba_battery
      above: 99
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: vacuum.start
      target:
        entity_id:
          - vacuum.main_floor_roomba

        ##########################################################
        ## Run Upstairs Roomba when USER2 Leaves
        ##########################################################

- alias: Roomba - Run Upstairs Roomba when USER2 Leaves
  id: 'roomba_run_upstairs_roomba_when_USER2_leaves'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: time
      after: '10:01:00'
      before: '18:00:00'
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
    - condition: numeric_state
      entity_id: sensor.upstairs_roomba_battery_level
      above: 99
    - condition: state
      entity_id: input_boolean.USER1_away
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_USER2_office
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_guest_bedroom
    - delay: '00:00:02'
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.roomba_clean_upstairs_hallway
    - delay: '00:00:02'
    - action: python_script.upstairs_roomba

        ##########################################################
        ## Turn Off Roombas when USER2 Home
        ##########################################################

- alias: Roomba - Turn Off Roomba when USER2 Home
  id: 'roomba_turn_off_roomba_when_USER2_home'

  triggers:
    - trigger: state
      entity_id: person.USER2
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 0
        seconds: 90

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER2_away
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'

  actions:
    - action: vacuum.return_to_base
      target:
        entity_id:
          - vacuum.main_floor_roomba
          - vacuum.upstairs_roomba

        ##########################################################
        ## Turn Off Roomba when Friends and Family Arrive
        ##########################################################

- alias: Roomba - Turn Off Roomba when Friends and Family Arrive
  id: 'roomba_turn_off_roomba_when_frinds_and_family_arrive'

  triggers:
    - trigger: state
      entity_id: input_boolean.guest_mode
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 90

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'

  actions:
    - action: vacuum.return_to_base
      target:
        entity_id:
          - vacuum.main_floor_roomba
          - vacuum.upstairs_roomba
          - vacuum.basement_roomba

#################################################################
## Whole House Lights
#################################################################

        ##########################################################
        ## Turn On lights for Main Floor Roomba Away
        ##########################################################

- alias: Roomba - Turn On lights for Main Floor Roomba Away
  id: 'roomba_turn_on_lights_for_main_floor_roomba_away'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
       brightness_pct: 100
       color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_ceiling
          - light.bedroom_closet_ceiling
      data:
       brightness_pct: 100
       color_temp: 370
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off lights when Main Floor Roomba finished Away
        ##########################################################

- alias: Roomba - Turn Off lights when Main Floor Roomba finished Away
  id: 'roomba_turn_off_lights_when_main_floor_roomba_finished_away'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'paused'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'stopped'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_ceiling
          - light.bedroom_closet_ceiling
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn On lights for Main Floor Roomba when Dark
        ##########################################################

- alias: Roomba - Turn On lights for Main Floor Roomba when Dark
  id: 'roomba_turn_on_lights_for_main_floor_roomba_when_dark'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: time
      after: '09:00:00'
      before: '14:00:00'
    - condition: numeric_state
      entity_id: sensor.living_room_light_level
      below: 15
    - condition: numeric_state
      entity_id: sensor.kitchen_light_level
      below: 25
    - condition: numeric_state
      entity_id: sensor.dining_room_light_level
      below: 10
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_table
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_lights
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light
      data:
       brightness_pct: 100
    - delay: '00:01:00'
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_closet_ceiling
      data:
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_ceiling
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off Lights Main Floor Roomba finished when Dark
        ##########################################################

- alias: Roomba - Turn Off Lights Main Floor Roomba finished when Dark
  id: 'roomba_turn_off_lights_when_main_floor_roomba_finished_when_dark'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'paused'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'stopped'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: person.USER2
        state: 'home'
    - condition: time
      after: '09:00:00'
      before: '15:00:00'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_closet_ceiling
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn On lights for Upstairs Roomba Away
        ##########################################################

- alias: Roomba - Turn On low lights for Upstairs Roomba Away
  id: 'roomba_turn_on_lights_for_upstairs_roomba_away'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_lights
          - light.USER2_office_lights
          - light.guest_bedroom_lights
          - light.stairs_light
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off lights when Upstairs Roomba finished Away
        ##########################################################

- alias: Roomba - Turn Off lights when Upstairs Roomba finished Away
  id: 'roomba_turn_off_lights_when_upstairs_roomba_finished_away'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'paused'
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'stopped'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights
          - light.USER2_office_lights
          - light.guest_bedroom_lights
          - light.stairs_light

        ##########################################################
        ## Turn On lights for Upstairs Roomba
        ##########################################################

- alias: Roomba - Turn On low lights for Upstairs Roomba
  id: 'roomba_turn_on_lights_for_upstairs_roomba'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_lights
          - light.USER2_office_lights
          - light.guest_bedroom_lights
          - light.stairs_light
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off lights when Upstairs Roomba Finished
        ##########################################################

- alias: Roomba - Turn Off lights when Upstairs Roomba Finished
  id: 'roomba_turn_off_lights_when_upstairs_roomba_finished'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'paused'
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'stopped'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1s_office_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER2s_office_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.stairs_motion
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights
          - light.USER2_office_lights
          - light.guest_bedroom_lights
          - light.stairs_light

        ##########################################################
        ## Turn On lights for Basement Roomba
        ##########################################################

- alias: Roomba - Turn On lights for Basement Roomba
  id: 'roomba_turn_on_lights_for_basement_roomba'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_utility_area_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_fitness_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_craft_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_laundry_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_workbench_lights
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lighting
      data:
       brightness_pct: 100

        ##########################################################
        ## Turn Off lights when Basement Roomba finished
        ##########################################################

- alias: Roomba - Turn Off lights when Basement Roomba finished
  id: 'roomba_turn_off_lights_when_basement_roomba_finished'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'paused'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: binary_sensor.basement_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.craft_room_motion
      state: 'off'
    - condition: state
      entity_id: binary_sensor.fitness_room_motion
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_utility_area_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_fitness_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_craft_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_laundry_room_lights
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_workbench_lights
      state: 'off'

  actions:
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lighting

#################################################################
## Individual Room Lights
#################################################################

        ##########################################################
        ## Toggle Lights with Room Clean
        ##########################################################

- alias: Roomba - Toggle Lights with Room Clean
  id: 'roomba_tooggle_lights_with_room_clean'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_living_room
        - input_boolean.roomba_clean_front_door
      to: 'on'
      id: input_boolean.roomba_clean_living_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_dining_room
        - input_boolean.roomba_clean_dining_room_table
      to: 'on'
      id: input_boolean.roomba_clean_dining_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_kitchen
        - input_boolean.roomba_clean_back_door
      to: 'on'
      id: input_boolean.roomba_clean_kitchen_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_hallway
      to: 'on'
      id: input_boolean.roomba_clean_hallway_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_bathroom
      to: 'on'
      id: input_boolean.roomba_clean_bathroom_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_bedroom
      to: 'on'
      id: input_boolean.roomba_clean_bedroom_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_bedroom_closet
      to: 'on'
      id: input_boolean.roomba_clean_bedroom_closet_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_front_door
      to: 'on'
      id: input_boolean.roomba_clean_living_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_USER1_office
      to: 'on'
      id: input_boolean.roomba_clean_USER1_office_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_USER2_office
      to: 'on'
      id: input_boolean.roomba_clean_USER2_office_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_guest_bedroom
      to: 'on'
      id: input_boolean.roomba_clean_guest_bedroom_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_upstairs_hallway
      to: 'on'
      id: input_boolean.roomba_clean_upstairs_hallway_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_utility_area
      to: 'on'
      id: input_boolean.roomba_clean_utility_area_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_fitness_room
      to: 'on'
      id: input_boolean.roomba_clean_fitness_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_craft_room
      to: 'on'
      id: input_boolean.roomba_clean_craft_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_laundry_room
      to: 'on'
      id: input_boolean.roomba_clean_laundry_room_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_workbench
      to: 'on'
      id: iinput_boolean.roomba_clean_workbench_lights
      for:
        hours: 0
        minutes: 0
        seconds: 1

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: '{{ trigger.id }}'

        ##########################################################
        ## Turn On Living Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Living Room Lights Room Clean
  id: 'roomba_turn_on_living_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.roomba_clean_living_room_lights
        state: 'on'
      - condition: state
        entity_id: input_boolean.roomba_clean_front_door
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_accent_lights

        ##########################################################
        ## Turn Off Living Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Living Room Lights Room Clean
  id: 'roomba_turn_off_living_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'on'
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.living_room_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_living_room_lights
          - input_boolean.roomba_clean_front_door
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lights

        ##########################################################
        ## Turn Off Living Room Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Living Room Lights Room Clean Boolean
  id: 'roomba_turn_off_living_room_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_living_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_living_room_lights

        ##########################################################
        ## Turn On Dining Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Dining Room Lights Room Clean
  id: 'roomba_turn_on_dining_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.roomba_clean_dining_room_lights
        state: 'on'
      - condition: state
        entity_id: input_boolean.roomba_clean_dining_room_table
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.dining_room_lights

        ##########################################################
        ## Turn Off Dining Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Dining Room Lights Room Clean
  id: 'roomba_turn_off_dining_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'on'
    - condition: state
      entity_id: light.dining_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.dining_room_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_dining_room_lights
          - input_boolean.roomba_clean_dining_room_table
    - action: light.turn_off
      target:
        entity_id:
          - light.dining_room_lights

        ##########################################################
        ## Turn Off Dining Room Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Dining Room Lights Room Clean Boolean
  id: 'roomba_turn_off_dining_room_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_dining_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_dining_room_lights
          - input_boolean.roomba_clean_dining_room_table

        ##########################################################
        ## Turn On Kitchen Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Kitchen Lights Room Clean
  id: 'roomba_turn_on_kitchen_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.roomba_clean_kitchen_lights
        state: 'on'
      - condition: state
        entity_id: input_boolean.roomba_clean_back_door
        state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Kitchen Lights Room Clean
  id: 'roomba_turn_off_kitchen_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'on'
    - condition: state
      entity_id: light.kitchen_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.kitchen_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_kitchen_lights
          - input_boolean.roomba_clean_back_door
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_lights

        ##########################################################
        ## Turn Off Kitchen Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Kitchen Lights Room Clean Boolean
  id: 'roomba_turn_off_kitchen_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_kitchen_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_kitchen_lights
          - input_boolean.roomba_clean_back_door

        ##########################################################
        ## Turn On Hallway Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Hallway Lights Room Clean
  id: 'roomba_turn_on_hallway_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Hallway Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Hallway Lights Room Clean
  id: 'roomba_turn_off_hallway_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'on'
    - condition: state
      entity_id: light.hallway_light
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.dining_room_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_hallway_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.hallway_light

        ##########################################################
        ## Turn Off Hallway Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Hallway Lights Room Clean Boolean
  id: 'roomba_turn_off_hallway_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_hallway_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_hallway_lights

        ##########################################################
        ## Turn On Bathroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Bathroom Lights Room Clean
  id: 'roomba_turn_on_bathroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bathroom_lights

        ##########################################################
        ## Turn Off Bathroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Bathroom Lights Room Clean
  id: 'roomba_turn_off_bathroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'on'
    - condition: state
      entity_id: light.bathroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.bathroom_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bathroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bathroom_lights

        ##########################################################
        ## Turn Off Bathroom Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Bathroom Lights Room Clean Boolean
  id: 'roomba_turn_off_bathroom_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bathroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bathroom_lights

        ##########################################################
        ## Turn On Bedroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Bedroom Lights Room Clean
  id: 'roomba_turn_on_bedroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_ceiling

        ##########################################################
        ## Turn Off Bedroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Bedroom Lights Room Clean
  id: 'roomba_turn_off_bedroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'on'
    - condition: state
      entity_id: light.bedroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bedroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_lamps
          - light.bedroom_ceiling

        ##########################################################
        ## Turn Off Bedroom Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Bedroom Lights Room Clean Boolean
  id: 'roomba_turn_off_bedroom_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bedroom_lights

        ##########################################################
        ## Turn On Bedroom Closet Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Bedroom Closet Lights Room Clean
  id: 'roomba_turn_on_bedroom_closet_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_closet_ceiling

        ##########################################################
        ## Turn Off Bedroom Closet Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Bedroom Closet Lights Room Clean
  id: 'roomba_turn_off_bedroom_closet_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'on'
    - condition: state
      entity_id: light.bedroom_closet_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.bedroom_closet_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bedroom_closet_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_closet_ceiling

        ##########################################################
        ## Turn Off Bedroom Closet Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Bedroom Closet Lights Room Clean Boolean
  id: 'roomba_turn_off_bedroom_closet_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_bedroom_closet_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.main_floor_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_bedroom_closet_lights

        ##########################################################
        ## Turn On USER1's Office Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On USER1's Office Lights Room Clean
  id: 'roomba_turn_on_USER1_office_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_lights

        ##########################################################
        ## Turn Off USER1's Office Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off USER1's Office Lights Room Clean
  id: 'roomba_turn_off_USER1_office_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'on'
    - condition: state
      entity_id: light.USER1_office_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.USER1s_office_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_USER1_office_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_lights

        ##########################################################
        ## Turn Off USER1's Office Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off USER1's Office Lights Room Clean Boolean
  id: 'roomba_turn_off_USER1_office_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_USER1_office_lights

        ##########################################################
        ## Turn On USER2's Office Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On USER2's Office Lights Room Clean
  id: 'roomba_turn_on_USER2_office_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER2_office_lights

        ##########################################################
        ## Turn Off USER2's Office Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off USER2's Office Lights Room Clean
  id: 'roomba_turn_off_USER2_office_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'on'
    - condition: state
      entity_id: light.USER2_office_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.USER2s_office_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_USER2_office_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.USER2_office_lights

        ##########################################################
        ## Turn Off USER2's Office Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off USER2's Office Lights Room Clean Boolean
  id: 'roomba_turn_off_USER2_office_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_USER2_office_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_USER2_office_lights

        ##########################################################
        ## Turn On Guest Bedroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Guest Bedroom Lights Room Clean
  id: 'roomba_turn_on_guest_bedroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.guest_bedroom_lights

        ##########################################################
        ## Turn Off Guest Bedroom Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Guest Bedroom Lights Room Clean
  id: 'roomba_turn_off_guest_bedroom_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_guest_bedroom_lights
      state: 'on'
    - condition: state
      entity_id: light.guest_bedroom_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_guest_bedroom_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.guest_bedroom_lights

        ##########################################################
        ## Turn On Upstairs Hallway Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Upstairs Hallway Lights Room Clean
  id: 'roomba_turn_on_upstairs_hallway_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.stairs_light

        ##########################################################
        ## Turn Off Upstairs Hallway Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Upstairs Hallway Lights Room Clean
  id: 'roomba_turn_off_upstairs_hallway_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'on'
    - condition: state
      entity_id: light.stairs_light
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.stairs_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_upstairs_hallway_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.stairs_light

        ##########################################################
        ## Turn Off Upstairs Hallway Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Upstairs Hallway Lights Room Clean Boolean
  id: 'roomba_turn_off_upstairs_hallway_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_upstairs_hallway_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.upstairs_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_upstairs_hallway_lights

        ##########################################################
        ## Turn On Utility Area Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Utility Area Lights Room Clean
  id: 'roomba_turn_on_utility_area_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_utility_area_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Utility Area Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Utility Area Lights Room Clean
  id: 'roomba_turn_off_utility_area_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_utility_area_lights
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_lights
        state: 'on'
      - condition: state
        entity_id: light.basement_lamp
        state: 'on'
      - condition: state
        entity_id: light.work_bench_light
        state: 'on'
      - condition: state
        entity_id: light.laundry_room_light
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.basement_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_utility_area_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Utility Area Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Utility Area Lights Room Clean Boolean
  id: 'roomba_turn_off_utility_area_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_utility_area_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
         - input_boolean.roomba_clean_utility_area_lights

        ##########################################################
        ## Turn On Laundry Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Laundry Room Lights Room Clean
  id: 'roomba_turn_on_laundry_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_laundry_room_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Laundry Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Laundry Room Lights Room Clean
  id: 'roomba_turn_off_laundry_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_laundry_room_lights
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_lights
        state: 'on'
      - condition: state
        entity_id: light.basement_lamp
        state: 'on'
      - condition: state
        entity_id: light.work_bench_light
        state: 'on'
      - condition: state
        entity_id: light.laundry_room_light
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.basement_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_laundry_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Laundry Room Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Laundry Room Lights Room Clean Boolean
  id: 'roomba_turn_off_laundry_room_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_laundry_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_laundry_room_lights

        ##########################################################
        ## Turn On Workbench Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Workbench Lights Room Clean
  id: 'roomba_turn_on_workbench_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_workbench_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Workbench Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Workbench Lights Room Clean
  id: 'roomba_turn_off_workbench_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_workbench_lights
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.basement_lights
        state: 'on'
      - condition: state
        entity_id: light.basement_lamp
        state: 'on'
      - condition: state
        entity_id: light.work_bench_light
        state: 'on'
      - condition: state
        entity_id: light.laundry_room_light
        state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.basement_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_workbench_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.basement_lights
          - light.basement_lamp
          - light.work_bench_light
          - light.laundry_room_light

        ##########################################################
        ## Turn Off Workbench Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Workbench Lights Room Clean Boolean
  id: 'roomba_turn_off_workbench_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_workbench_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_workbench_lights

        ##########################################################
        ## Turn On Fitness Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Fitness Room Lights Room Clean
  id: 'roomba_turn_on_fitness_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_fitness_room_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.fitness_room_ceiling

        ##########################################################
        ## Turn Off Fitness Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Fitness Room Lights Room Clean
  id: 'roomba_turn_off_fitness_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_fitness_room_lights
      state: 'on'
    - condition: state
      entity_id: light.fitness_room_ceiling
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.fitness_room_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_fitness_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.fitness_room_ceiling

        ##########################################################
        ## Turn Off Fitness Room Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Fitness Room Lights Room Clean Boolean
  id: 'roomba_turn_off_fitness_room_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_fitness_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_fitness_room_lights

        ##########################################################
        ## Turn On Craft Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn On Craft Room Lights Room Clean
  id: 'roomba_turn_on_craft_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_craft_room_lights
      state: 'on'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.craft_room_ceiling

        ##########################################################
        ## Turn Off Craft Room Lights Room Clean
        ##########################################################

- alias: Roomba - Turn Off Craft Room Lights Room Clean
  id: 'roomba_turn_off_craft_room_lights_room_clean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_craft_room_lights
      state: 'on'
    - condition: state
      entity_id: light.craft_room_ceiling
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: state
      entity_id: binary_sensor.craft_room_motion
      state: 'off'
      for:
        minutes: 6
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_craft_room_lights
    - action: light.turn_off
      target:
        entity_id:
          - light.craft_room_ceiling

        ##########################################################
        ## Turn Off Craft Room Lights Room Clean Boolean
        ##########################################################

- alias: Roomba - Turn Off Craft Room Lights Room Clean Boolean
  id: 'roomba_turn_off_craft_room_lights_room_clean_boolean'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'docked'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.roomba_clean_craft_room_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'cleaning'
      - condition: state
        entity_id: vacuum.basement_roomba
        state: 'returning'
    - condition: time
      after: '08:30:00'
      before: '23:00:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.roomba_clean_craft_room_lights

#################################################################
## Helper Automations
#################################################################

        ##########################################################
        ## Disable Room Clean Boolean if Roomba Didn't Run Main Floor
        ##########################################################

- alias: Roomba - Disable Room Clean Boolean if Roomba Didn't Run Main Floor
  id: 'roomba_disable_room_clean_boolean_if_roomba_didnt_run_main_floor'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_living_room
        - input_boolean.roomba_clean_dining_room
        - input_boolean.roomba_clean_kitchen
        - input_boolean.roomba_clean_hallway
        - input_boolean.roomba_clean_bathroom
        - input_boolean.roomba_clean_bedroom
        - input_boolean.roomba_clean_bedroom_closet
        - input_boolean.roomba_clean_front_door
        - input_boolean.roomba_clean_back_door
        - input_boolean.roomba_clean_dining_room_table
        - input_boolean.roomba_clean_living_room_lights
        - input_boolean.roomba_clean_living_room_lights
        - input_boolean.roomba_clean_dining_room_lights
        - input_boolean.roomba_clean_kitchen_lights
        - input_boolean.roomba_clean_hallway_lights
        - input_boolean.roomba_clean_bathroom_lights
        - input_boolean.roomba_clean_bedroom_lights
        - input_boolean.roomba_clean_bedroom_closet_lights
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: vacuum.main_floor_roomba
      state: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id: '{{ trigger.entity_id }}'

        ##########################################################
        ## Disable Room Clean Boolean if Roomba Didn't Run Upstairs
        ##########################################################

- alias: Roomba - Disable Room Clean Boolean if Roomba Didn't Run Upstairs
  id: 'roomba_disable_room_clean_boolean_if_roomba_didnt_run_upstairs'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: 
        - input_boolean.roomba_clean_USER1_office
        - input_boolean.roomba_clean_USER2_office
        - input_boolean.roomba_clean_guest_bedroom
        - input_boolean.roomba_clean_upstairs_hallway
        - input_boolean.roomba_clean_USER1_office_lights
        - input_boolean.roomba_clean_USER2_office_lights
        - input_boolean.roomba_clean_guest_bedroom_lights
        - input_boolean.roomba_clean_upstairs_hallway_lights
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id: '{{ trigger.entity_id }}'

        ##########################################################
        ## Disable Room Clean Boolean if Roomba Didn't Run Basement
        ##########################################################

- alias: Roomba - Disable Room Clean Boolean if Roomba Didn't Run Basement
  id: 'roomba_disable_room_clean_boolean_if_roomba_didnt_run_basement'

  mode: parallel
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.roomba_clean_utility_area
        - input_boolean.roomba_clean_fitness_room
        - input_boolean.roomba_clean_craft_room
        - input_boolean.roomba_clean_laundry_room
        - input_boolean.roomba_clean_workbench
        - input_boolean.roomba_clean_utility_area_lights
        - input_boolean.roomba_clean_fitness_room_lights
        - input_boolean.roomba_clean_craft_room_lights
        - input_boolean.roomba_clean_laundry_room_lights
        - input_boolean.roomba_clean_workbench_lights
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: vacuum.upstairs_roomba
      state: 'docked'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id: '{{ trigger.entity_id }}'

        ##########################################################
        ## Set Upstairs Roomba has Ran for the Day
        ##########################################################

- alias: Roomba - Set Upstairs Roomba has Ran for the Day
  id: 'roomba_set_upstairs_roomba_has_ran_for_the_day'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 39
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.upstairs_roomba_ran

        ##########################################################
        ## Set Main Floor Roomba has Ran for the Day
        ##########################################################

- alias: Roomba - Set Main Floor Roomba has Ran for the Day
  id: 'roomba_set_main_floor_roomba_has_ran_for_the_day'

  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'cleaning'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.main_floor_roomba_ran

        ##########################################################
        ## Set Basement Roomba has Ran for the Day
        ##########################################################

- alias: Roomba - Set Basement Roomba has Ran for the Day
  id: 'roomba_set_basement_roomba_has_ran_for_the_day'

  triggers:
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 45
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.basement_roomba_ran

        ##########################################################
        ## Set Upstairs Roomba has Ran USER1's Office
        ##########################################################

- alias: Roomba - Set Upstairs Roomba has Ran USER1's Office
  id: 'roomba_set_upstairs_roomba_has_ran_for_the_day_USER1_office'

  triggers:
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'cleaning'
      for:
        hours: 0
        minutes: 5
        seconds: 0
  
  conditions:
    - condition: state
      entity_id: input_boolean.upstairs_roomba_ran_USER1_office
      state: 'off'
    - condition: state
      entity_id: input_boolean.roomba_clean_USER1_office
      state: 'on'


  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.upstairs_roomba_ran_USER1_office

        ##########################################################
        ## Reset Roomba Helpers
        ##########################################################

- alias: Roomba - Reset Helpers
  id: 'roomba_reset_helpers'

  triggers:
   - trigger: time
     at: '00:01:00'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.main_floor_roomba_ran
          - input_boolean.upstairs_roomba_ran
          - input_boolean.basement_roomba_ran
          - input_boolean.upstairs_roomba_ran_USER1_office
          - input_boolean.roomba_clean_living_room_lights
          - input_boolean.roomba_clean_dining_room_lights
          - input_boolean.roomba_clean_kitchen_lights
          - input_boolean.roomba_clean_hallway_lights
          - input_boolean.roomba_clean_bathroom_lights
          - input_boolean.roomba_clean_bedroom_lights
          - input_boolean.roomba_clean_bedroom_closet_lights
          - input_boolean.roomba_clean_utility_area_lights
          - input_boolean.roomba_clean_fitness_room_lights
          - input_boolean.roomba_clean_craft_room_lights
          - input_boolean.roomba_clean_laundry_room_lights
          - input_boolean.roomba_clean_workbench_lights
          - input_boolean.roomba_clean_USER1_office_lights
          - input_boolean.roomba_clean_USER2_office_lights
          - input_boolean.roomba_clean_guest_bedroom_lights
          - input_boolean.roomba_clean_upstairs_hallway_lights

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Roomba is Stuck iOS Notification
        ##########################################################

- alias: Roomba - Stuck iOS Notification
  id: 'roomba_stuck_ios_notification'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: vacuum.main_floor_roomba
      to: 'error'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: vacuum.upstairs_roomba
      to: 'error'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: vacuum.basement_roomba
      to: 'error'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_roomba
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} is Stuck, Please Help"#################################################################
## System
#################################################################

        ##########################################################
        ## Home Showing Mode On
        ##########################################################

- alias: System - Home Showing Mode On
  id: 'system_home_showing_mode_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.home_showing_mode
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  actions:
    - action: script.home_showing_mode_on
      data: {}

        ##########################################################
        ## Home Showing Mode Off
        ##########################################################

- alias: System - Home Showing Mode Off
  id: 'system_home_showing_mode_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.home_showing_mode
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  actions:
    - action: script.home_showing_mode_off
      data: {}

        ##########################################################
        ## Backup Home Assistant Nightly
        ##########################################################

- alias: System - Backup Home Assistant Nightly
  id: 'system_backup_home_assistant_nightly'

  triggers:
   - trigger: time
     at: '04:00:00'

  actions:
    - action: backup.create

        ##########################################################
        ## Reset Overrides at 7a
        ##########################################################

- alias: System - Reset Overrides at 7a
  id: 'system_reset_overrides_at_7a'

  triggers:
   - trigger: time
     at: '07:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.disable_climate
          - input_boolean.disable_notifications
          - input_boolean.disable_doorbell
          - input_boolean.disable_door_open_lights_on
          - input_boolean.disable_exterior_on_sunset
          - input_boolean.disable_exterior_off_night
          - input_boolean.disable_auto_garage
          - input_boolean.disable_home_away
          - input_boolean.disable_interior_lights_sunset
          - input_boolean.disable_lock_unlock_doors
          - input_boolean.disable_media_lights
          - input_boolean.disable_motion
          - input_boolean.disable_occupancy
          - input_boolean.disable_rainy_day
          - input_boolean.disable_water_automations
          - input_boolean.downstairs_roomba_pause
          - input_boolean.disable_startup_notifications
          - input_boolean.disable_blinds
          - input_boolean.disable_roomba
          - input_boolean.disable_light_dimmer
          - input_boolean.disable_echo
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.pihole

        ##########################################################
        ## Reset Overrides at 12p
        ##########################################################

- alias: System - Reset Overrides at 12p
  id: 'system_reset_overrides_at_12p'

  triggers:
   - trigger: time
     at: '12:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.living_room_guest
          - input_boolean.USER1_office_guest

        ##########################################################
        ## Disable Erroneous Startup Notifications
        ##########################################################

- alias: System - Disable Erroneous Startup Notifications
  id: 'system_disable_erroneous_startup_notifications'

  triggers:
    - trigger: homeassistant
      event: start

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.disable_startup_notifications
    - delay: 00:02:00
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.disable_startup_notifications

        ##########################################################
        ## Reload Echo Integration on Startup
        ##########################################################

- alias: System - Reload Echo Integration on Startup
  id: 'system_reload_echo_integration_on_startup'

  triggers:
    - trigger: homeassistant
      event: start

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.disable_echo
    - delay: 00:00:30
    - action: homeassistant.reload_config_entry
      target: {}
      data:
        entry_id: 2c39bd41b37b18b2c96b03d10fb00866
    - delay: 00:00:30
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.disable_echo

        #################################################################
        ## Clear Erroneous Failed Login Notifications
        #################################################################

- alias: System - Clear Erroneous Failed Login Notifications
  id: 'system_clear_erroneous_failed_login_notifications'

  triggers:
    - trigger: state
      entity_id: persistent_notification.http_login
      to: 'notifying'

  actions:
    - delay: "00:00:01"
    - action: persistent_notification.dismiss
      data:
        notification_id: http-login

        #################################################################
        ## Reconnect USER2's Nightstand if Offline
        #################################################################

- alias: System - Reconnect USER2's Nightstand if Offline
  id: 'system_reconnect_USER2_nightstand_if_offline'

  triggers:
    - trigger: state
      entity_id: light.USER2s_nightstand
      to: 'unavailable'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: light.USER2s_nightstand
      to: 'unknown'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: unifi.reconnect_client
      data:
        device_id: a493838be740ec667e8fc26fc3e57ee9

        #################################################################
        ## Reconnect USER1's Nightstand if Offline
        #################################################################

- alias: System - Reconnect USER1's Nightstand if Offline
  id: 'system_reconnect_USER1_nightstand_if_offline'

  triggers:
    - trigger: state
      entity_id: light.USER1s_nightstand
      to: 'unavailable'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: light.USER1s_nightstand
      to: 'unknown'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  actions:
    - action: unifi.reconnect_client
      data:
        device_id: 054511dc5c2c02b186621a55149cb370

        #################################################################
        ## Ping Locks if they become Unavailable
        #################################################################

- alias: System - Ping Locks if they become Unavailable
  id: 'system_ping_locks_if_they_become_unavailable'

  triggers:
    - trigger: state
      entity_id: lock.front_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.back_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.basement_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.front_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: lock.back_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: lock.basement_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: lock.front_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.back_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.basement_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: lock.front_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: lock.back_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: lock.basement_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  actions:
    - action: zwave_js.ping
      target:
        entity_id: 
          - lock.front_door
          - lock.back_door
          - lock.basement_door

        #################################################################
        ## Power Cycle Garage Door Relay if Offline
        #################################################################

- alias: System - Power Cycle Garage Door Relay if Offline
  id: 'system_power_cycle_garage_door_realy_if_offline'

  triggers:
    - trigger: state
      entity_id: cover.garage_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: cover.garage_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 10
        seconds: 0
    - trigger: state
      entity_id: cover.garage_door
      to: 'unavailable'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - trigger: state
      entity_id: cover.garage_door
      to: 'unknown'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  actions:
    - action: notify.USER1_devices
      data:
        message: "Power Cycling Garage Door Relay"
        data:
          tag: garage
    - action: switch.turn_off
      target:
        entity_id: 
          - switch.garage_door_relay
    - delay: '00:00:30'
    - action: switch.turn_on
      target:
        entity_id: 
          - switch.garage_door_relay

        #################################################################
        ## Turn On Guest Mode if Overnight Guest Mode Turned On
        #################################################################

- alias: System - Turn On Guest Mode if Overnight Guest Mode Turned On
  id: 'system_turn_on_guest_mode_if_overnight_guest_mode_turned_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.overnight_guest_mode
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id: 
          - input_boolean.guest_mode

        #################################################################
        ## Turn Off Guest Mode if Overnight Guest Mode Turned Off
        #################################################################

- alias: System - Turn Off Guest Mode if Overnight Guest Mode Turned Off
  id: 'system_turn_off_guest_mode_if_overnight_guest_mode_turned_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.overnight_guest_mode
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'on'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id: 
          - input_boolean.guest_mode

        ##########################################################
        ## Reset Guest Mode at 7a
        ##########################################################

- alias: System - Reset Guest Mode at 7a
  id: 'system_reset_guest_mode_at_7a'

  triggers:
   - trigger: time
     at: '07:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.overnight_guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.guest_mode

        #################################################################
        ## Turn On USER1 Office Do not Disturb when MacBook AV Input On
        #################################################################

- alias: System - Turn On USER1 Office Do not Disturb when MacBook AV Input On
  id: 'system_turn_on_USER1_office_do_not_disturb_when_macbook_av_input_on'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_macbook_pro_camera_in_use
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.USER1_s_macbook_pro_audio_input_in_use
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0
#    - trigger: state
#      entity_id: binary_sensor.USER1_s_macbook_pro_focus
#      to: 'on'
#      for:
#        hours: 0
#        minutes: 1
#        seconds: 0
    - trigger: state
      entity_id: sensor.USER1_s_macbook_pro_active_audio_input
      from: 'Inactive'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: binary_sensor.USER1_s_macbook_pro_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.USER1_s_office_do_not_disturb

        #################################################################
        ## Turn Off USER1 Office Do not Disturb when MacBook AV Input Off
        #################################################################

- alias: System - Turn Off USER1 Office Do not Disturb when MacBook AV Input Off
  id: 'system_turn_off_USER1_office_do_not_disturb_when_macbook_av_input_off'

  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_macbook_pro_camera_in_use
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.USER1_s_macbook_pro_audio_input_in_use
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: binary_sensor.USER1_s_macbook_pro_focus
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0
    - trigger: state
      entity_id: sensor.USER1_s_macbook_pro_active_audio_input
      to: 'Inactive'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'on'
    - condition: state
      entity_id: binary_sensor.USER1_s_macbook_pro_camera_in_use
      state: 'off'
    - condition: state
      entity_id: binary_sensor.USER1_s_macbook_pro_audio_input_in_use
      state: 'off'
#    - condition: state
#      entity_id: binary_sensor.USER1_s_macbook_pro_focus
#      state: 'off'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.USER1_s_office_do_not_disturb

        ##########################################################
        ## Echo Timer Flash Living Room Lights On
        ##########################################################

- alias: System - Echo Timer Flash Living Room Lights On
  id: 'system_echo_timer_flash_living_room_lights_on'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.globe
        state: 'on'
      - condition: state
        entity_id: light.media_center_lighting
        state: 'on'
    - condition: state
      entity_id: input_boolean.disable_echo
      state: 'off'

  actions:
    - action: light.turn_on
      data:
        flash: long
        color_name: green
        brightness_pct: 100
      target:
        entity_id: 
          - light.globe
    - action: light.turn_on
      data:
        flash: long
        color_name: green
        brightness_pct: 100
      target:
        entity_id: 
          - light.media_center_lighting
    - delay: '00:03:00'
    - action: light.turn_on
      target:
        entity_id: 
          - light.media_center_lighting
      data:
       transition: 5
       brightness_pct: 100
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
       transition: 5
       brightness_pct: 65
       color_temp: 366

        ##########################################################
        ## Echo Timer Flash Living Room Lights Off
        ##########################################################

- alias: System - Echo Timer Flash Living Room Lights Off
  id: 'system_echo_timer_flash_living_room_lights_off'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: or
      conditions:
      - condition: state
        entity_id: light.globe
        state: 'off'
      - condition: state
        entity_id: light.media_center_lighting
        state: 'off'

  actions:
    - action: light.turn_on
      data:
        flash: long
        color_name: green
        brightness_pct: 100
      target:
        entity_id: 
          - light.globe
    - action: light.turn_on
      data:
        flash: long
        color_name: green
        brightness_pct: 100
      target:
        entity_id: 
          - light.media_center_lighting
    - delay: '00:03:00'
    - action: light.turn_off
      target:
        entity_id:
          - light.globe 
    - action: light.turn_off
      target:
        entity_id:
          - light.media_center_lighting

#################################################################
## Servers
#################################################################

        ##########################################################
        ## Shutdown Windows VM at Bedtime
        ##########################################################

- alias: System Shutdown Windows VM at Bedtime
  id: 'system_shutdown_windows_vm_at_bedtime'

  triggers:
    - trigger: state
      entity_id: input_boolean.bedtime
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: binary_sensor.qemu_windows_100_status
      state: 'on'

  actions:
    - action: button.press
      target:
        entity_id: button.qemu_windows_100_shutdown

        ##########################################################
        ## Shutdown Windows VM when Household Away
        ##########################################################

- alias: System - Shutdown Windows VM when Household Away
  id: 'system_shutdown_windows_vm_when_household_away'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: binary_sensor.qemu_windows_100_status
      state: 'on'

  actions:
    - action: button.press
      target:
        entity_id: button.qemu_windows_100_shutdown

#################################################################
## Notifications
#################################################################

        #################################################################
        ## NAS-02 Warning iOS Notification
        #################################################################

- alias: System - NAS-02 Warning iOS Notification
  id: 'system_nas_02_warning_ios_notification'

  triggers:
    - trigger: state
      entity_id: sensor.nas_02_status
      to: 'warning'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: NAS-02 RAID Failing
        data:
          tag: nas-02

        ##########################################################
        ## NVR
        ##########################################################

- alias: System - NVR Drive Failure
  id: 'system_nvr_drive_failure'

  triggers:
    - trigger: state
      entity_id: 
        - binary_sensor.zephyr_place_REDACTED_hdd_1
        - binary_sensor.zephyr_place_REDACTED_hdd_2
        - binary_sensor.zephyr_place_REDACTED_hdd_3
        - binary_sensor.zephyr_place_REDACTED_hdd_4
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Failing"

        ##########################################################
        ## UPS Power Loss Alert iOS Notification
        ##########################################################

- alias: System - UPS Power Loss Alert iOS Notification
  id: 'system_ups_power_loss_alert_ios_notification'

  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.ups_a_input_voltage
          - sensor.ups_b_input_voltage
          - sensor.ups_c_input_voltage
      below: 80

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Power Outage Detected
        data:
          tag: ups

        ##########################################################
        ## UPS Power Restored Alert iOS Notification
        ##########################################################

- alias: System - UPS Power Restored Alert iOS Notification
  id: 'system_ups_power_restored_alert_ios_notification'

  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.ups_a_input_voltage
          - sensor.ups_b_input_voltage
          - sensor.ups_c_input_voltage
      above: 110

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_startup_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Power Restored
        data:
          tag: ups

        ##########################################################
        ## UPS Low Battery Alert iOS Notification
        ##########################################################

- alias: System - UPS Low Battery Alert iOS Notification
  id: 'system_ups_low_battery_alert_ios_notification'

  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.ups_a_battery
          - sensor.ups_b_battery
          - sensor.ups_c_input_voltage
      below: 15

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low"
        data:
          tag: ups

        ##########################################################
        ## UPS Disconnected iOS Notification
        ##########################################################

- alias: System - UPS Disconnected iOS Notification
  id: 'system_ups_disconnected_ios_notification'

  triggers:
    - trigger: state
      entity_id: 
        - sensor.ups_a_status
        - sensor.ups_b_status
        - sensor.ups_c_status
      to: 'unavailable'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} has Disconnected"
        data:
          tag: ups

        #################################################################
        ## Home Assistant Started iOS Notification
        #################################################################

- alias: System - Home Assistant Start iOS Notification
  id: 'system_home_assistant_start_ios_notification'

  triggers:
    - trigger: homeassistant
      event: start

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Home Assistant Started
        data:
          tag: homeassistant

        #################################################################
        ## Home Assistant Update iOS Notification
        #################################################################

- alias: System - Home Assistant Update iOS Notification
  id: 'system_home_assistant_update_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.docker_hub_update_available
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Update Available for Home Assistant
        data:
          tag: homeassistant

        ##########################################################
        ## Guest Mode is Still On
        ##########################################################

- alias: System - Guest Mode is Still On
  id: 'system_guest_mode_is_still_on'

  triggers:
   - trigger: time
     at: '09:00:00'

  conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.overnight_guest_mode
        state: 'on'
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'on'

  actions:
    - action: notify.USER1_devices
      data:
        message: 'Guest Mode is Still On'

        ##########################################################
        ## Echo Timer Notification USER1
        ##########################################################

- alias: System - Echo Timer Notification USER1
  id: 'system_echo_timer_notification_USER1'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_echo
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Finished"
        data:
          tag: echo

        ##########################################################
        ## Echo Timer Notification USER2
        ##########################################################

- alias: System - Echo Timer Notification USER2
  id: 'system_echo_timer_notification_USER2'

  mode: parallel
  triggers:
    - trigger: state
      entity_id: binary_sensor.USER1_s_office_echo_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.basement_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bathroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.craft_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.dining_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.fitness_room_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.guest_bedroom_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.kitchen_timer
      from: 'on'
      to: 'off'
    - trigger: state
      entity_id: binary_sensor.USER2_s_office_timer
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: person.USER2
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_echo
      state: 'off'

  actions:
    - action: notify.USER2_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Finished"
        data:
          tag: echo#################################################################
## Vacation Mode Automations
#################################################################

        ##########################################################
        ## Vacation Mode On
        ##########################################################

- alias: Vacation - Mode On
  id: 'vacation_mode_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.vacation_mode
      to: 'on'

  conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      target:
        entity_id:
          - input_boolean.disable_rainy_day
          - input_boolean.disable_interior_lights_sunset
          - input_boolean.disable_media_lights
          - input_boolean.disable_occupancy
          - input_boolean.disable_motion
          - input_boolean.disable_fountain

        ##########################################################
        ## Vacation Mode Off
        ##########################################################

- alias: Vacation - Mode Off
  id: 'vacation_mode_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.vacation_mode
      to: 'off'

  actions:
    - action: homeassistant.turn_off
      target:
        entity_id:
          - input_boolean.disable_rainy_day
          - input_boolean.disable_interior_lights_sunset
          - input_boolean.disable_media_lights
          - input_boolean.disable_occupancy
          - input_boolean.thermostat_away
          - input_boolean.disable_motion

        ##########################################################
        ## Turn On Vacation Mode when Gone 24 Hours
        ##########################################################

- alias: Vacation - Turn On when Gone 24 Hours
  id: 'vacation_turn_on_when_gone_24_hours'

  triggers:
    - trigger: state
      entity_id: group.household
      to: 'not_home'
      for:
        hours: 24
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn off Vacation Mode when Home
        ##########################################################

- alias: Vacation - Turn off when Home
  id: 'vacation_turn_off_when_home'

  triggers:
    - trigger: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'

  actions:
    - action: homeassistant.turn_off
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn On Vacation Mode when Thermostat set to Vacation
        ##########################################################

- alias: Vacation - Turn On when Thermostat set to Vacation
  id: 'vacation_turn_on_when_thermostat_set_to_vacation'

  triggers:
    - trigger: state
      entity_id: sensor.thermostat_climate_mode
      to: 'vacation'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: group.household
        state: 'home'

  actions:
    - action: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Vacation Lights On at Night
        ##########################################################

- alias: Vacation - Lights On at Night
  id: 'vacation_lights_on_at_night'

  triggers:
    - trigger: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  actions:
    - delay:
        minutes: '{{ range(2, 20) | random }}'
    - action: light.turn_on
      target:
        entity_id:
          - light.kitchen_sink
      data:
        brightness_pct: 50
    - delay:
        minutes: '{{ range(2, 28) | random }}'
    - action: light.turn_on
      target:
        entity_id:
          - light.living_room_lamps
      data:
        brightness_pct: 75
        transition: 120
    - delay:
        minutes: '{{ range(2, 59) | random }}'
    - action: light.turn_on
      target:
        entity_id:
          - light.bedroom_ceiling
      data:
        brightness_pct: 25
        transition: 60
    - delay:
        minutes: '{{ range(2, 45) | random }}'
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 80

        ##########################################################
        ## Vacation Mode Lights off at Night
        ##########################################################

- alias: Vacation - Lights Off at Night
  id: 'vacation_lights_off_at_night'

  triggers:
    - trigger: time
      at: '21:30:00'

  conditions:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  actions:
    - delay:
        minutes: '{{ range(2, 32) | random }}'
    - action: light.turn_off
      target:
        entity_id:
          - light.kitchen_sink
    - delay:
        minutes: '{{ range(2, 59) | random }}'
    - action: light.turn_off
      target:
        entity_id:
          - light.living_room_lamps
    - delay:
        minutes: '{{ range(2, 30) | random }}'
    - action: light.turn_off
      target:
        entity_id:
          - light.bedroom_ceiling
    - delay:
        minutes: '{{ range(2, 45) | random }}'
    - action: light.turn_off
      target:
        entity_id:
          - light.USER1_office_desk_lamp
          - light.USER1_office_desk_accent#################################################################
## Water Sensor Automations
#################################################################

        ##########################################################
        ## Flash Lights when Water Detected
        ##########################################################

- alias: Water Works - Sound Alarm When Water Detected Lights
  id: 'water_works_sound_alarm_when_water_detected_lights'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.kitchen_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.bathroom_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.upstairs_bathrooom_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.utility_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.washing_machine_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       brightness_pct: 100
       color_name: "blue"
    - action: light.turn_on
      target:
        entity_id:
          - light.smart_bulbs
      data:
       flash: long

        ##########################################################
        ## Shut Off Water Main When Water Detected
        ##########################################################

- alias: Water Works - Shut Off Water Main When Water Detected
  id: 'water_works_shut_off_water_main_when_water_detected'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.kitchen_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.bathroom_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.upstairs_bathrooom_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.utility_sink_water_sensor
      from: 'off'
      to: 'on'
    - trigger: state
      entity_id: binary_sensor.washing_machine_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: valve.water_main
      state: 'open'

  actions:
    - action: valve.close_valve
      entity_id:
        - valve.water_main

        ##########################################################
        ## Shut Off Water Main When Vacation Mode On
        ##########################################################

- alias: Water Works - Shut Off Water Main When Vacation Mode On
  id: 'water_works_shut_off_water_main_when_vacation_mode_on'

  triggers:
    - trigger: state
      entity_id: input_boolean.vacation_mode
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: valve.water_main
      state: 'open'

  actions:
    - action: valve.close_valve
      target:
        entity_id:
          - valve.water_main

        ##########################################################
        ## Turn On Water Main When Vacation Mode Off
        ##########################################################

- alias: Water Works - Turn On Water Main When Vacation Mode Off
  id: 'water_works_turn_on_water_main_when_vacation_mode_off'

  triggers:
    - trigger: state
      entity_id: input_boolean.vacation_mode
      from: 'on'
      to: 'off'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_home_away
      state: 'off'
    - condition: state
      entity_id: valve.water_main
      state: 'closed'

  actions:
    - action: valve.open_valve
      target:
        entity_id:
          - valve.water_main

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Water Main Turned Off iOS Notification
        ##########################################################

- alias: Water Works - Water Main Turned Off iOS Notification
  id: 'water_works_water_main_turned_off_ios_notification'

  triggers:
    - trigger: state
      entity_id: valve.water_main
      from: 'open'
      to: 'closed'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Main Has Been Shut Off!
        data:
          tag: water-main

        ##########################################################
        ## Water Main Turned On iOS Notification
        ##########################################################

- alias: Water Works - Water Main Turned On iOS Notification
  id: 'water_works_water_main_turned_on_ios_notification'

  triggers:
    - trigger: state
      entity_id: valve.water_main
      from: 'closed'
      to: 'open'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_startup_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Main Has Been Turned Back On
        data:
          tag: water-main

        ##########################################################
        ## Basement Drain Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Basement Drain Water Sensor iOS Notification
  id: 'water_works_basement_drain_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected in Basement Drain!
        data:
          tag: basement-drain-water-leak

        ##########################################################
        ## Kitchen Sink Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Kitchen Sink Water Sensor iOS Notification
  id: 'water_works_kitchen_sink_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected Under Kitchen Sink!
        data:
          tag: kitchen-sink-water-leak

        ##########################################################
        ## Bathroom Sink Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Bathroom Sink Water Sensor iOS Notification
  id: 'water_works_bathroom_sink_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected Under Bathroom Sink!
        data:
          tag: bathroom-sink-water-leak

        ##########################################################
        ## Upstairs Bathroom Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Upstairs Bathroom Water Sensor iOS Notification
  id: 'water_works_upstairs_bathroom_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathrooom_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected in Upstairs Bathroom!
        data:
          tag: upstairs-bathroom-water-leak

        ##########################################################
        ## Coal Room Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Coal Room Water Sensor iOS Notification
  id: 'water_works_coal_room_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.coal_room_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected in Coal Room!
        data:
          tag: coal-room-water-leak

        ##########################################################
        ## Utility Sink Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Utility Sink Water Sensor iOS Notification
  id: 'water_works_utility_sink_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.utility_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected Under Utility Sink!
        data:
          tag: utility-sink-water-leak

        ##########################################################
        ## Washing Machine Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Washing Machine Water Sensor iOS Notification
  id: 'water_works_washing_mashine_water_sensor_ios_notficiation'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washing_machine_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected by Washing Machine!
        data:
          tag: washing-machine-water-leak

        ##########################################################
        ## Sump Pump Water Sensor iOS Notification
        ##########################################################

- alias: Water Works - Sump Pump Water Sensor iOS Notification
  id: 'water_works_sump_pump_water_sensor_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.sump_pump_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Detected in Sump Pump!
        data:
          tag: sump-pump-water-leak

        ##########################################################
        ## Basement Drain Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Basement Drain Water Sensor Audio Notification
  id: 'water_works_basement_drain_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected in Basement Drain! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50
 
        ##########################################################
        ## Kitchen Sink Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Kitchen Sink Water Sensor Audio Notification
  id: 'water_works_kitchen_sink_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.kitchen_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected Under Kitchen Sink! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50

        ##########################################################
        ## Bathroom Sink Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Bathroom Sink Water Sensor Audio Notification
  id: 'water_works_bathroom_sink_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.bathroom_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected Under Bathroom Sink! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50

        ##########################################################
        ## Upstairs Bathroom Sink Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Upstairs Bathroom Sink Water Sensor Audio Notification
  id: 'water_works_upstairs_bathroom_sink_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.upstairs_bathrooom_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected In Upstairs Bathroom! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50

        ##########################################################
        ## Utility Sink Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Utility Sink Water Sensor Audio Notification
  id: 'water_works_utility_sink_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.utility_sink_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected Under Utility Sink! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50

        ##########################################################
        ## Washing Machine Water Sensor Audio Notification
        ##########################################################

- alias: Water Works - Washing Machine Water Sensor Audio Notification
  id: 'water_works_washing_machine_water_sensor_audio_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.washing_machine_water_sensor
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_water_automations
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: media_player.play_media
      target:
        entity_id: 
          - media_player.sonos_living_room
          - media_player.sonos_dining_room
          - media_player.sonos_kitchen
          - media_player.sonos_bathroom
          - media_player.sonos_bedroom
          - media_player.sonos_bedroom_closet
          - media_player.sonos_USER1s_office
          - media_player.sonos_USER2s_office
          - media_player.sonos_move
          - media_player.sonos_fitness_room
          - media_player.sonos_craft_room
      data:
        announce: true
        media_content_id: >
          media-source://tts/cloud?message="Water Detected by Washing Machine! Shutting Off Water Supply"
        media_content_type: "music"
        extra:
          volume: 50

        ##########################################################
        ## Water Sensor Low Battery Notification
        ##########################################################

- alias: Water Works - Low Battery Notification
  id: 'water_works_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.basement_drain_water_sensor_batt
        - sensor.sump_pump_water_sensor_batt
        - sensor.kitchen_sink_water_sensor_batt
        - sensor.bathroom_sink_water_sensor_batt
        - sensor.upstairs_bathroom_water_sensor_batt
        - sensor.utility_sink_water_sensor_batt
        - sensor.washing_machine_water_sensor_batt
        - sensor.coal_room_water_sensor_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Water Sensor {{ trigger.to_state.attributes.friendly_name }} Low Battery

#################################################################
## Water Meter Automations
#################################################################

        ##########################################################
        ## Water Leak Detected iOS Notification
        ##########################################################

- alias: Water Works - Water Leak Detected iOS Notification
  id: 'water_works_water_leak_detected_ios_notification'

  triggers:
    - trigger: state
      entity_id: binary_sensor.water_meter_leak_detected
      from: 'off'
      to: 'on'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: Possible Water Leak Detected!
        data:
          tag: water-leak#################################################################
## Weather Based Automations
#################################################################

        ##########################################################
        ## Turn Globe Blue when Raining
        ##########################################################

- alias: Weather - Turn Globe Blue when Raining
  id: 'weather_turn_globe_blue_when_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      to: 'rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      to: 'lightning-rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.globe
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
        color_name: blue
        brightness_pct: 100
        transition: 15

        ##########################################################
        ## Reset Globe Color when Not Raining
        ##########################################################

- alias: Weather - Reset Globe Color when Not Raining
  id: 'weather_reset_globe_color_when_not_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      from: 'rainy'
    - trigger: state
      entity_id: weather.REDACTED
      from: 'lightning-rainy'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: light.globe
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
        brightness_pct: 65
        color_temp: 366
        transition: 15

        ##########################################################
        ## Set Globe Blue when On and Raining
        ##########################################################

- alias: Weather - Set Globe Blue when On and Raining
  id: 'weather_set_globe_blue_when_on_and_raining'

  triggers:
    - trigger: state
      entity_id: light.globe
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: 'disarmed'
    - condition: or
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
        state: 'off'
      - condition: state
        entity_id: binary_sensor.kitchen_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.bathroom_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.upstairs_bathrooom_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.utility_sink_water_sensor
        state: 'off'
      - condition: state
        entity_id: binary_sensor.washing_machine_water_sensor
        state: 'off'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.globe
      data:
        color_name: blue
        brightness_pct: 100
        transition: 15

        ##########################################################
        ## Turn USER1's Office Desk Lamp Blue when Raining
        ##########################################################

- alias: Weather - Turn USER1's Office Desk Lamp Blue when Raining
  id: 'weather_turn_USER1_office_desk_lamp_blue_when_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      to: 'rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      to: 'lightning-rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1_office_desk_lamp
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        color_name: blue
        brightness_pct: 25

        ##########################################################
        ## Turn USER1's Office Accent Light Blue when Raining
        ##########################################################

- alias: Weather - Turn USER1's Office Accent Light Blue when Raining
  id: 'weather_turn_USER1_office_accent_light_blue_when_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      to: 'rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0
    - trigger: state
      entity_id: weather.REDACTED
      to: 'lightning-rainy'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1_office_desk_accent
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: state
      entity_id: cover.USER1_s_office_blinds
      state: 'closed'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        color_name: blue
        brightness_pct: 100
        transition: 15

        ##########################################################
        ## Reset USER1's Office Desk Lamp Color when Not Raining
        ##########################################################

- alias: Weather - Reset USER1's Office Desk Lamp Color when Not Raining
  id: 'weather_reset_USER1_office_desk_lamp_color_when_not_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      from: 'rainy'
    - trigger: state
      entity_id: weather.REDACTED
      from: 'lightning-rainy'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1_office_desk_lamp
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        brightness_pct: 25
        color_temp: 454

        ##########################################################
        ## Reset USER1's Office Accent Light Color when Not Raining
        ##########################################################

- alias: Weather - Reset USER1's Office Accent Light Color when Not Raining
  id: 'weather_reset_USER1_office_accent_light_color_when_not_raining'

  triggers:
    - trigger: state
      entity_id: weather.REDACTED
      from: 'rainy'
    - trigger: state
      entity_id: weather.REDACTED
      from: 'lightning-rainy'

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: light.USER1_office_desk_accent
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        brightness_pct: 80
        color_temp: 370
        transition: 15

        ##########################################################
        ## Set USER1's Office Desk Lamp Blue when On and Raining
        ##########################################################

- alias: Weather - Set USER1's Office Desk Lamp Blue when On and Raining
  id: 'weather_set_USER1_office_desk_lamp_blue_when_on_and_raining'

  triggers:
    - trigger: state
      entity_id: light.USER1_office_desk_lamp
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_lamp
      data:
        color_name: blue
        brightness_pct: 25

        ##########################################################
        ## Set USER1's Office Accent Light Blue when On and Raining
        ##########################################################

- alias: Weather - Set USER1's Office Accent Light Blue when On and Raining
  id: 'weather_set_USER1_office_accent_light_blue_when_on_and_raining'

  triggers:
    - trigger: state
      entity_id: light.USER1_office_desk_accent
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 2
        seconds: 0

  conditions:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: person.USER1
      state: 'home'
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'off'
    - condition: state
      entity_id: input_boolean.USER1_s_office_do_not_disturb
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_rainy_day
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: weather.REDACTED
        state: 'rainy'
      - condition: state
        entity_id: weather.REDACTED
        state: 'lightning-rainy'

  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.USER1_office_desk_accent
      data:
        color_name: blue
        brightness_pct: 100
        transition: 15